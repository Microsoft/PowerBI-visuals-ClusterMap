!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(e.Uncharted||(e.Uncharted={})).Personas=t()}}(function(){var t,e,n;return function r(t,e,n){function i(s,a){if(!e[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,r,t,e,n)}return e[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,n){"use strict";function r(){this.mEventMap={}}r.prototype.publish=function(t){var e=this.mEventMap[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),r=0,i=e.length;r<i;++r){var o=e[r];o&&o.callback.apply(o.context,n)}},r.prototype.subscribe=function(t,e,n){var r=this.mEventMap[t];r||(r=[],this.mEventMap[t]=r);for(var i=0,o=r.length;i<o;++i)if(null===r[i])return r[i]=this._createEventInfo(t,e,n,i),r[i];var s=this._createEventInfo(t,e,n,r.length);return r.push(s),s},r.prototype.remove=function(t,e){if(t.event&&this.mEventMap[t.event]&&!isNaN(t.id)){var n=this.mEventMap[t.event];n.length>t.id&&n[t.id]===t&&(n[t.id]=null,e&&this._invalidateEventInfo(t))}},r.prototype.dispose=function(){var t=this.mEventMap;for(var e in t)if(t.hasOwnProperty(e)){for(var n=t[e],r=0,i=n.length;r<i;++r)n[r]&&this._invalidateEventInfo(n[r]);this.mEventMap[e].length=0,delete this.mEventMap[e]}},r.prototype._createEventInfo=function(t,e,n,r){return{event:t,callback:e,context:n||null,id:r}},r.prototype._invalidateEventInfo=function(t){t.hasOwnProperty("event")&&delete t.event,t.hasOwnProperty("callback")&&delete t.callback,t.hasOwnProperty("context")&&delete t.context,t.hasOwnProperty("id")&&delete t.id},e.exports=r},{}],2:[function(t,e,n){"use strict";function r(t){this.mEventCenter=t,this.mRegisteredEvents={}}Object.defineProperty(r.prototype,"registeredEvents",{get:function(){return this.mRegisteredEvents}}),r.prototype.registerEvent=function(t,e){this.mRegisteredEvents[t]&&this.unregisterEvent(t),this.mRegisteredEvents[t]=this.mEventCenter.subscribe(t,e)},r.prototype.unregisterEvent=function(t){if(this.mRegisteredEvents.hasOwnProperty(t)&&this.mRegisteredEvents[t]){var e=this.mRegisteredEvents[t];this.mEventCenter.remove(e),this.mRegisteredEvents[t]=null}},r.prototype.unregisterAllEvents=function(){for(var t in this.mRegisteredEvents)this.mRegisteredEvents.hasOwnProperty(t)&&this.unregisterEvent(t)},e.exports=r},{}],3:[function(t,e,n){"use strict";function r(t,e){var n=t||"g",r=a.snap._.$(n,e);a.element.call(this,r),this.mPosition=new o,this.mScale=1,this.mClickHandlers=[],this.mDragHandlers=[],this.mPinchHandlers=[],this.mClickTouchHandlers=null,this.mDragTouchHandlers=null,this.mPinchTouchHandlers=null,this.__mPaper=new s(null),this.mPosition.changedCallback=this._setPosition.bind(this);var i=this.__mPaper.observe(function(t,e){e&&(this.onEnter(e),this.__mPaper.unobserve(i),i=-1)}.bind(this))}var i=t("snapsvg"),o=t("./personas.core.point2d"),s=t("./personas.core.observable.js"),a={};i.plugin(function(t,e,n,r,i){a.snap=t,a.element=e,a.paper=n,a.global=r,a.Fragment=i}),r.prototype=Object.create(a.element.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"position",{get:function(){return this.mPosition}}),Object.defineProperty(r.prototype,"scale",{get:function(){return this.mScale},set:function(t){this._setScale(t)}}),Object.defineProperty(r.prototype,"paper",{get:function(){return this.__mPaper.getValue()},set:function(t){this.__mPaper.setValue(t)}}),r.prototype.append=function(t){return t instanceof r?(t.__mPaper.ignoreChanges(1),a.element.prototype.append.call(this,t),t.paper=this.__mPaper):a.element.prototype.append.call(this,t),this},r.prototype.remove=function(){return a.element.prototype.remove.call(this),this.__mPaper.reset(!1),this},r.prototype.click=function(t){a.element.prototype.click.call(this,t);var e=this.mClickHandlers;if(e.push(t),!this.mClickTouchHandlers){var n=null,r=null,i=function(t){if(t.touches.length>1&&null!==r)r=null;else if(1===t.touches.length&&null===r){var e=t.changedTouches[0];r=e.identifier,n={x:e.pageX,y:e.pageY}}},o=function(t){if(null!==r)for(var i=t.changedTouches,o=0,s=i.length;o<s;++o){var a=i[o];if(a.identifier===r){r=null;var u=Math.sqrt(Math.pow(n.x-a.pageX,2)+Math.pow(n.y-a.pageY,2));if(!a._personasTouchConsumed&&u<19){a._personasTouchConsumed=!0;for(var h=0,c=e.length;h<c;++h)e[h](null,a.pageX,a.pageY)}break}}},s=function(t){if(null!==r)for(var e=t.changedTouches,n=0,i=e.length;n<i;++n){var o=e[n];if(o.identifier===r){r=null;break}}};this.touchstart(i),this.touchend(o),this.touchcancel(s),this.mClickTouchHandlers=[i,o,s]}},r.prototype.unclick=function(t){if(a.element.prototype.unclick.call(this,t),this.mClickTouchHandlers){if(t){var e=this.mClickHandlers.indexOf(t);e>-1&&this.mClickHandlers.splice(e,1)}else this.mClickHandlers.length=0;this.mClickHandlers.length||(this.untouchstart(this.mClickTouchHandlers[0]),this.untouchend(this.mClickTouchHandlers[1]),this.untouchcancel(this.mClickTouchHandlers[2]),this.mClickTouchHandlers=null)}},r.prototype.drag=function(t,e,n,r,i,o){if(a.element.prototype.drag.call(this,t,e,n,r,i,o),!this.mDragTouchHandlers){var s=this.mDragHandlers;s.push({onmove:t,onstart:e,onend:n});var u=!1,h=null,c=null,l=function(t){if(t.touches.length>1&&null!==c){if(c=null,u){u=!1;for(var e=0,n=s.length;e<n;++e)s[e].onend&&s[e].onend(null)}}else if(1===t.touches.length&&null===c){var r=t.changedTouches[0];c=r.identifier,h={x:r.pageX,y:r.pageY}}},p=function(t){if(null!==c)for(var e=t.changedTouches,n=0,r=e.length;n<r;++n){var i=e[n];if(i.identifier===c){var o,a;if(u){for(o=0,a=s.length;o<a;++o)s[o].onmove&&s[o].onmove(i.pageX-h.x,i.pageY-h.y,i.pageX,i.pageY,null);h.x=i.pageX,h.y=i.pageY}else{var l=Math.sqrt(Math.pow(h.x-i.pageX,2)+Math.pow(h.y-i.pageY,2));if(l>19){for(u=!0,o=0,a=s.length;o<a;++o)s[o].onstart&&s[o].onstart(h.x,h.y,null);p(t)}}break}}},f=function(t){if(null!==c)for(var e=t.changedTouches,n=0,r=e.length;n<r;++n){var i=e[n];if(i.identifier===c){c=null,u=!1;for(var o=0,a=s.length;o<a;++o)s[o].onend&&s[o].onend(null);break}}};this.touchstart(l),this.touchmove(p),this.touchend(f),this.touchcancel(f),this.mDragTouchHandlers=[l,p,f]}},r.prototype.undrag=function(){a.element.prototype.undrag.call(this),this.mDragTouchHandlers&&(this.mDragHandlers.length=0,this.untouchstart(this.mDragTouchHandlers[0]),this.untouchmove(this.mDragTouchHandlers[1]),this.untouchend(this.mDragTouchHandlers[2]),this.untouchcancel(this.mDragTouchHandlers[2]),this.mDragTouchHandlers=null)},r.prototype.pinch=function(t){var e=this.mPinchHandlers;if(e.push(t),!this.mPinchTouchHandlers){var n=0,r=null,i=null,o=null,s=function(t){if(t.touches.length>1&&null===i&&null===o){var e=t.touches[0];i=t.touches[0].identifier;var s=t.touches[1];o=t.touches[1].identifier,n=Math.sqrt(Math.pow(e.pageX-s.pageX,2)+Math.pow(e.pageY-s.pageY,2)),r={x:.5*(e.pageX+s.pageX),y:.5*(e.pageY+s.pageY)}}},a=function(t){if(null!==i&&null!==o){for(var s=t.touches,a=null,u=null,h=0,c=s.length;h<c;++h){var l=s[h];l.identifier===i?a=l:l.identifier===o&&(u=l)}if(a&&u){for(var p=Math.sqrt(Math.pow(a.pageX-u.pageX,2)+Math.pow(a.pageY-u.pageY,2)),f=.5*(a.pageX+u.pageX)-r.x,d=.5*(a.pageY+u.pageY)-r.y,m={x:r.x-f,y:r.y-d},g=0,v=e.length;g<v;++g)e[g]&&e[g](m,p-n);n=p}}},u=function(t){if(null!==i&&null!==o)for(var e=t.changedTouches,n=0,r=e.length;n<r;++n){var s=e[n];if(s.identifier===i||s.identifier===o){i=null,o=null;break}}};this.touchstart(s),this.touchmove(a),this.touchend(u),this.touchcancel(u),this.mClickTouchHandlers=[s,a,u]}},r.prototype.unpinch=function(t){if(this.mPinchTouchHandlers){if(t){var e=this.mPinchHandlers.indexOf(t);e>-1&&this.mPinchHandlers.splice(e,1)}else this.mPinchHandlers.length=0;this.mPinchHandlers.length||(this.untouchstart(this.mPinchTouchHandlers[0]),this.untouchmove(this.mPinchTouchHandlers[1]),this.untouchend(this.mPinchTouchHandlers[2]),this.untouchcancel(this.mPinchTouchHandlers[2]),this.mPinchTouchHandlers=null)}},r.prototype._setPosition=function(t,e){this.mPosition.mX=t,this.mPosition.mY=e;var n=this.transform().localMatrix;n.e=t,n.f=e,this.transform(n)},r.prototype._setScale=function(t){if(t!==this.mScale){this.mScale=t;var e=new i.Matrix;e.e=this.mPosition.x,e.f=this.mPosition.y,e.scale(t),this.transform(e)}},r.prototype.onEnter=function(t){},r.mixinTouch=function(t){return t.mClickHandlers=[],t.mDragHandlers=[],t.mPinchHandlers=[],t.mClickTouchHandlers=null,t.mDragTouchHandlers=null,t.mPinchTouchHandlers=null,t.click=r.prototype.click,t.unclick=r.prototype.unclick,t.drag=r.prototype.drag,t.undrag=r.prototype.undrag,t.pinch=r.prototype.pinch,t.unpinch=r.prototype.unpinch,t},e.exports=r},{"./personas.core.observable.js":4,"./personas.core.point2d":5,snapsvg:22}],4:[function(t,e,n){"use strict";function r(t){this.mValue=t,this.mObservers=[],this.mEmptySpaces=0,this.mParent=null,this.mParentId=-1,this.mIgnoreCount=0}Object.defineProperty(r.prototype,"value",{get:function(){return this.mValue},set:function(t){this.setValue(t)}}),r.prototype.setValue=function(t){if(this.mIgnoreCount)--this.mIgnoreCount;else if(t instanceof r){this.mParent!==t&&(this.mParent&&this.mParentId!==-1&&this.mParent.unobserve(this.mParentId),this.mParent=t,this.mParentId=t.observe(this._handleParentValueChanged.bind(this)));var e=t.getValue();this.mValue!==e&&(this.mValue=e,this._notifyObservers(e))}else t!==this.mValue&&(this.mValue=t,this._notifyObservers(t))},r.prototype.getValue=function(){return this.mValue},r.prototype.observe=function(t){var e=this.mObservers,n=e.length;if(this.mEmptySpaces){for(var r=0;r<n;++r)if(null===e[r]){e[r]=t,n=r,--this.mEmptySpaces;break}}else e.push(t);return n},r.prototype.unobserve=function(t){var e=this.mObservers;return!!e[t]&&(e[t]=null,++this.mEmptySpaces,!0)},r.prototype.ignoreChanges=function(t){this.mIgnoreCount+=t},r.prototype.reset=function(t){this.mParent&&this.mParentId!==-1&&(this.mParent.unobserve(this.mParentId),this.mParent=null,this.mParentId=-1),t&&(delete this.mObservers,this.mObservers=[]),this.mValue=null,this.mIgnoreCount=0},r.prototype._notifyObservers=function(t){for(var e=this.mObservers,n=0,r=e.length;n<r;++n)e[n]&&e[n](this,t)},r.prototype._handleParentValueChanged=function(t,e){t===this.mParent&&e!==this.mValue&&(this.mValue=e,this._notifyObservers(e))},e.exports=r},{}],5:[function(t,e,n){"use strict";function r(t,e){this.mX=t||0,this.mY=e||0,this.mChangedCallback=null}Object.defineProperty(r.prototype,"x",{get:function(){return this.mX},set:function(t){this.mX=t,this.mChangedCallback&&this.mChangedCallback(t,this.mY)}}),Object.defineProperty(r.prototype,"y",{get:function(){return this.mY},set:function(t){this.mY=t,this.mChangedCallback&&this.mChangedCallback(this.mX,t)}}),Object.defineProperty(r.prototype,"changedCallback",{get:function(){return this.mChangedCallback},set:function(t){"function"==typeof t?this.mChangedCallback=t:this.mChangedCallback=null}}),r.prototype.set=function(t,e){this.mX=t,this.mY=e,this.mChangedCallback&&this.mChangedCallback(t,e)},r.prototype.add=function(t){this.mX+=t.mX,this.mY+=t.mY,this.mChangedCallback&&this.mChangedCallback(this.mX,this.mY)},r.prototype.subtract=function(t){this.mX-=t.mX,this.mY-=t.mY,this.mChangedCallback&&this.mChangedCallback(this.mX,this.mY)},r.prototype.clone=function(){var t=new this.constructor(this.mX,this.mY);return t.mChangedCallback=this.mChangedCallback,t},e.exports=r},{}],6:[function(t,e,n){"use strict";function r(t,e){i.call(this,t,e)}var i=t("./personas.core.point2d");r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.fromPoints=function(t,e){return new r(e.x-t.x,e.y-t.y)},Object.defineProperty(r.prototype,"lengthSQ",{get:function(){return this.mX*this.mX+this.mY*this.mY}}),Object.defineProperty(r.prototype,"length",{get:function(){return Math.sqrt(this.lengthSQ)}}),Object.defineProperty(r.prototype,"unit",{get:function(){var t=this.length;return new r(this.mX/t,this.mY/t)}}),r.prototype.dot=function(t){return this.mX*t.mX+this.mY*t.mY},r.prototype.cross=function(t){return this.mX*t.mY-this.mY*t.mX},e.exports=r},{"./personas.core.point2d":5}],7:[function(t,e,n){var r={hooks:{onSelectPersona:null,onHoverPersona:null,onMergePersona:null,onSelectionCleared:null,onZoomUpdateFromUser:null,onClickEmptySpace:null}};e.exports=r,e.exports.Persona={classes:{container:"prsnas_container",persona:"prsnas_persona",content:"prsnas_main",name:"prsnas_name",namecontainer:"prsnas_namecontainer",count:"prsnas_count",totalcount:"prsnas_totalcount",counttext:"prsnas_counttext",seedcount:"seed_count",seedname:"seed_value",unselectable:"unselectable",zoomcontrols:"prsnas_zoom_controls",zoomcontrolslabel:"control_label"},layout:{systemtype:"cola",textpadding:2,progressHeight:9,minSize:130,maxSize:250,selectedBorder:8},pie:{baseColor:"#F6F1EE",defaultColor:"#9EC731",minimumDisplayRatio:.025},events:{select:"[Persona::PersonaSelect]",deselectAll:"[Persona::PersonaDeselectAll]",hover:"[Persona::PersonaHover]",enableBlur:"[Persona::PersonaEnableBlur]",repel:"[Persona::PersonaRepel]",dragStarted:"[Persona::PersonaDragStarted]",dragMoved:"[Persona::PersonaDragged]",dragEnded:"[Persona::PersonaDragEnded]",merged:"[Persona::PersonaMerged]",expandSeed:"[Persona::expandSeed]",closeSeed:"[Persona::closeSeed]",zoomUpdateFromUser:"[Persona::zoomUpdateFromUser]"},config:{animationsDurationBase:100,transitionsDuration:500,moveEnabled:!1,mergeEnabled:!0,mergeOverlapRatio:.3,mergeScaleRatio:1.05,drawOrbits:!0,seedAnimationDurationBase:400,autoGenerateFallbackColors:!0,autoColorClampMin:40,autoColorClampMax:220,forceGreyscaleBackgroundColor:!0,fallbackBackgroundColor:"#444444",subSelectEffectEnabled:!0,subSelectEffectCompatibilityMode:!0,registerWindowResize:!0,displayTotalCountLabel:!0,displayLabelsAtOneCount:!0,renderSubSelectionBackground:!0,renderGaugeSeparators:!1,gaugeSeparatorWidth:.003}}},{}],8:[function(t,e,n){(function(n){"use strict";function r(t,e){if(this.mConfig=i.extend(!0,{},s,e,{eventCenter:new m}),this.mEventCenter=this.mConfig.eventCenter,this.mEventTracker=new d(this.mEventCenter),this.mElement=null,this.mPaper=null,this.mViewport=null,this.mLayoutSystemFactory=null,this.mLayoutSystemType=null,this.mLayoutSystem=null,this.mSortedData=null,this.mIconMap=this.processIconMap(this.mConfig),this.mOwnsSVG=!1,this.mJQElement=i(t),this.mOtherPersona=null,this.mOtherPersonaFill=null,t instanceof SVGElement){this.mElement=t;var n=t.getAttribute("class");n&&n.split(" ").indexOf("personas")<0?this.mElement.setAttribute("class",n+" personas"):n||this.mElement.setAttribute("class","personas")}else{var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),r.setAttributeNS(null,"version","1.1"),r.setAttribute("width",t.getAttribute("width")),r.setAttribute("height",t.getAttribute("height")),r.setAttribute("class","personas"),t.appendChild(r),this.mElement=r,this.mOwnsSVG=!0}if(this.mPaper=v.mixinTouch(o(this.mElement)),this.mViewport=new a(this.mPaper,this.mConfig),this.mPaper.append(this.mViewport),this.mZoomControls=new u(this.mConfig,function(){this.mViewport.zoom(.3*this.mViewport.zoomAmount,this.mViewport.center,!0)}.bind(this),function(){this.mViewport.zoom(-(.3*this.mViewport.zoomAmount),this.mViewport.center,!0)}.bind(this),function(){this.autoZoom(),this.mEventCenter.publish(f.zoomUpdateFromUser,this.zoom)}.bind(this)),this.mZoomControls.position.set(this.mJQElement.width()-this.mZoomControls.width-20,20),this.mPaper.append(this.mZoomControls),this.registerEvents(),this.mElementWidth=this.mJQElement.width(),this.mElementHeight=this.mJQElement.height(),this.layoutSystemType=this.mConfig.Persona.layout.systemtype,this.mConfig.Persona.config.registerWindowResize){var h=function(){var t=null;return function(){t||(t=setTimeout(function(){this.resize(),t=null}.bind(this),100))}.bind(this)}.bind(this)();window.addEventListener("resize",h,!1)}}var i="undefined"!=typeof window?window.$:"undefined"!=typeof n?n.$:null,o=t("snapsvg"),s=t("./personas.defaults"),a=t("./personas.layout.viewport.js"),u=t("./personas.layout.zoomControls.js"),h=t("./personas.layout.orbitSystem.js"),c=t("./personas.layout.colaSystem.js"),l=t("./personas.persona.js"),p=t("./personas.persona.seed.js"),f=s.Persona.events,d=t("./personas.core.eventTracker"),m=t("./personas.core.eventCenter.js"),g=t("./personas.core.point2d.js"),v=t("./personas.core.node");Object.defineProperty(r.prototype,"zoom",{get:function(){return this.mViewport.zoomAmount},set:function(t){var e=!0,n=!0;this.mViewport.zoom(t,this.mViewport.center,e,n)}}),Object.defineProperty(r.prototype,"layoutSystem",{get:function(){return this.mLayoutSystem}}),Object.defineProperty(r.prototype,"layoutSystemType",{get:function(){return this.mLayoutSystemType},set:function(t){var e;switch(t){case r.COLA_LAYOUT_SYSTEM:e=t;break;case r.ORBITAL_LAYOUT_SYSTEM:default:e=r.ORBITAL_LAYOUT_SYSTEM}this._setLayoutSystemType(e)}}),r.prototype._setLayoutSystemType=function(t){if(t!==this.mLayoutSystemType){switch(this.mLayoutSystemType=t,t){case r.COLA_LAYOUT_SYSTEM:this.mLayoutSystemFactory=function(){return new c(this.mJQElement)}.bind(this);break;case r.ORBITAL_LAYOUT_SYSTEM:default:this.mLayoutSystemFactory=function(){return new h(20)}}if(this.mLayoutSystem){this.mOtherPersona&&this.mLayoutSystem.removeObject(this.mOtherPersona);var e=this.mLayoutSystem;e.removeAllObjects(),e.remove(),this.mLayoutSystem=this.mLayoutSystemFactory(),this.mLayoutSystem.position.set(e.position.x,e.position.y),this.mViewport.append(this.mLayoutSystem),this.mSortedData.array.forEach(function(t){t.graphicalPersona&&this._addPersonaAndSeeds(this.mLayoutSystem,t)}.bind(this)),this.mLayoutSystem.positionObjects(!0),setTimeout(function(){this._appendAndPositionOtherPersona(!1),this.autoZoom()}.bind(this),500)}}},r.prototype.processIconMap=function(t){var e={icons:{},defaults:{},fallbackColor:t.Persona.pie.defaultColor};if(!t.autoGenerateIconMap&&t.entityIcons)for(var n=t.entityIcons,r=0,i=n.length;r<i;++r){var o=n[r];o.color&&(o.entityRefId?e.icons[o.entityRefId]=o.color:o.isDefault&&(e.defaults[o.type]=o.color))}return e},r.prototype.loadData=function(t,e,n){this.mOtherPersona&&this.mLayoutSystem.removeObject(this.mOtherPersona),this.mSortedData&&e?(this.updateData(t),setTimeout(function(){this._updateOtherPersona(this.mSortedData.original.aggregates.other,!1),n&&n.deferZoom||this.autoZoom()}.bind(this),500)):(this.mLayoutSystem&&(this.mLayoutSystem.invalidate(),this.mLayoutSystem.removeAllObjects(),this.mLayoutSystem.remove(),this.mLayoutSystem=null),this.mSortedData=this.sortData(t),this.mLayoutSystem=this.mLayoutSystemFactory(),this.createPersonas(this.mSortedData,this.mLayoutSystem),this.mLayoutSystem.positionObjects(!1),this._createOtherPersona(this.mSortedData.original.aggregates.other),n&&n.deferZoom||this.autoZoom())},r.prototype.updateData=function(t){var e=this.mergeData(this.mSortedData.original,t),n=this.sortData(e),r=this.mConfig.Persona.layout.minSize,i=this.mConfig.Persona.layout.maxSize,o=n.minCount,s=n.maxCount-o||1,a=e.entityRefs,u=this.mIconMap,h=this.mLayoutSystemFactory();n.array.forEach(function(t){t.graphicalPersona?(t.size=(t.relevantCount-o)/s*(i-r)+r,t.graphicalPersona.updateData(t.size,t,u,a)):this._createPersonaAndSeeds(h,e,t,o,r,i,s)}.bind(this)),h.forEach(function(t){var e=t.position.changedCallback;t.position.changedCallback=null,t.position.set(0,0),t.position.changedCallback=e,t.transform("t0,0"),t.popIn&&t.popIn()}),h.removeAllObjects(),this.mLayoutSystem.removeAllObjects(),n.array.forEach(function(t){this._addPersonaAndSeeds(this.mLayoutSystem,t)}.bind(this)),this.mLayoutSystem.positionObjects(!0,!0),this.mSortedData=n},r.prototype.mergeData=function(t,e){return i.extend(!0,{},t,e)},r.prototype._createOtherPersona=function(t){if(this.mOtherPersona&&(this.mLayoutSystem.removeObject(this.mOtherPersona),this.mOtherPersona=null),t&&t.count){var e={id:r.OTHER_PERSONA_DEFAULT_ID,totalCount:t.count,relevantName:"Other",relevantCount:t.count,properties:[{count:0,isPrimary:!1,color:"#000000"}]};if(t.metadata&&(e.metadata=t.metadata),this.mOtherPersona=new l(this.mConfig.Persona.layout.minSize,e,this.mIconMap,this.mConfig),this.mOtherPersona.mLabel.mTotalCountText&&this.mOtherPersona.mLabel.mTotalCountText.remove(),this.mOtherPersona.mGauge.addBar("__selection_bar_id__",0,this.mConfig.Persona.pie.defaultColor),!this.mOtherPersonaFill){var n=this.mPaper.g(),i=n.rect(0,0,10,10);i.attr({fill:"#eee"});var o=n.line(-2,2,1,-1);o.attr({stroke:"#ddd","stroke-width":"4px"}),o=n.line(0,10,10,0),o.attr({stroke:"#ddd","stroke-width":"4px"}),o=n.line(8,12,11,9),o.attr({stroke:"#ddd","stroke-width":"4px"}),this.mOtherPersonaFill=n.toPattern(0,0,10,10)}this.mOtherPersona.mAvatar.mBackground.attr({fill:this.mOtherPersonaFill}),this._appendAndPositionOtherPersona(!1)}},r.prototype.isOtherPersona=function(t){return this.mOtherPersona&&t===r.OTHER_PERSONA_DEFAULT_ID},r.prototype._updateOtherPersona=function(t,e){this.mOtherPersona&&t&&t.count?(this.mOtherPersona.mParent!==this.mLayoutSystem&&this.mLayoutSystem.addObject(this.mOtherPersona,!0),this.mOtherPersona.mLabel.count=t.count,this._appendAndPositionOtherPersona(e)):this.mOtherPersona&&(this.mLayoutSystem.removeObject(this.mOtherPersona),this.mOtherPersona=null)},r.prototype._appendAndPositionOtherPersona=function(t){if(this.mOtherPersona){this.mLayoutSystem.removeObject(this.mOtherPersona);var e=this.mLayoutSystem.getBBox();this.mLayoutSystem.addObject(this.mOtherPersona,!0);var n=e.x2-this.mLayoutSystem.position.x,r=e.y2-this.mLayoutSystem.position.y,i=new g(n+this.mOtherPersona.radius,r+this.mOtherPersona.radius);t?this.mOtherPersona.animatePosition(this.mOtherPersona.position,i,100,mina.backout):this.mOtherPersona.position.set(i.x,i.y)}},r.prototype._personaComparison=function(t,e){return e.relevantCount-t.relevantCount},r.prototype.sortData=function(t){var e=Number.MIN_VALUE,n=Number.MAX_VALUE,r=[],i=t.entityRefs,o=t.aggregates.personas;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s],u="",h=0,c=this.findPrimaryProperty(a.properties);c&&(h=c.count,c.entityRefId?(u=i[c.entityRefId].name,a.imageUrl=i[c.entityRefId].imageUrl,i[c.entityRefId].backgroundColor&&(c.backgroundColor=i[c.entityRefId].backgroundColor)):u=c.value),e=h>e?h:e,n=h<n?h:n,a.primaryProperty=c,a.relevantCount=h,a.formattedRelevantCount=c&&c.formattedCount?c.formattedCount:null,a.relevantName=u,a.seeds=this.getSeedsForPersona(t.aggregates.seeds,a.id),a.links=this.getLinksForPersona(t.aggregates.links,a.id),a.links.push.apply(a.links,a.seeds),a.graphicalPersona||(a.graphicalPersona=null),r.push(a)}return r.sort(this._personaComparison),{original:t,array:r,minCount:n,maxCount:e}},r.prototype.createPersonas=function(t,e){var n=t.original,r=t.array,o=.5*i(this.mElement).width(),s=.5*i(this.mElement).height(),a=this.mConfig.Persona.layout.minSize,u=this.mConfig.Persona.layout.maxSize,h=t.minCount,c=t.maxCount-h||1;r.forEach(function(t){this._createPersonaAndSeeds(e,n,t,h,a,u,c)}.bind(this)),e&&(this.mViewport.append(e),e.position.set(o,s))},r.prototype._addPersonaAndSeeds=function(t,e){var n=e.graphicalPersona;if(!t.containsObject(n)){t.addObject(n,!0);var r=e.seeds;r.forEach(function(e){t.addObject(e.info.graphicalSeed,!0)})}},r.prototype._createPersonaAndSeeds=function(t,e,n,r,i,o,s){if(!n.graphicalPersona){var a=e.entityRefs;n.size=(n.relevantCount-r)/s*(o-i)+i;var u=new l(n.size,n,this.mIconMap,this.mConfig,a);n.graphicalPersona=u,t&&t.addObject(u,!0);var h=n.seeds,c=this.mConfig;h.forEach(function(e){if(!e.info.graphicalSeed){var n=new p(i,e.property,c);e.info.graphicalSeed=n,t&&t.addObject(n,!0)}})}},r.prototype._seedComparison=function(t,e){return t.strength-e.strength},r.prototype.getSeedsForPersona=function(t,e){var n=[];if(t)for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if(i.relatedTo===e){var o=0,s=this.findPrimaryProperty(i.properties);s&&(o=s.count),o&&n.push({strength:o,seedId:r,info:i,property:s})}}return n.sort(this._seedComparison),n},r.prototype._linkComparison=function(t,e){return(t.weight||0)-(e.weight||0)},r.prototype.getLinksForPersona=function(t,e){var n=[];return t&&t.forEach(function(t){t.target===e&&t.source&&n.push(t)}),n.sort(this._linkComparison),n},r.prototype.findPrimaryProperty=function(t){if(t&&t.length){for(var e=0,n=t.length;e<n;++e)if(t[e].isPrimary)return t[e];return t[0]}return null},r.prototype.findPersona=function(t){for(var e=this.mSortedData.array,n=0,r=e.length;n<r;++n){var i=e[n];if(i.graphicalPersona&&i.graphicalPersona.personaId===t)return i.graphicalPersona}return null},r.prototype.autoZoom=function(){var t=this.mJQElement.width(),e=this.mJQElement.height(),n=this.mLayoutSystem.getBBox(),r=Math.min(t/n.width,e/n.height);r<this.mViewport.minZoomScale?r=this.mViewport.minZoomScale:r>this.mViewport.maxZoomScale&&(r=this.mViewport.maxZoomScale),this.mViewport.zoomAmount=r;var i=o.matrix();i.translate(.5*t,.5*e),i.scale(r),i.translate(-n.cx,-n.cy),this.mViewport.animate({transform:i},250,mina.easeinout)},r.prototype.resize=function(){var t=this.mJQElement.width(),e=this.mJQElement.height(),n=this.mViewport.transform().localMatrix;if(t!==this.mElementWidth){var r=t-this.mElementWidth;this.mElementWidth=t,n.e+=.5*r,this.mOwnsSVG&&this.mElement.setAttribute("width",t)}if(e!==this.mElementHeight){var i=e-this.mElementHeight;this.mElementHeight=e,n.f+=.5*i,this.mOwnsSVG&&this.mElement.setAttribute("height",e)}this.mViewport.transform(n),this.mZoomControls.position.set(this.mJQElement.width()-this.mZoomControls.width-20,20)},r.prototype.removePersona=function(t){var e=t;e.personaId||(e=this.findPersona(t)),this.mLayoutSystem.removeObject(e);var n=e.personaId,r=this.mSortedData.original.aggregates.personas;if(r.hasOwnProperty(n)){var i=r[n];delete r[n];var o=this.mSortedData.array.indexOf(i);o>=0&&this.mSortedData.array.splice(o,1)}},r.prototype.registerEvents=function(){var t=this.mEventTracker;t.registerEvent(f.select,this.handlePersonaSelect.bind(this)),t.registerEvent(f.hover,this.handlePersonaHover.bind(this)),t.registerEvent(f.merged,this.handlePersonaMerged.bind(this)),t.registerEvent(f.deselectAll,this.handlePersonaDeselectAll.bind(this)),t.registerEvent(f.zoomUpdateFromUser,this.handlePersonaZoomUpdate.bind(this))},r.prototype.unregisterEvents=function(){this.mEventTracker.unregisterAllEvents()},r.prototype.handlePersonaSelect=function(t){if(this.mLayoutSystem){var e=[],n=this.mIconMap;this.mLayoutSystem.forEach(function(t){t instanceof l&&(t.removeAllAppendedGauges(),t.replaceGaugeBars(t.data,n),t.inVisualFocus=!0,e.push({id:t.personaId,selected:t.isSelected}))}),"function"==typeof this.mConfig.hooks.onSelectPersona&&(t.personaSelectionStates=e,this.mConfig.hooks.onSelectPersona(t))}},r.prototype.handlePersonaDeselectAll=function(){if(this.mLayoutSystem){var t=this.mIconMap;if(this.mLayoutSystem.forEach(function(e){e instanceof l&&(e.isSelected=!1,e.removeAllAppendedGauges(),e.replaceGaugeBars(e.data,t),e.inVisualFocus=!0)}),"function"==typeof this.mConfig.hooks.onSelectPersona){var e=[],n={};this.mLayoutSystem.forEach(function(t){t instanceof l&&e.push({id:t.personaId,selected:t.isSelected})}),e.length&&(n.id=e[0].id,n.selected=e[0].selected,n.personaSelectionStates=e,this.mConfig.hooks.onSelectPersona(n))}"function"==typeof this.mConfig.hooks.onSelectionCleared&&this.mConfig.hooks.onSelectionCleared()}},r.prototype.handlePersonaZoomUpdate=function(t){"function"==typeof this.mConfig.hooks.onZoomUpdateFromUser&&this.mConfig.hooks.onZoomUpdateFromUser(t)},r.prototype.handlePersonaHover=function(t){"function"==typeof this.mConfig.hooks.onHoverPersona&&this.mConfig.hooks.onHoverPersona(t)},r.prototype.handlePersonaMerged=function(t,e){"function"==typeof this.mConfig.hooks.onMergePersona&&this.mConfig.hooks.onMergePersona({merged:t,mergedTo:e});var n=t.personaId,r=this.mSortedData.original.aggregates.personas;if(r.hasOwnProperty(n)){var i=r[n];delete r[n];var o=this.mSortedData.array.indexOf(i);o>=0&&this.mSortedData.array.splice(o,1)}},r.prototype.enableBlur=function(t){this.mEventCenter.publish(f.enableBlur,t)},r.prototype.subSelectPersonas=function(t,e){var n=this.mIconMap;t?this.layoutSystem.forEach(function(r){if(r instanceof l){r.isSelected=!1;var i=r.data,o={properties:[],totalCount:i.totalCount},s=function(t,e,n){o.properties.push({value:t,count:e,color:n})},a=r.personaId,u=i.relevantCount,h=t[r.personaId],c=a+"-subselect",p=0,f=r.gauge.mBars,d=Boolean(f[c+"-0"]);if(h&&h.bars.length){for(var m=h.bars,g=0,v=m.length;g<v;++g){var y=m[g],_=c+"-"+g;p+=y.count,s(_,y.count,y.color)}r.inVisualFocus=!0,d=!1}e&&d||(r.inVisualFocus=Boolean(o.properties.length),!this.isOtherPersona(a)&&this.mConfig.Persona.config.renderSubSelectionBackground&&(u-=p,s(c+"-back",u,"#c5c1be")),r.replaceGaugeBars(o,n))}}.bind(this)):this.mEventCenter.publish(f.deselectAll)},r.prototype.subSelectPersonasMultiGauge=function(t,e){t?this.mLayoutSystem.forEach(function(n){if(n instanceof l){n.isSelected=!1;var r=t[n.personaId];if(e||n.removeAllAppendedGauges(),r){if(r.computePercentages)for(var i=r.totalCount||n.mData.totalCount,o=r.bars,s=0,a=o.length;s<a;++s){var u=o[s];u.percent=u.count/i}n.appendGauge(r.bars),n.bringToFront(),n.inVisualFocus=!0}else e&&n.hasAppendedGauges||(n.inVisualFocus=!1)}}):this.mEventCenter.publish(f.deselectAll)},r.ORBITAL_LAYOUT_SYSTEM="orbital",r.COLA_LAYOUT_SYSTEM="cola",r.OTHER_PERSONA_DEFAULT_ID="__Personas_Other_Persona_ID__",e.exports=r,e.exports.asJQueryPlugin=function(){i.fn.personas=function(t){var e=this,n={initialize:function(t){this._personas=new r(this,t)},loaddata:function(t,e,n){this._personas.loadData(t,e,n)},enableblur:function(t){this._personas.enableBlur(t)},subselect:function(t,e){if(t){for(var n={},r=0,i=t.length;r<i;++r){var o=t[r];n[o.personaId]={computePercentages:!0,bars:[{color:o.color,count:o.count}]}}this._personas.subSelectPersonas(n,e)}else this._personas.subSelectPersonas(null,e)},clearSubselections:function(){this._personas.mEventCenter.publish(f.deselectAll)},unregisterHandlers:function(){this._personas.unregisterEvents()},setlayouttype:function(t){this._personas.layoutSystemType=t},findpersona:function(t,e){e(this._personas.findPersona(t))},getZoom:function(t){t(this._personas.zoom)},setZoom:function(t){this._personas.zoom=t},dispose:function(){e.each(function(t,e){e._personas=null,e.remove()})}},o=arguments;return e.each(function(e,r){void 0===t?n.initialize.apply(r,null):n[t]?n[t].apply(r,Array.prototype.slice.call(o,1)):"object"!=typeof t&&t?i.error("Command: "+t+"does not exist."):n.initialize.apply(r,o)})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./personas.core.eventCenter.js":1,"./personas.core.eventTracker":2,"./personas.core.node":3,"./personas.core.point2d.js":5,"./personas.defaults":7,"./personas.layout.colaSystem.js":9,"./personas.layout.orbitSystem.js":12,"./personas.layout.viewport.js":13,"./personas.layout.zoomControls.js":14,"./personas.persona.js":17,"./personas.persona.seed.js":19,snapsvg:22}],9:[function(t,e,n){"use strict";function r(t){i.call(this),this.mObjects=[],this.mContainer=t}var i=t("./personas.layout.layoutSystem.js"),o=t("webcola"),s=t("./personas.core.point2d.js");r.prototype=Object.create(i.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"objectCount",{get:function(){return this.mObjects.length}}),r.prototype.addObject=function(t,e){this.mObjects.push(t),this.append(t)},r.prototype.removeObject=function(t){var e=this.mObjects,n=e.indexOf(t);return n>=0&&(e[n].mParent=null,e[n].remove(),e.splice(n,1),!0)},r.prototype.removeAllObjects=function(){for(var t=this.mObjects;t.length;){
var e=t.pop();e.remove(),e.mParent=null}},r.prototype.containsObject=function(t){return this.mObjects.indexOf(t)>=0},r.prototype.forEach=function(t){this.mObjects.forEach(t)},r.prototype.positionObjects=function(t,e){var n=[],r=[],i=this.mContainer.width(),a=this.mContainer.height();this.mObjects.forEach(function(t){var e=this._createNodeData(t);e&&(e.id||(e.id="unknown_"+n.length),n.push(e),r.push.apply(r,this._processLinksData(t,e)))}.bind(this));for(var u=0;u<r.length;++u){var h=r[u];h.source=this._findNode(n,h.seed||h.source),h.target&&h.source||r.splice(u--,1)}var c=new o.Layout;c.nodes(n),c.links(r),c.size([i,a]),c.avoidOverlaps(!0),c.linkDistance(function(t){return.4*t.source.width+.4*t.target.width}),c.start(25,0,10,0,!1),e||this._fit(n,i,a);var l=.5*i,p=.5*a;n.forEach(function(e){if(e.x-=l,e.y-=p,t&&e.object.animatePosition){var n=e.object.position;if(e.x!==n.x||e.y!==n.y){var r=new s(e.x,e.y);e.object.animatePosition(n,r,500,mina.backout)}}else e.object.position.set(e.x,e.y)})},r.prototype.invalidate=function(){for(var t=this.mObjects,e=0,n=t.length;e<n;++e){var r=t[e];"function"==typeof r.invalidate&&r.invalidate()}},r.prototype._createNodeData=function(t){return{object:t,id:t.personaId,x:t.position.x,y:t.position.y,width:t.size,height:t.size}},r.prototype._processLinksData=function(t,e){var n=[];return t.data&&t.data.links&&t.data.links.forEach(function(t){var r={source:t.source,target:e};!r.source&&t.info&&t.info.graphicalSeed&&(r.source=null,r.seed=t.info.graphicalSeed),t.length&&(r.length=t.length),t.weight&&(r.weight=t.weight),n.push(r)}),n},r.prototype._findNode=function(t,e){for(var n=0,r=t.length;n<r;++n)if(t[n].id===e||t[n].object===e)return t[n];return null},r.prototype._fit=function(t,e,n){function r(t,e,n,r,i){var o=-r,s=-e,a=Math.cos(i),u=Math.sin(i),h=a*(n-t)+u*(o-s)+t,c=a*(o-s)-u*(n-t)+s;return{x:h,y:-c}}if(t&&t.length){var i={x0:Number.MAX_VALUE,x1:-Number.MAX_VALUE,y0:Number.MAX_VALUE,y1:-Number.MAX_VALUE};t.forEach(function(t){i.x0=Math.min(i.x0,t.x),i.x1=Math.max(i.x1,t.x),i.y0=Math.min(i.y0,t.y),i.y1=Math.max(i.y1,t.y)});var o={x:i.x1-i.x0,y:i.y1-i.y0},s={distance:0,node:null};t.forEach(function(t){var e=t.x-o.x,n=t.y-o.y,r=Math.sqrt(e*e+n*n);s.distance<r&&(s.distance=r,s.node=t)});var a=Math.atan2(-s.node.y+o.y,s.node.x-o.x)-Math.atan2(-n,e);t.forEach(function(t){var e=r(o.x,o.y,t.x,t.y,a);t.x=e.x,t.y=e.y}),i={x0:Number.MAX_VALUE,x1:-Number.MAX_VALUE,y0:Number.MAX_VALUE,y1:-Number.MAX_VALUE},t.forEach(function(t){i.x0=Math.min(i.x0,t.x-.5*t.width),i.x1=Math.max(i.x1,t.x+.5*t.width),i.y0=Math.min(i.y0,t.y-.5*t.height),i.y1=Math.max(i.y1,t.y+.5*t.height)}),t.forEach(function(t){t.x=t.x-i.x0,t.y=t.y-i.y0})}},e.exports=r},{"./personas.core.point2d.js":5,"./personas.layout.layoutSystem.js":10,webcola:24}],10:[function(t,e,n){"use strict";function r(){i.call(this)}var i=t("./personas.core.node.js");r.prototype=Object.create(i.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"objectCount",{get:function(){throw new Error("not implemented")}}),r.prototype.addObject=function(t,e){throw new Error("not implemented")},r.prototype.removeObject=function(t){throw new Error("not implemented")},r.prototype.removeAllObjects=function(){throw new Error("not implemented")},r.prototype.containsObject=function(t){throw new Error("not implemented")},r.prototype.forEach=function(t){throw new Error("not implemented")},r.prototype.positionObjects=function(t){throw new Error("not implemented")},r.prototype.invalidate=function(){throw new Error("not implemented")},e.exports=r},{"./personas.core.node.js":3}],11:[function(t,e,n){"use strict";function r(t){i.call(this),this.mInnerRadius=t||0,this.mOuterRadiusOffset=0,this.mFilledAngle=0,this.mObjects=[],this.mParent=null,this.mDistributeEvenly=!0,this.mAngleOffset=0}var i=t("./personas.core.node.js"),o=t("./personas.core.point2d.js");r.prototype=Object.create(i.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"innerRadius",{get:function(){return this.mInnerRadius},set:function(t){t!==this.mInnerRadius&&(this.mInnerRadius=t,this._positionObjects())}}),Object.defineProperty(r.prototype,"radius",{get:function(){return this.mInnerRadius+this.mOuterRadiusOffset}}),Object.defineProperty(r.prototype,"distributeEvenly",{get:function(){return this.mDistributeEvenly},set:function(t){this.mDistributeEvenly!==t&&(this.mDistributeEvenly=t,this._positionObjects())}}),Object.defineProperty(r.prototype,"centerRadius",{get:function(){return this.mInnerRadius+.5*this.mOuterRadiusOffset}}),Object.defineProperty(r.prototype,"parentNode",{get:function(){return this.mParent}}),Object.defineProperty(r.prototype,"objectCount",{get:function(){for(var t=this.mObjects,e=0,n=0,r=t.length;n<r;++n){var i=t[n];i.hasOwnProperty("objectCount")?e+=i.objectCount:++e}return e}}),r.prototype.addObject=function(t,e){var n=this.mObjects,r=this.mInnerRadius,i=t.radius;if(!n.length)return this.mOuterRadiusOffset=i*(r?2:1),this.mFilledAngle=this.calculateObjectAngle(i,this.centerRadius),this._wrapAndAddObject(t,this.mFilledAngle),!e&&r>0&&this._positionObjects(),!0;if(0!==r){var o=this.mFilledAngle,s=this.mOuterRadiusOffset,a=.5*s,u=2*i;if(u>s){var h=2*Math.PI;o*=h*(r+a)/(h*(r+i)),s=u,a=i}var c=this.calculateObjectAngle(i,r+a);if(o+c<=2*Math.PI)return this._wrapAndAddObject(t,c),this.mOuterRadiusOffset!==s?(this._recalculateFilledAngle(r+a),this.mOuterRadiusOffset=s):this.mFilledAngle+=c,e||this._positionObjects(),!0}return!1},r.prototype.removeObject=function(t){for(var e=this.mObjects,n=0,r=e.length;n<r;++n){var i=e[n].object;if(i===t)return i.remove(),i.mParent=null,e.splice(n,1),!0;if(i.removeObject&&i.removeObject(t))return!0}return!1},r.prototype.removeAllObjects=function(){for(var t=this.mObjects;t.length;){var e=t.pop().object;e.removeAllObjects&&e.removeAllObjects(),e.remove(),e.mParent=null}},r.prototype.containsObject=function(t){for(var e=this.mObjects,n=0,r=e.length;n<r;++n){var i=e[n].object;if(i===t||i.containsObject&&i.containsObject(t))return!0}return!1},r.prototype.forEach=function(t){for(var e=this.mObjects,n=0,r=e.length;n<r;++n){var i=e[n].object;i.forEach&&i.forEach(t),t(i)}},r.prototype.calculateObjectAngle=function(t,e){return t>e?2*Math.PI:2*Math.asin(t/e)},r.prototype.invalidate=function(){for(var t=this.mObjects,e=0,n=t.length;e<n;++e){var r=t[e].object;"function"==typeof r.invalidate&&r.invalidate()}},r.prototype._wrapAndAddObject=function(t,e){this.mObjects.push({object:t,angle:e}),this.append(t),t.mParent=this},r.prototype._recalculateFilledAngle=function(t){for(var e=this.mObjects,n=0,r=0,i=e.length;r<i;++r){var o=e[r],s=o.object.radius;o.angle=this.calculateObjectAngle(s,t),n+=o.angle}this.mFilledAngle=n},r.prototype._positionObjects=function(t){if(0===this.mInnerRadius){var e=this.mObjects[0].object;t&&e.animatePosition&&(0===e.position.x&&0===e.position.y||e.animatePosition(e.position,new o(0,0),500,mina.backout))}else{var n=this.mObjects,r=n.length,i=this.mAngleOffset,s=0,a=this.centerRadius,u=r-1;this.mDistributeEvenly?s=(2*Math.PI-this.mFilledAngle)/r:i-=.5*this.mFilledAngle-.5*n[0].angle;for(var h=0;h<r;++h){var c=n[h],l=Math.cos(i)*a,p=Math.sin(i)*a;if(t&&c.object.animatePosition){var f=c.object.position;if(l!==f.x||p!==f.y){var d=new o(l,p);c.object.animatePosition(f,d,500,mina.backout)}}else c.object.position.set(l,p);h<u&&(i+=s+.5*c.angle+.5*n[h+1].angle)}}},e.exports=r},{"./personas.core.node.js":3,"./personas.core.point2d.js":5}],12:[function(t,e,n){"use strict";function r(t){o.call(this),this.mPadding=t||0,this.mOrbits=[],this.mDrawInnerOrbits=!1,this.mDrawCenterOrbits=!1,this.mDrawOuterOrbits=!1,this.mInnerOrbits=[],this.mCenterOrbits=[],this.mOuterOrbits=[],this.mInnerOrbitsGroup=new i,this.mCenterOrbitsGroup=new i,this.mOuterOrbitsGroup=new i,this.append(this.mInnerOrbitsGroup),this.append(this.mCenterOrbitsGroup),this.append(this.mOuterOrbitsGroup);var e=new s;this.mOrbits.push(e),this.append(e),e.mParent=this}var i=t("./personas.core.node.js"),o=t("./personas.layout.layoutSystem.js"),s=t("./personas.layout.orbit.js");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"radius",{get:function(){return this.mOrbits[this.mOrbits.length-1].radius}}),Object.defineProperty(r.prototype,"orbitPadding",{get:function(){return this.mPadding},set:function(t){if(t!==this.mPadding){this.mPadding=t;for(var e=1,n=this.mOrbits.length;e<n;++e)this.mOrbits[e].innerRadius=this.mOrbits[e-1].radius+t}}}),Object.defineProperty(r.prototype,"objectCount",{get:function(){for(var t=this.mOrbits,e=0,n=0,r=t.length;n<r;++n){var i=t[n];e+=i.objectCount}return e}}),Object.defineProperty(r.prototype,"drawInnerOrbits",{get:function(){return this.mDrawInnerOrbits},set:function(t){t!==this.mDrawInnerOrbits&&(this.mDrawInnerOrbits=t,t?this._drawOrbits("innerRadius",this.mInnerOrbitsGroup,this.mInnerOrbits,"#FF0000"):this._removeDrawnOrbits(this.mInnerOrbits))}}),Object.defineProperty(r.prototype,"drawCenterOrbits",{get:function(){return this.mDrawCenterOrbits},set:function(t){t!==this.mDrawCenterOrbits&&(this.mDrawCenterOrbits=t,t?this._drawOrbits("centerRadius",this.mCenterOrbitsGroup,this.mCenterOrbits,"#00FF00"):this._removeDrawnOrbits(this.mCenterOrbits))}}),Object.defineProperty(r.prototype,"drawOuterOrbits",{get:function(){return this.mDrawOuterOrbits},set:function(t){t!==this.mDrawOuterOrbits&&(this.mDrawOuterOrbits=t,t?this._drawOrbits("radius",this.mOuterOrbitsGroup,this.mOuterOrbits,"#0000FF"):this._removeDrawnOrbits(this.mOuterOrbits))}}),r.prototype.addObject=function(t,e){for(var n=this.mOrbits,r=n[n.length-1];!r.addObject(t,e);)r=new s(r.radius+this.mPadding),n.push(r),this.append(r),r.mParent=this;this.drawInnerOrbits&&(this.drawInnerOrbits=!1,this.drawInnerOrbits=!0),this.drawCenterOrbits&&(this.drawCenterOrbits=!1,this.drawCenterOrbits=!0),this.drawOuterOrbits&&(this.drawOuterOrbits=!1,this.drawOuterOrbits=!0)},r.prototype.removeObject=function(t){for(var e=this.mOrbits,n=0,r=e.length;n<r;++n)if(e[n].removeObject(t))return!0;return!1},r.prototype.removeAllObjects=function(){for(var t=this.mOrbits,e=null;t.length;)e=t.pop(),e.removeAllObjects(),e.remove();e=new s,this.mOrbits.push(e),this.append(e),e.mParent=this},r.prototype.containsObject=function(t){for(var e=!1,n=this.mOrbits,r=0,i=n.length;r<i&&!(e=n[r].containsObject(t));++r);return e},r.prototype.forEach=function(t){for(var e=this.mOrbits,n=0,r=e.length;n<r;++n)e[n].forEach(t)},r.prototype.positionObjects=function(t){for(var e=this.mOrbits,n=0,r=e.length;n<r;++n)e[n]._positionObjects(t||!1)},r.prototype.invalidate=function(){for(var t=this.mOrbits,e=0,n=t.length;e<n;++e)t[e].invalidate()},r.prototype._drawOrbits=function(t,e,n,r){for(var i=this.mOrbits,o=0,s=i.length;o<s;++o)this._drawOrbit(i[o][t],e,n,r)},r.prototype._drawOrbit=function(t,e,n,r){var i=e.circle(0,0,t);i.attr({fill:"transparent",stroke:r,"stroke-width":2}),n.push(i)},r.prototype._removeDrawnOrbits=function(t){for(var e=0,n=t.length;e<n;++e)t[e].remove();t.length=0},e.exports=r},{"./personas.core.node.js":3,"./personas.layout.layoutSystem.js":10,"./personas.layout.orbit.js":11}],13:[function(t,e,n){(function(n){"use strict";function r(t,e,n,r){o.call(this),this.mConfig=e,this.mMinScale=n||.5,this.mMaxScale=r||2,this.mWheelZoomStep=.05,this.mPaper=t,this.mCanDrag=!1,this.mDragging=!1,this.mMutationObserver=null,this.mEventCenter=e.eventCenter,this.mHandleClickBound=this.handleClick.bind(this),this.mHandleWheelBound=this.handleWheel.bind(this),this.mHandlePinchBound=this.handlePinch.bind(this),this.mHandleMouseLeaveBound=this.handleMouseLeave.bind(this),this.m$Paper=i(this.mPaper.node),this._updateMeasurements();var s=this.transform().localMatrix;this.mCurrentZoom=Math.sqrt(s.a*s.a+s.c*s.c),this.registerEvents()}var i="undefined"!=typeof window?window.$:"undefined"!=typeof n?n.$:null,o=t("./personas.core.node"),s=t("./personas.defaults").Persona.events,a=t("./personas.core.point2d");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"minZoomScale",{get:function(){return this.mMinScale}}),Object.defineProperty(r.prototype,"maxZoomScale",{get:function(){return this.mMaxScale}}),Object.defineProperty(r.prototype,"center",{get:function(){var t=i(this.mPaper.node);return new a(.5*t.width(),.5*t.height())}}),Object.defineProperty(r.prototype,"zoomAmount",{get:function(){return this.mCurrentZoom},set:function(t){this.mCurrentZoom=t}}),r.prototype.registerEvents=function(){this.mPaper.click(this.mHandleClickBound),this.mPaper.node.addEventListener("wheel",this.mHandleWheelBound),this.mPaper.pinch(this.mHandlePinchBound);var t=null,e=0,n=0,r=0,i=0;this.mCanDrag=!1,this.mPaper.drag(function(o,s){this.mCanDrag&&(r=e+o,i=n+s,t.e=r,t.f=i,this.transform(t),this.mDragging=!0)}.bind(this),function(){arguments[2]&&0!==arguments[2].button||(this.mCanDrag=!0,t=this.transform().localMatrix.clone(),e=t.e,n=t.f)}.bind(this),function(t){this.mCanDrag=!1,t&&0!==t.button||setTimeout(function(){this.mDragging=!1}.bind(this),0)}.bind(this)),this.mPaper.node.addEventListener("mouseleave",this.mHandleMouseLeaveBound),this.mPaper.mousedown(this.handleMouseDown);var o=null;this.mMutationObserver=new MutationObserver(function(){"msAnimationDelay"in document.body.style?(null!==o&&clearTimeout(o),o=setTimeout(function(){this.remove(),this.mPaper.prepend(this),o=null}.bind(this),50)):(this.remove(),this.mPaper.prepend(this))}.bind(this)),this.mMutationObserver.observe(this.node,{attributes:!0})},r.prototype.unregisterEvents=function(){this.mPaper.unclick(this.mHandleClickBound),this.mPaper.unpinch(this.mHandlePinchBound),this.mPaper.unmousedown(this.handleMouseDown),this.mPaper.undrag(),this.mPaper.node.removeEventListener("wheel",this.mHandleWheelBound),this.mPaper.node.removeEventListener("mouseleave",this.mHandleMouseLeaveBound),this.mMutationObserver&&(this.mMutationObserver.disconnect(),this.mMutationObserver=null)},r.prototype.zoom=function(t,e,n,r){var i,o=this.transform().localMatrix,a=Math.sqrt(o.a*o.a+o.c*o.c),u=Snap.matrix(),h=(e.x-o.e)/a,c=(e.y-o.f)/a;i=r?t:a+t,i>this.mMaxScale?i=this.mMaxScale:i<this.mMinScale&&(i=this.mMinScale),i!==a&&(this.mCurrentZoom=i,u.translate(e.x,e.y),u.scale(i),u.translate(-h,-c),n?(this.stop(),this.animate({transform:u},150)):this.transform(u.toString()),this.mEventCenter.publish(s.zoomUpdateFromUser,this.mCurrentZoom))},r.prototype.handleClick=function(t){this.mDragging||("function"==typeof this.mConfig.hooks.onClickEmptySpace?this.mConfig.hooks.onClickEmptySpace(t):this.mEventCenter.publish(s.deselectAll))},r.prototype.handleWheel=function(t){if(0!==t.deltaY){t.preventDefault(),this._updateMeasurements();var e=t.deltaY>0?1:-1,n=this.mWheelZoomStep*e,r=(t.pageX-this.mSvgOffsetX)/this.mSvgScaleX,i=(t.pageY-this.mSvgOffsetY)/this.mSvgScaleY;this.zoom(-n,new a(r,i))}},r.prototype.handlePinch=function(t,e){var n=this._.bboxwt,r=e/(.125*(n.width+n.height));this._updateMeasurements(),this.zoom(r,new a((t.x-this.mSvgOffsetX)/this.mSvgScaleX,(t.y-this.mSvgOffsetY)/this.mSvgScaleY))},r.prototype.handleMouseLeave=function(){this.mCanDrag=!1,this.mDragging=!1},r.prototype.handleMouseDown=function(t){t.preventDefault(),t.stopPropagation()},r.prototype._updateMeasurements=function(){var t=this.mPaper.node.getBoundingClientRect();this.mSvgOffsetX=this.m$Paper.offset().left,this.mSvgOffsetY=this.m$Paper.offset().top,this.mSvgScaleX=t.width/this.m$Paper.width(),this.mSvgScaleY=t.height/this.m$Paper.height()},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./personas.core.node":3,"./personas.core.point2d":5,"./personas.defaults":7}],14:[function(t,e,n){"use strict";function r(t,e,n,r){i.apply(this),this.mConfig=t.Persona,this.mButtonSide=24,this.mHalfButtonSide=.5*this.mButtonSide,this.mSymbolsOffset=5,this.mZoomInCallback=e,this.mZoomOutCallback=n,this.mHomeCallback=r,this.$node=$(this.node),this.addClass(this.mConfig.classes.zoomcontrols),this.mBackground=new i("rect"),this.mBackground.attr({x:0,y:0,width:this.mButtonSide,height:3*this.mButtonSide}),this.append(this.mBackground),this.mDivider01=new i("line",{x1:0,y1:this.mButtonSide,x2:this.mButtonSide,y2:this.mButtonSide}),this.append(this.mDivider01),this.mDivider02=new i("line",{x1:0,y1:2*this.mButtonSide,x2:this.mButtonSide,y2:2*this.mButtonSide}),this.append(this.mDivider02),this.mPlus=new i("text",{x:this.mHalfButtonSide,y:this.mHalfButtonSide+this.mSymbolsOffset}),this.mPlus.attr({text:"","text-anchor":"middle","pointer-events":"none"}),this.mPlus.addClass(this.mConfig.classes.zoomcontrolslabel),this.mPlus.addClass(this.mConfig.classes.unselectable),this.append(this.mPlus),this.mFit=new i("text",{x:this.mHalfButtonSide,y:this.mButtonSide+this.mHalfButtonSide+this.mSymbolsOffset}),this.mFit.attr({text:"","text-anchor":"middle","pointer-events":"none"}),this.mFit.addClass(this.mConfig.classes.zoomcontrolslabel),this.mFit.addClass(this.mConfig.classes.unselectable),this.append(this.mFit),this.mMinus=new i("text",{x:this.mHalfButtonSide,y:2*this.mButtonSide+this.mHalfButtonSide+this.mSymbolsOffset}),this.mMinus.attr({text:"","text-anchor":"middle","pointer-events":"none"}),this.mMinus.addClass(this.mConfig.classes.zoomcontrolslabel),this.mMinus.addClass(this.mConfig.classes.unselectable),this.append(this.mMinus),this.registerEvents()}var i=t("./personas.core.node");r.prototype=Object.create(i.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"width",{get:function(){return this.mButtonSide}}),Object.defineProperty(r.prototype,"height",{get:function(){return 3*this.mButtonSide}}),r.prototype.registerEvents=function(){this.mBackground.click(this.handleClick.bind(this))},r.prototype.unregisterEvents=function(){this.mBackground.unclick()},r.prototype.handleClick=function(t,e,n){t&&t.stopPropagation();var r=n-this.$node.offset().top,i=this.$node[0].getBoundingClientRect(),o=i.height/3;r<=o?this.mZoomInCallback&&this.mZoomInCallback():r<=2*o?this.mHomeCallback&&this.mHomeCallback():this.mZoomOutCallback&&this.mZoomOutCallback()},e.exports=r},{"./personas.core.node":3}],15:[function(t,e,n){(function(n){"use strict";function r(t,e,n,r){o.call(this),this.mRadius=e,this.mFilter=null,this.mImages=null,this.mBlurEnabled=!0,this.mImageURLs=[],this.mBlurStrength=5,this.mImageRadius=0;var s;if(n)if(void 0===r||r){var a=parseInt(n.substr(1),16),u=a>>16&255,h=a>>8&255,c=255&a,l=Math.floor((u+h+c)/3*.7),p=l.toString(16);s="#"+p+p+p}else s=n;else s="#333";this.mBackground=new o("circle",{cx:0,cy:0,r:e}),this.mBackground.attr({fill:s,stroke:"#fff","stroke-width":3}),this.append(this.mBackground),t instanceof Array?Array.prototype.push.apply(this.mImageURLs,t):this.mImageURLs.push(t),this.mContainer=new o,this.mContainer.addClass("prsnas_nopointer"),this.append(this.mContainer);var f=this.mBlurStrength,d=i.parse(i.filter.blur(f,f));d.node.firstChild.setAttribute("color-interpolation-filters","sRGB");var m=new o("filter");m.append(d),this.mContainer.append(m),this.mContainer.attr({filter:m}),this.mFilter=m,this.mMask=new o("circle",{cx:0,cy:0,r:e}),this.mMask.attr("fill","#fff"),this.mContainer.attr({mask:this.mMask});var g=e+2*f;this.mImageRadius=g,this.mContainer.attr({display:"none"}),this.loadImages(this.mContainer,g,t).then(function(t){this.mImages=t,this.mContainer.attr({display:"block"})}.bind(this))}var i=t("snapsvg"),o=t("./personas.core.node.js"),s="undefined"!=typeof window?window.$:"undefined"!=typeof n?n.$:null,a=t("bluebird");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"blurEnabled",{get:function(){return this.mBlurEnabled},set:function(t){t!==this.mBlurEnabled&&(this.mBlurEnabled=t,this.mContainer.attr({filter:t?this.mFilter:null}))}}),Object.defineProperty(r.prototype,"images",{get:function(){return this.mImages}}),Object.defineProperty(r.prototype,"imageURLs",{get:function(){return this.mImageURLs}}),Object.defineProperty(r.prototype,"radius",{get:function(){return this.mRadius},set:function(t){this.setRadius(t,!1)}}),Object.defineProperty(r.prototype,"imageRadius",{get:function(){return this.mImageRadius}}),Object.defineProperty(r.prototype,"imageContainer",{get:function(){return this.mContainer}}),r.prototype.setRadius=function(t,e){if(t!==this.mRadius){var n=t/this.mRadius;this.mRadius=t,this.mImageRadius=this.mRadius+2*this.mBlurStrength,e?(this.mBackground.animate({r:t},500,mina.easeinout),this.mMask.animate({r:t},500,mina.easeinout)):(this.mBackground.attr({r:t}),this.mMask.attr({r:t}));var r=this.mImages;if(r)for(var i=0,o=r.length;i<o;++i){var s=r[i],a=parseFloat(s.attr("x")),u=parseFloat(s.attr("y")),h=parseFloat(s.attr("width")),c=parseFloat(s.attr("height"));e?s.animate({x:a*n,y:u*n,width:h*n,height:c*n},500,mina.easeinout):s.attr({x:a*n,y:u*n,width:h*n,height:c*n})}}},r.prototype.preloadImage=function(t){return new a(function(e){var n=s("<img />");n.on("load",function(){e(n[0])}),n.on("error",function(){e(null)}),n.attr("src",t)})},r.prototype.loadImage=function(t,e,n,r,i,o){var s=this.preloadImage;return new a(function(a){s(e).then(function(s){if(s){var u=Math.max(i/s.width,o/s.height),h=t.image(e,n,r,s.width*u,s.height*u);a(h)}else a(null)})})},r.prototype.loadImages=function(t,e,n){var r=[];n instanceof Array?Array.prototype.push.apply(r,n):r.push(n);var i=2*e,o=r.shift(),s=[],u=this.loadImage.bind(this),h=function(n){u(t,o,-e,-e,i,i).then(function(a){if(a){s.push(a);var c=-e,l=.4*e,p=i/(r.length||1),f=.3*i,d=r.length,m=[],g=function(){if(r.length)o=r.shift(),u(t,o,c,l,p,f).then(function(t){t&&(s.push(t),m.push(t),c+=p),g()});else{if(m.length&&m.length!==d){c=-e,p=i/m.length,f=.3*i;for(var a=0,h=m.length;a<h;++a){var v=m[a],y=parseInt(v.attr("width"),10),_=parseInt(v.attr("height"),10),b=Math.max(p/y,f/_);v.attr({x:c,width:y*b,height:_*b}),c+=p}}n(s)}};g()}else r.length&&(o=r.shift(),h(n))})};return new a(h)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./personas.core.node.js":3,bluebird:20,snapsvg:22}],16:[function(t,e,n){"use strict";function r(t,e,n,r){o.call(this),this.mOptions=r,this.mRadius=t,this.mThickness=e,this.mGaugeRadius=t-Math.ceil(.5*e),this.mBackground=null,this.mCircumference=Math.PI*this.mGaugeRadius*2,this.mBars={},this.mBarsArray=[],this.mBarsContainer=new o,this.mBaseColor=n;var i=new o("circle",{cx:0,cy:0,r:this.mGaugeRadius-1});i.attr({"pointer-events":"none",fill:"transparent",stroke:n,"stroke-width":e+2}),this.append(i),this.mBackground=i,this.append(this.mBarsContainer);var s={x1:0,y1:-t-e,x2:0,y2:-t+e,stroke:"#283100","stroke-width":2,"pointer-events":"none"};this.mStartLine=new o("line",s),this.append(this.mStartLine)}var i=t("snapsvg"),o=t("./personas.core.node.js"),s=t("bluebird");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"radius",{get:function(){return this.mRadius},set:function(t){this.setRadius(t,!1)}}),Object.defineProperty(r.prototype,"progress",{get:function(){return this.progressToBar(-1)}}),r.prototype.setRadius=function(t,e,n){if(t!==this.mRadius){var r=[],o=this.mCircumference;this.mRadius=t,this.mGaugeRadius=t-Math.ceil(.5*this.mThickness);var a=Math.PI*this.mGaugeRadius*2,u=this.mOptions.config.gaugeSeparatorWidth,h=this.mCircumference,c=this.mBars,l=this.mOptions.config.transitionsDuration,p=mina.easeinout;e&&n&&(l=n.duration||l,p=n.easing||p),e?(r.push(new s(function(t){this.mBackground.animate({r:this.mGaugeRadius-1},l,p,t)}.bind(this))),r.push(new s(function(e){this.mStartLine.animate({y1:-t-this.mThickness,y2:-t+this.mThickness},l,p,e)}.bind(this)))):(this.mBackground.attr({r:this.mGaugeRadius-1}),this.mStartLine.attr({y1:-t-this.mThickness,y2:-t+this.mThickness}),r.push(s.resolve(!0)));var f=function(t,e){t.bar.animate({r:this.mGaugeRadius},l,p,e),t.separator&&t.separator.animate({r:this.mGaugeRadius},l,p)},d=function(t,e,n){if(this.mCircumference=n,t.bar.attr({"stroke-dashoffset":.25*n,"stroke-dasharray":n*t.currentValue+" "+n*(1-t.currentValue)}),t.separator){var r=t.currentValue+(t.currentValue>0?u:0);t.separator.attr({"stroke-dashoffset":.25*n,"stroke-dasharray":n*(t.currentValue+r)+" "+n*(1-(t.currentValue+r))})}e()},m=function(t,e){i.animate(o,a,d.bind(this,t,e),l,p)};for(var g in c)if(c.hasOwnProperty(g)){var v=c[g];if(e)r.push(new s(f.bind(this,v))),r.push(new s(m.bind(this,v)));else if(this.mCircumference=a,v.bar.attr({r:this.mGaugeRadius,"stroke-dashoffset":.25*h,"stroke-dasharray":h*v.currentValue+" "+h*(1-v.currentValue)}),v.separator){var y=v.currentValue+(v.currentValue>0?u:0);v.separator.attr({r:this.mGaugeRadius,"stroke-dashoffset":.25*h,"stroke-dasharray":h*(v.currentValue+y)+" "+h*(1-(v.currentValue+y))})}}return s.all(r)}return s.resolve(!0)},r.prototype.progressToBar=function(t){var e=parseInt(t,10);if(isNaN(e)){if(!this.hasBarWithId(t))return 0;e=this.mBars[t].index}for(var n=this.mBarsArray,r=0,i=n.length-1;i>e;--i){var o=n[i];o&&(r+=o.progress)}return r},r.prototype.addBar=function(t,e,n,r){var s=this.mCircumference,a=null;this.mOptions.config.renderGaugeSeparators&&(a=new o("circle",{cx:0,cy:0,r:this.mGaugeRadius}),a.attr({"pointer-events":"none",fill:"transparent",stroke:this.mBaseColor,"stroke-width":this.mThickness-2,"stroke-dasharray":"0 "+s,"stroke-dashoffset":.25*s}));var u=new o("circle",{cx:0,cy:0,r:this.mGaugeRadius});u.attr({"pointer-events":"none",fill:"transparent",stroke:n,"stroke-width":this.mThickness-2,"stroke-dasharray":"0 "+s,"stroke-dashoffset":.25*s});var h=this.mBarsContainer;a&&h.append(a),h.append(u);for(var c=this.mBarsArray,l=0,p=0,f=c.length;p<f;++p){var d=c[p];d&&(d.index=p+1,l+=d.progress,d.separator&&h.append(d.separator),h.append(d.bar))}var m={id:t,index:0,color:n,progress:e,progressOffset:l,currentValue:0,bar:u,separator:a,animation:null};this.mBars[t]=m,this.mBarsArray.unshift(m);var g=this.mOptions.config.gaugeSeparatorWidth,v=parseFloat(r);v=isNaN(v)?0:v,m.animation=i.animate(v,e+l,function(t){if(m.currentValue=t,u.attr({"stroke-dasharray":s*t+" "+s*(1-t)}),a){var e=t+(t>0?g:0);a.attr({"stroke-dasharray":s*e+" "+s*(1-e)})}},this.mOptions.config.transitionsDuration,mina.linear,function(){m.animation=null})},r.prototype.updateBar=function(t,e,n,r,o){var s=this.mBars[t];if(s){var a,u=this.mBarsArray,h=this.progressToBar(s.index),c=this._parseColor(getComputedStyle(s.bar.node).stroke),l=this._parseColor(n);if(e!==s.progress||h!==s.progressOffset||c.r!==l.r||c.g!==l.g||c.b!==l.b||c.a!==l.a){var p=s.bar;s.animation&&s.animation.stop();var f=s.separator,d=this.mOptions.config.gaugeSeparatorWidth;if(r){var m={r:l.r-c.r,g:l.g-c.g,b:l.b-c.b,a:l.a-c.a},g=s.currentValue,v=e+h-g;s.animation=i.animate(0,1,function(t){var e="rgba("+(c.r+m.r*t)+","+(c.g+m.g*t)+","+(c.b+m.b*t)+","+(c.a+m.a*t)+")",n=g+v*t;s.currentValue=n,p.attr({"stroke-dasharray":this.mCircumference*n+" "+this.mCircumference*(1-n),stroke:e}),f&&(n+=n>0?d:0,f.attr({"stroke-dasharray":this.mCircumference*n+" "+this.mCircumference*(1-n)}))}.bind(this),this.mOptions.config.transitionsDuration,mina.linear,function(){s.animation=null,o&&o()})}else{if(s.progress=e,s.progressOffset=h,s.currentValue=e+h,p.attr({"stroke-dasharray":this.mCircumference*s.currentValue+" "+this.mCircumference*(1-s.currentValue),stroke:n}),f){var y=s.currentValue+(s.currentValue>0?d:0);f.attr({"stroke-dasharray":this.mCircumference*(s.currentValue+y)+" "+this.mCircumference*(1-(s.currentValue+y))})}o&&o()}s.progress=e,s.progressOffset=h,s.color=n}if(s.index>0)for(a=s.index-1;a>=0;--a)if(u[a]){this.updateBar(u[a].id,u[a].progress,u[a].color,r);break}}},r.prototype.removeBar=function(t,e){var n=this.mBars[t];if(n){var r,i,o=this.mBarsArray;if(e){var s=this.progressToBar(n.index);this.updateBar(t,-s,n.color,!0,function(){n.bar.remove(),n.separator&&n.separator.remove()})}else n.bar.remove(),n.separator&&n.separator.remove();for(r=n.index+1,i=o.length;r<i;++r)o[r].index=r-1;o.splice(n.index,1),delete this.mBars[t]}},r.prototype.removeAllBars=function(){var t=this.mBars;for(var e in t)t.hasOwnProperty(e)&&(t[e].bar.remove(),t[e]=null,delete t[e]);this.mBarsArray.length=0},r.prototype.changeBarId=function(t,e,n){if(this.hasBarWithId(t)){if(this.hasBarWithId(e)){if(!n)return!1;for(var r=e+"_old";!this.changeBarId(e,r,!1);)r+="_old"}return this.mBars[e]=this.mBars[t],this.mBars[e].id=e,delete this.mBars[t],!0}return!1},r.prototype.hasBarWithId=function(t){return Boolean(this.mBars.hasOwnProperty(t)&&this.mBars[t].bar)},r.prototype._parseColor=function(t){if(0===t.indexOf("rgb("))return this._parseRGBAComponents(t.substr(4,t.indexOf(")")));if(0===t.indexOf("rgba("))return this._parseRGBAComponents(t.substr(5,t.indexOf(")")));var e=document.createElement("div");if(e.style.color=t,0===e.style.color.indexOf("rgb"))return this._parseColor(e.style.color);var n=getComputedStyle(e).color;return 0===n.indexOf("rgb")?this._parseColor(n):{r:255,g:255,b:0,a:1}},r.prototype._parseRGBAComponents=function(t){var e=t.split(",");return{r:parseInt(e[0],10),g:parseInt(e[1],10),b:parseInt(e[2],10),a:e.length>=4?parseFloat(e[3]):1}},e.exports=r},{"./personas.core.node.js":3,bluebird:20,snapsvg:22}],17:[function(t,e,n){(function(n){"use strict";function r(t,e,n,r,i){s.call(this),this.mConfig=r,this.mPersonaOptions=this.mConfig.Persona,this.mParent=null,this.mEventCenter=r.eventCenter,this.mEventTracker=new l(this.mEventCenter),this.mSize=t,this.mRadius=.5*t,this.mBorder=this.mPersonaOptions.layout.selectedBorder,this.mRadiusNoBorder=this.mRadius-this.mBorder,this.mData=e,this.mIsSelected=!1,this.mDrag=new p,this.mDragging=!1,this.mCanDrag=!1,this.mMergeEnabled=this.mPersonaOptions.config.mergeEnabled,this.mMoveEnabled=this.mPersonaOptions.config.moveEnabled,this.mMergeCandidates=[],this.mAnimationDurationBase=this.mPersonaOptions.config.animationsDurationBase,this.mMergeOverlapRatio=this.mPersonaOptions.config.mergeOverlapRatio,this.mMergeScaleRatio=this.mPersonaOptions.config.mergeScaleRatio,this.mShouldPopIn=!1,this.mAppendedGauges=[],this.mInVisualFocus=!0,this.mVisualFocusFilter=null,this.mVisualFocusAnimation=null,this.mMutationObserver=null,this.mEntityRefs=i,this.mVisualFocusEffectEnabled=this.mPersonaOptions.config.subSelectEffectEnabled,"subSelect"in this.mPersonaOptions.config&&(this.mVisualFocusEffectEnabled=Boolean(this.mPersonaOptions.config.subSelect.blur)||Boolean(this.mPersonaOptions.config.subSelect.gray)),this.mVisualFocusEffectCompatibilityMode=this.mPersonaOptions.config.subSelectEffectCompatibilityMode,this.mVisualFocusGrayScaleAmount=.85,this.mVisualFocusOpacityAmount=.3,this.mIsEdge="msTouchSelect"in document.body.style&&!("msTouchAction"in document.body.style),this.mContainer=new s,this.append(this.mContainer),this.mBackground=new s("circle",{x:0,y:0,r:this.mRadiusNoBorder}),this.mContainer.append(this.mBackground),this.isSelected=this.mIsSelected,this.mAppendedGaugesContainer=new s,this.mContainer.append(this.mAppendedGaugesContainer),this.mGauge=new u(this.mRadiusNoBorder,this.mPersonaOptions.layout.progressHeight,this.mPersonaOptions.pie.baseColor,this.mPersonaOptions),this.initializeGauge(this.mGauge,e.properties,e.totalCount,n,i),this.mContainer.append(this.mGauge);var o;o=e.primaryProperty&&e.primaryProperty.backgroundColor?e.primaryProperty.backgroundColor:this.mPersonaOptions.config.autoGenerateFallbackColors&&e.primaryProperty&&e.primaryProperty.color?e.primaryProperty.color:this.mPersonaOptions.config.fallbackBackgroundColor,this.mAvatar=new a(e.imageUrl,Math.ceil(this.mRadiusNoBorder-this.mPersonaOptions.layout.progressHeight),o,this.mPersonaOptions.config.forceGreyscaleBackgroundColor),this.mContainer.append(this.mAvatar),this.mLabel=new h(e.relevantName,e.formattedRelevantCount||e.relevantCount,e.formattedTotalCount||e.totalCount,this.mPersonaOptions,1.1*t),this.mContainer.append(this.mLabel),this.mEventReceiver=new s("circle",{x:0,y:0,r:this.mRadius}),this.mEventReceiver.attr({fill:"transparent"}),this.append(this.mEventReceiver),
this.registerEvents()}var i="undefined"!=typeof window?window._:"undefined"!=typeof n?n._:null,o=t("snapsvg"),s=t("./personas.core.node.js"),a=t("./personas.persona.avatar.js"),u=t("./personas.persona.gauge.js"),h=t("./personas.persona.label.js"),c=t("./personas.defaults").Persona.events,l=t("./personas.core.eventTracker"),p=t("./personas.core.point2d.js"),f=t("./personas.core.vector2d.js"),d=t("bluebird");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"parentNode",{get:function(){return this.mParent}}),Object.defineProperty(r.prototype,"radius",{get:function(){return this.mRadius},set:function(t){this.setRadius(t,!1)}}),Object.defineProperty(r.prototype,"size",{get:function(){return this.mSize},set:function(t){this.setRadius(.5*t,!1)}}),Object.defineProperty(r.prototype,"isSelected",{get:function(){return this.mIsSelected},set:function(t){this.mIsSelected=t,this.mBackground.toggleClass("selected",t),this.mBackground.toggleClass("unselected",!t)}}),Object.defineProperty(r.prototype,"data",{get:function(){return this.mData}}),Object.defineProperty(r.prototype,"personaId",{get:function(){return this.mData?this.mData.id:null}}),Object.defineProperty(r.prototype,"hasAppendedGauges",{get:function(){return Boolean(this.mAppendedGauges.length)}}),Object.defineProperty(r.prototype,"gauge",{get:function(){return this.mGauge}}),Object.defineProperty(r.prototype,"inVisualFocus",{get:function(){return this.mInVisualFocus},set:function(t){t!==this.mInVisualFocus&&(this.mInVisualFocus=t,this.mVisualFocusAnimation&&(this.mVisualFocusAnimation.stop(),this.mVisualFocusAnimation=null),t?(this._applyVisualFilter(1),this.mVisualFocusAnimation=o.animate(1,0,function(t){this._applyVisualFilter(t)}.bind(this),this.mPersonaOptions.config.transitionsDuration,mina.easeinout,function(){this._applyVisualFilter(0),this.mVisualFocusAnimation=null}.bind(this))):(this._applyVisualFilter(0),this.mVisualFocusAnimation=o.animate(0,1,function(t){this._applyVisualFilter(t)}.bind(this),this.mPersonaOptions.config.transitionsDuration,mina.easeinout,function(){this.mVisualFocusAnimation=null}.bind(this))))}}),r.prototype.setRadius=function(t,e){if(t!==this.mRadius){this.mRadius=t,this.mSize=2*t,this.mRadiusNoBorder=this.mRadius-this.mBorder,this.mEventReceiver.attr({r:t}),e?this.mBackground.animate({r:this.mRadiusNoBorder},this.mPersonaOptions.config.transitionsDuration,mina.easeinout):this.mBackground.attr({r:this.mRadiusNoBorder}),this.mGauge.setRadius(this.mRadiusNoBorder,e),this.mAvatar.setRadius(Math.ceil(this.mRadiusNoBorder-this.mPersonaOptions.layout.progressHeight),e);for(var n=this.mAppendedGauges,r=0,i=n.length;r<i;++r)n[r].setRadius(this.mRadiusNoBorder+this.mPersonaOptions.layout.progressHeight*(r+1),e)}},r.prototype.simpleStringHash=function(t){for(var e=0,n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return e},r.prototype.colorFromName=function(t,e,n){var r=this.simpleStringHash(t),i=16777215&r,o=i>>16&255,s=i>>8&255,a=255&i;return void 0!==e&&(o=Math.max(o,e),s=Math.max(s,e),a=Math.max(a,e)),void 0!==n&&(o=Math.min(o,n),s=Math.min(s,n),a=Math.min(a,n)),"#"+o.toString(16)+s.toString(16)+a.toString(16)},r.prototype.initializeGauge=function(t,e,n,r,i){for(var o=0,s=e.length;o<s;++o){var a=e[o];if(a.isPrimary||a.count/n>=this.mPersonaOptions.pie.minimumDisplayRatio){var u=(a.entityRefId||a.value).toString(),h=null;if(a.entityRefId&&(r.icons[a.entityRefId]?h=r.icons[a.entityRefId]:r.defaults[i[a.entityRefId].type]&&(h=r.defaults[i[a.entityRefId].type])),!h)if(a.color)h=a.color;else{if(this.mPersonaOptions.config.autoGenerateFallbackColors){var c=i[a.entityRefId].type+i[a.entityRefId].name+u;h=this.colorFromName(c,this.mPersonaOptions.config.autoColorClampMin,this.mPersonaOptions.config.autoColorClampMax)}else h=r.fallbackColor;a.color=h}t.addBar(u,a.count/n,h)}}},r.prototype.appendGauge=function(t){var e,n,r=new u(this.mRadiusNoBorder+this.mPersonaOptions.layout.progressHeight*this.mAppendedGauges.length,this.mPersonaOptions.layout.progressHeight,this.mPersonaOptions.pie.baseColor,this.mPersonaOptions);for(e=0,n=t.length;e<n;++e){var i=t[e],o=r.mBarsArray.length.toString();r.addBar(o,0,i.color),r.updateBar(o,i.percent,i.color,!0)}this.mAppendedGaugesContainer.append(r);var s=this.mAppendedGauges;for(e=s.length-1;e>=0;--e)this.mAppendedGaugesContainer.append(s[e]);this.mAppendedGauges.push(r),r.setRadius(this.mRadiusNoBorder+this.mPersonaOptions.layout.progressHeight*this.mAppendedGauges.length,!0,{duration:.8*this.mPersonaOptions.config.transitionsDuration,easing:mina.backout})},r.prototype.removeAllAppendedGauges=function(){for(var t=[],e=[],n=this.mAppendedGauges;n.length;){var r=n.pop();t.push(r.setRadius(this.mRadiusNoBorder,!0,{duration:.6*this.mPersonaOptions.config.transitionsDuration,easing:mina.backin})),e.push(r)}d.all(t).then(function(){for(;e.length;)e.pop().remove()})},r.prototype.updateData=function(t,e,n,r){this.updateGauge(e,n,r),this.updateLabel(e,t),t!==this.mSize&&this.setRadius(.5*t,!0),this.updateAvatar(e.imageUrl)},r.prototype.updateGauge=function(t,e,n){var r=this.mGauge;if(r)for(var i=t.properties,o=t.totalCount,s=r.progress,a=0,u=i.length;a<u;++a){var h=i[a],c=h.entityRefId||h.value,l=null;if(h.entityRefId&&(e.icons[h.entityRefId]?l=e.icons[h.entityRefId]:e.defaults[n[h.entityRefId].type]&&(l=e.defaults[n[h.entityRefId].type])),!l)if(h.color)l=h.color;else{if(this.mPersonaOptions.config.autoGenerateFallbackColors){var p=n[h.entityRefId].type+n[h.entityRefId].name+c;l=this.colorFromName(p,this.mPersonaOptions.config.autoColorClampMin,this.mPersonaOptions.config.autoColorClampMax)}else l=e.fallbackColor;h.color=l}r.hasBarWithId(c)?r.updateBar(c,h.count/o,l,!0):r.addBar(c,h.count/o,l,s)}},r.prototype.replaceGaugeBars=function(t,e){for(var n=this.gauge,r=t.properties,i=n.mBarsArray;i.length>r.length;)n.removeBar(i[i.length-1].id,!0);for(var o=i.length-1,s=o;s>=0;--s){var a=r[o-s],u=a.entityRefId||a.value;n.changeBarId(i[s].id,u)}this.updateGauge(t,e,this.mEntityRefs)},r.prototype.updateAvatar=function(t){var e,n,r=this.mAvatar,o=r.imageURLs,s=[];t instanceof Array?Array.prototype.push.apply(s,t):s.push(t);var a=s.length!==o.length;if(!a)for(e=0,n=s.length;e<n;++e)if(!i.contains(o,s[e])){a=!0;break}if(a){var u=r.images;if(u){for(e=0,n=u.length;e<n;++e)u[e].remove();u.length=0}o.length=0,Array.prototype.push.apply(o,s),r.loadImages(r.imageContainer,r.imageRadius,s)}},r.prototype.updateLabel=function(t,e){if(this.mLabel){var n=this.mLabel;t.relevantName!==n.name&&(n.name=t.relevantName),t.relevantCount.toString()!==n.count&&(n.count=t.relevantCount),t.totalCount.toString()!==n.totalCount&&(n.totalCount=t.totalCount),n.maxNameWidth!==1.1*e&&(n.maxNameWidth=1.1*e)}else this.mLabel=new h(t.relevantName,t.relevantCount,t.totalCount,this.mPersonaOptions,1.1*e),this.mContainer.append(this.mLabel)},r.prototype.animatePosition=function(t,e,n,r){var i=this.transform().localMatrix;i.e=e.x,i.f=e.y,this.stop(),this.animate({transform:i},n,r,function(){var n=t.changedCallback;t.changedCallback=null,t.set(e.x,e.y),t.changedCallback=n})},r.prototype.bringToFront=function(){var t=this.parentNode;if(t){t.append(this);for(var e=t.parentNode;e;)e.append(t),t=e,e=t.parentNode}else this.parent().append(this)},r.prototype.popIn=function(){this.mContainer.attr({display:"none"}),this.mShouldPopIn=!0},r.prototype.onEnter=function(){this.mShouldPopIn&&(this.mShouldPopIn=!1,this.mContainer.attr({display:"block"}),this.mContainer.scale=.1,this.mContainer.animate({transform:new o.Matrix},this.mPersonaOptions.config.transitionsDuration,mina.backout)),this.mInVisualFocus||this._applyVisualFilter(1)},r.prototype.registerEvents=function(){var t=this.mEventTracker;t.registerEvent(c.enableBlur,this.handleEnableBlur.bind(this)),t.registerEvent(c.repel,this.handleRepel.bind(this)),this.mMergeEnabled&&t.registerEvent(c.dragMoved,this.handleDragMovedMerge.bind(this)),(this.mMoveEnabled||this.mMergeEnabled)&&this.mEventReceiver.mousedown(function(t){t.preventDefault(),t.stopPropagation()}),this.mEventReceiver.click(this.handleClick.bind(this));var e=function(t,e,n){return function(){t.publish(c.hover,{id:n,hovered:e})}};this.mEventReceiver.hover(e(this.mEventCenter,!0,this.mData.id),e(this.mEventCenter,!1,this.mData.id));var n=this;(this.mMoveEnabled||this.mMergeEnabled)&&this.mEventReceiver.drag(this.handleDragMoved.bind(this),this.handleDragStarted.bind(this),function(){setTimeout(function(){n.handleDragEnded()},0)}),this.mMutationObserver=new MutationObserver(function(){this.mContainer.remove(),this.prepend(this.mContainer)}.bind(this)),this.mMutationObserver.observe(this.node,{attributes:!0})},r.prototype.unregisterEvents=function(){this.mEventTracker.unregisterAllEvents(),this.mEventReceiver.unmousedown(),this.mEventReceiver.unclick(),this.mEventReceiver.unhover(),this.mEventReceiver.undrag(),this.mMutationObserver&&(this.mMutationObserver.disconnect(),this.mMutationObserver=null)},r.prototype.handleClick=function(t){if(t&&t.stopPropagation(),!(this.mDragging||t&&0!==t.button)){var e=!this.isSelected;this.isSelected=e,this.bringToFront(),this.mEventCenter.publish(c.select,{id:this.mData.id,selected:e})}},r.prototype.handleEnableBlur=function(t){this.mAvatar.blurEnabled=t},r.prototype.handleRepel=function(t,e,n){if(t.indexOf(this)<0){var r=f.fromPoints(e,this.position),i=n+this.radius,o=i*i,s=r.lengthSQ;if(s<o){t.push(this);var a=r.length,u=i-a,h=new f(r.x/a,r.y/a),l=u*h.x,p=u*h.y;this.position.x+=l,this.position.y+=p;var d=this.position,m=this.radius,g=this.mEventCenter;setTimeout(function(){g.publish(c.repel,t,d,m)},0)}}},r.prototype.handleDragStarted=function(){arguments[2]&&0!==arguments[2].button||(this.mCanDrag=!0,this.mDragging=!1,this.mDrag.set(this.position.x,this.position.y),this.mEventCenter.publish(c.dragStarted,this,{x:this.mDrag.x,y:this.mDrag.y},this.radius))},r.prototype.handleDragMoved=function(t,e){if(this.mCanDrag){var n=this.transform().globalMatrix.split(),r=this.mDrag.x+t/n.scalex,i=this.mDrag.y+e/n.scaley;this.mDragging||(this.mDragging=!0,this.mMergeCandidates.length=0,this.bringToFront());var o=this.position;o.x=r,o.y=i,!this.mMergeEnabled&&this.mMoveEnabled&&this.mEventCenter.publish(c.repel,[this],o,this.radius),this.mEventCenter.publish(c.dragMoved,this,o,this.radius)}},r.prototype.handleDragEnded=function(){if(this.mDragging){var t=this.position;this.mMergeCandidates.length?this.merge(this.mMergeCandidates[0]):this.mMoveEnabled?this.mEventCenter.publish(c.repel,[this],t,this.radius):this.animatePosition(this.position,this.mDrag,.7*this.mAnimationDurationBase,mina.easein),this.mDragging=!1,this.mMergeCandidates.length=0,this.mEventCenter.publish(c.dragEnded,this,t,this.radius)}this.mCanDrag=!1},r.prototype.handleDragMovedMerge=function(t,e,n){if(this!==t){var r=t.mMergeCandidates,i=this.canMerge(e,n),o=r.length;!o&&i?(r.push(this),this.highlightForMerge()):o&&!i&&r[0]===this&&(r.pop(),this.unhiglightForMerge())}},r.prototype.canMerge=function(t,e){var n=this.position,r=f.fromPoints(t,n),i=r.lengthSQ,o=e+this.radius,s=Math.pow(o,2);if(i<s){var a=o-Math.min(e,this.radius)*(1-this.mMergeOverlapRatio),u=Math.sqrt(i);return u<a}return!1},r.prototype.merge=function(t){this.invalidate(),t.unhiglightForMerge();var e=o.matrix();e.e=t.position.x,e.f=t.position.y,e.scale(0),this.animate({transform:e},2*this.mAnimationDurationBase,mina.easein,function(){this.remove();var e=this.parentNode;e&&e.removeObject&&e.removeObject(this),this.mData.graphicalPersona=null,this.mEventCenter.publish(c.merged,this,t)}.bind(this))},r.prototype.highlightForMerge=function(){this.isSelected||(this.mBackground.toggleClass("selected",!0),this.mBackground.toggleClass("unselected",!1)),this.stop();var t=o.matrix();t.e=this.position.x,t.f=this.position.y,t.scale(this.mMergeScaleRatio),this.animate({transform:t},1.5*this.mAnimationDurationBase,mina.easein)},r.prototype.unhiglightForMerge=function(){this.mBackground.toggleClass("selected",this.isSelected),this.mBackground.toggleClass("unselected",!this.isSelected),this.stop();var t=o.matrix();t.e=this.position.x,t.f=this.position.y,this.animate({transform:t},this.mAnimationDurationBase,mina.easeout)},r.prototype.invalidate=function(){this.unregisterEvents()},r.prototype._applyVisualFilter=function(t){if(this.mVisualFocusEffectEnabled)if(this.mVisualFocusFilter||(this.mVisualFocusFilter=this.paper.filter(o.filter.grayscale(this.mVisualFocusGrayScaleAmount)),this.mVisualFocusFilter.attr({filterUnits:"objectBoundingBox",x:"-0.1",y:"-0.1",width:"1.2",height:"1.2"})),t){this.mIsEdge||(this.mVisualFocusFilter.node.innerHTML=o.filter.grayscale(this.mVisualFocusGrayScaleAmount*t));var e={opacity:1-(1-this.mVisualFocusOpacityAmount)*t};this.mVisualFocusEffectCompatibilityMode||(e.filter=this.mVisualFocusFilter),this.attr(e)}else this.attr({opacity:1,filter:null})},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./personas.core.eventTracker":2,"./personas.core.node.js":3,"./personas.core.point2d.js":5,"./personas.core.vector2d.js":6,"./personas.defaults":7,"./personas.persona.avatar.js":15,"./personas.persona.gauge.js":16,"./personas.persona.label.js":18,bluebird:20,snapsvg:22}],18:[function(t,e,n){"use strict";function r(t,e,n,r,s){o.call(this),this.mOptions=r,this.mShadowFilter=null,this.mNameBackground=null,this.mName=t,this.mCountGroup=null,this.mNameText=null,this.mCountText=null,this.mTotalCount=n.toString(),this.mTotalCountText=null,this.mPaper=null,this.mMaxNameWidth=s;var a=i.parse(i.filter.shadow(0,0,2,"#000000"));this.mShadowFilter=new o("filter"),this.mShadowFilter.append(a),this.append(this.mShadowFilter),this.mNameBackground=new o("rect"),this.mNameBackground.attr({"pointer-events":"none"}),this.mNameBackground.addClass(this.mOptions.classes.namecontainer),this.append(this.mNameBackground),this.mNameText=new o("text",{x:0,y:0}),this.mNameText.attr({text:t,"text-anchor":"middle","pointer-events":"none"}),this.mNameText.addClass(this.mOptions.classes.name),this.mNameText.addClass(this.mOptions.classes.unselectable),this.append(this.mNameText),this.mCountGroup=new o,this.mCountGroup.attr({filter:this.mShadowFilter}),this.append(this.mCountGroup),this.mCountText=new o("text"),this.mCountText.attr({text:e.toString(),"pointer-events":"none"}),this.mCountText.addClass(this.mOptions.classes.count),this.mCountText.addClass(this.mOptions.classes.unselectable),this.mCountGroup.append(this.mCountText),this.mOptions.config.displayTotalCountLabel&&(this.mTotalCountText=new o("text"),this.mTotalCountText.attr({text:" / "+n.toString(),filter:this.mShadowFilter,"pointer-events":"none"}),this.mTotalCountText.addClass(this.mOptions.classes.totalcount),this.mTotalCountText.addClass(this.mOptions.classes.unselectable),this.mTotalCountText.node.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.append(this.mTotalCountText))}var i=t("snapsvg"),o=t("./personas.core.node.js");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"name",{get:function(){return this.mName},set:function(t){if(this.mName=t,this.mNameText.node.textContent=t,this.mMaxNameWidth){this.trimTextToFit(this.mNameText.node,this.mMaxNameWidth);var e=this.mNameText.getBBox();this.mNameBackground.attr({x:e.x-this.mOptions.layout.textpadding,y:e.y-this.mOptions.layout.textpadding,width:e.width+2*this.mOptions.layout.textpadding,height:e.height+2*this.mOptions.layout.textpadding})}}}),Object.defineProperty(r.prototype,"count",{get:function(){return this.mCountText.node.textContent},set:function(t){if(this.mCountText.node.textContent=t,!this.mOptions.config.displayLabelsAtOneCount){var e=parseInt(t,10);e>1&&this.mCountGroup.parent()!==this?this.append(this.mCountGroup):e<=1&&this.mCountGroup.remove()}var n=this.mNameText.getBBox(),r=this.mCountText.getBBox();this.mCountText.attr({x:-(.5*r.width),y:this.mOptions.layout.textpadding+(n.y2-n.y)-n.y})}}),Object.defineProperty(r.prototype,"totalCount",{get:function(){return this.mTotalCount},set:function(t){if(this.mTotalCount=t.toString(),this.mOptions.config.displayTotalCountLabel){this.mTotalCountText.node.textContent=" / "+t;var e=this.mCountText.getBBox();this.mTotalCountText.attr({x:e.x2,y:e.y2-.5*this.mTotalCountText.getBBox().height})}}}),Object.defineProperty(r.prototype,"maxNameWidth",{get:function(){return this.mMaxNameWidth},set:function(t){if(this.mMaxNameWidth=t,this.mMaxNameWidth){this.mNameText.node.textContent=this.mName,this.trimTextToFit(this.mNameText.node,this.mMaxNameWidth);var e=this.mNameText.getBBox();this.mNameBackground.attr({x:e.x-this.mOptions.layout.textpadding,y:e.y-this.mOptions.layout.textpadding,width:e.width+2*this.mOptions.layout.textpadding,height:e.height+2*this.mOptions.layout.textpadding})}}}),r.prototype.onEnter=function(){this.mMaxNameWidth&&this.trimTextToFit(this.mNameText.node,this.mMaxNameWidth);var t=this.mNameText.getBBox();this.mNameBackground.attr({x:t.x-this.mOptions.layout.textpadding,y:t.y-this.mOptions.layout.textpadding,width:t.width+2*this.mOptions.layout.textpadding,height:t.height+2*this.mOptions.layout.textpadding});var e=parseInt(this.count,10);if(!this.mOptions.config.displayLabelsAtOneCount&&e<=1)return void this.mCountGroup.remove();var n=this.mCountText.getBBox();this.mCountText.attr({x:-(.5*n.width),y:this.mOptions.layout.textpadding+(t.y2-t.y)-t.y}),this.mOptions.config.displayTotalCountLabel&&(n=this.mCountText.getBBox(),this.mTotalCountText.attr({x:n.x2,y:n.y2-.5*this.mTotalCountText.getBBox().height}))},r.prototype.trimTextToFit=function(t,e){var n=t.textContent;try{var r;if(t.getComputedTextLength()>=e){for(r=n.length-3;r>0;r-=3)if(t.getSubStringLength(0,r)<=e)return void(t.textContent=n.substring(0,r)+"...");t.textContent="..."}}catch(i){var o,s=t.getBBox();if(s.width>e){for(o=n.length-3;o>0;o-=3)if(t.textContent=n.substring(0,o)+"...",s=t.getBBox(),s.width<=e)return;t.textContent="..."}}},e.exports=r},{"./personas.core.node.js":3,snapsvg:22}],19:[function(t,e,n){"use strict";function r(t,e,n){i.call(this),this.mConfig=n,this.mPersonaOptions=this.mConfig.Persona,this.mSize=t,this.mRadius=.5*t,this.mParent=null,this.mNameText=new i("text",{x:0,y:0}),this.mNameText.attr({"text-anchor":"middle","pointer-events":"none"}),this.mNameText.addClass(this.mPersonaOptions.classes.unselectable),this.append(this.mNameText);var r=new i("tspan");r.addClass(this.mPersonaOptions.classes.seedcount),r.node.textContent="☍"+e.count+" • ",this.mNameText.append(r);var o=new i("tspan");o.addClass(this.mPersonaOptions.classes.seedname),o.node.textContent=e.value||"Related",this.mNameText.append(o)}var i=t("./personas.core.node.js");r.prototype=Object.create(i.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"parentNode",{get:function(){return this.mParent}}),Object.defineProperty(r.prototype,"radius",{get:function(){return this.mRadius},set:function(t){this.setRadius(t,!1)}}),Object.defineProperty(r.prototype,"size",{get:function(){return this.mSize},set:function(t){this.setRadius(.5*t,!1)}}),r.prototype.setRadius=function(t,e){t!==this.mRadius&&(e||(this.mRadius=t,this.mSize=2*t))},r.prototype.animatePosition=function(t,e,n,r){var i=this.transform().localMatrix;i.e=e.x,i.f=e.y,this.stop(),this.animate({transform:i},n,r,function(){var n=t.changedCallback;t.changedCallback=null,t.x=e.x,t.y=e.y,t.changedCallback=n})},e.exports=r},{"./personas.core.node.js":3}],20:[function(e,n,r){(function(e,i){!function(e){if("object"==typeof r&&"undefined"!=typeof n)n.exports=e();else if("function"==typeof t&&t.amd)t([],e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof i?o=i:"undefined"!=typeof self&&(o=self),o.Promise=e()}}(function(){var t,n,r;return function o(t,e,n){function r(s,a){if(!e[s]){if(!t[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,o,t,e,n)}return e[s].exports}for(var i="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,n){"use strict";e.exports=function(t){function e(t){var e=new n(t),r=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),r}var n=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,n){"use strict";function r(){this._isTickUsed=!1,this._lateQueue=new c(16),this._normalQueue=new c(16),this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=h.isStatic?h(this.drainQueues):h}function i(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function o(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function s(t){this._normalQueue._pushOne(t),this._queueTick()}var a;try{throw new Error}catch(u){a=u}var h=t("./schedule.js"),c=t("./queue.js"),l=t("./util.js");r.prototype.disableTrampolineIfNecessary=function(){l.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(t){setTimeout(t,0)})},r.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},r.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(n){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},l.hasDevTools?(h.isStatic&&(h=function(t){setTimeout(t,0)}),r.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?i.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},r.prototype.invoke=function(t,e,n){this._trampolineEnabled?o.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},r.prototype.settlePromises=function(t){this._trampolineEnabled?s.call(this,t):this._schedule(function(){t._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=s),r.prototype.invokeFirst=function(t,e,n){this._normalQueue.unshift(t,e,n),this._queueTick()},r.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},e.exports=new r,e.exports.firstLineError=a},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(t,e,n){"use strict";e.exports=function(t,e,n){var r=function(t,e){this._reject(e)},i=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(r,r,null,this,t)},o=function(t,e){this._isPending()&&this._resolveCallback(e.target)},s=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(r){var a=n(r),u=new t(e);u._propagateFrom(this,1);var h=this._target();if(u._setBoundTo(a),a instanceof t){var c={promiseRejectionQueued:!1,promise:u,target:h,bindingPromise:a};h._then(e,i,u._progress,u,c),a._then(o,s,u._progress,u,c)}else u._resolveCallback(h);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=131072|this._bitField,this._boundTo=t):this._bitField=this._bitField&-131073},t.prototype._isBound=function(){return 131072===(131072&this._bitField)},t.bind=function(r,i){var o=n(r),s=new t(e);return s._setBoundTo(o),o instanceof t?o._then(function(){s._resolveCallback(i)},s._reject,s._progress,s,null):s._resolveCallback(i),s}}},{}],4:[function(t,e,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(t){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=t("./promise.js")();o.noConflict=r,e.exports=o},{"./promise.js":23}],5:[function(t,e,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}e.exports=function(e){function n(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var i="Object "+a.classString(t)+" has no method '"+a.toString(n)+"'";throw new e.TypeError(i)}return r}function r(t){var e=this.pop(),r=n(t,e);return r.apply(t,this)}function i(t){return t[this]}function o(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}var s,a=t("./util.js"),u=a.canEvaluate;a.isIdentifier;e.prototype.call=function(t){for(var e=arguments.length,n=new Array(e-1),i=1;i<e;++i)n[i-1]=arguments[i];return n.push(t),this._then(r,void 0,void 0,n,void 0)},e.prototype.get=function(t){var e,n="number"==typeof t;if(n)e=o;else if(u){var r=s(t);e=null!==r?r:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util.js":38}],6:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./errors.js"),r=t("./async.js"),i=n.CancellationError;e.prototype._cancel=function(t){if(!this.isCancellable())return this;for(var e,n=this;void 0!==(e=n._cancellationParent)&&e.isCancellable();)n=e;this._unsetCancellable(),n._target()._rejectCallback(t,!1,!0)},e.prototype.cancel=function(t){return this.isCancellable()?(void 0===t&&(t=new i),r.invokeLater(this._cancel,this,t),this):this},e.prototype.cancellable=function(){return this._cancellable()?this:(r.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},e.prototype.uncancellable=function(){var t=this.then();return t._unsetCancellable(),t},e.prototype.fork=function(t,e,n){var r=this._then(t,e,n,void 0,void 0);return r._setCancellable(),r._cancellationParent=void 0,r}}},{"./async.js":2,"./errors.js":13}],7:[function(t,n,r){"use strict";n.exports=function(){function n(t){this._parent=t;var e=this._length=1+(void 0===t?0:t._length);x(this,n),e>32&&this.uncycle()}function r(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}function i(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function o(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(var a=s;a>=0;--a){var u=r[a];if(e[i]!==u)break;e.pop(),i--}e=r}}function s(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i=m.test(r)||"    (No stack trace)"===r,o=i&&y(r);i&&!o&&(v&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function a(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||m.test(r))break}return n>0&&(e=e.slice(n)),e}function u(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t.toString();var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(e))try{var r=JSON.stringify(t);e=r}catch(i){}0===e.length&&(e="(empty array)")}return"(<"+h(e)+">, no stack trace)"}function h(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function c(t){var e=t.match(_);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}var l,p=t("./async.js"),f=t("./util.js"),d=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,m=null,g=null,v=!1;f.inherits(n,Error),n.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;t=this._length=r;for(var r=t-1;r>=0;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;r<t;++r){var s=e[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var u=r>0?e[r-1]:this;a<t-1?(u._parent=e[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var h=u._length+1,c=r-2;c>=0;--c)e[c]._length=h,h++;return}}}},n.prototype.parent=function(){return this._parent},n.prototype.hasParent=function(){return void 0!==this._parent},n.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=n.parseStackAndMessage(t),a=e.message,u=[e.stack],h=this;void 0!==h;)u.push(s(h.stack.split("\n"))),h=h._parent;o(u),i(u),f.notEnumerableProp(t,"stack",r(a,u)),f.notEnumerableProp(t,"__stackCleaned__",!0)}},n.parseStackAndMessage=function(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?a(t):["    (No stack trace)"],{message:n,stack:s(e)}},n.formatAndLogError=function(t,e){if("undefined"!=typeof console){var n;if("object"==typeof t||"function"==typeof t){var r=t.stack;n=e+g(r,t)}else n=e+String(t);"function"==typeof l?l(n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}},n.unhandledRejection=function(t){n.formatAndLogError(t,"^--- With additional stack trace: ")},n.isSupported=function(){return"function"==typeof x},n.fireRejectionEvent=function(t,e,r,i){var o=!1;try{"function"==typeof e&&(o=!0,"rejectionHandled"===t?e(i):e(r,i))}catch(s){p.throwLater(s)}var a=!1;try{a=w(t,r,i)}catch(s){a=!0,p.throwLater(s)}var u=!1;if(b)try{u=b(t.toLowerCase(),{reason:r,promise:i})}catch(s){u=!0,p.throwLater(s)}a||o||u||"unhandledRejection"!==t||n.formatAndLogError(r,"Unhandled rejection ")};var y=function(){return!1},_=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;n.setBounds=function(t,e){if(n.isSupported()){for(var r,i,o=t.stack.split("\n"),s=e.stack.split("\n"),a=-1,u=-1,h=0;h<o.length;++h){var l=c(o[h]);if(l){r=l.fileName,a=l.line;break}}for(var h=0;h<s.length;++h){var l=c(s[h]);if(l){i=l.fileName,u=l.line;break}}a<0||u<0||!r||!i||r!==i||a>=u||(y=function(t){if(d.test(t))return!0;var e=c(t);return!!(e&&e.fileName===r&&a<=e.line&&e.line<=u)})}};var b,x=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():u(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,m=t,g=e;var n=Error.captureStackTrace;return y=function(t){return d.test(t)},function(t,e){Error.stackTraceLimit=Error.stackTraceLimit+6,n(t,e),Error.stackTraceLimit=Error.stackTraceLimit-6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return m=/@/,g=e,v=!0,function(t){t.stack=(new Error).stack};var i;try{throw new Error}catch(o){i="stack"in o}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(g=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?u(e):e.toString()},null):(m=t,g=e,function(t){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6})}([]),w=function(){if(f.isNode)return function(t,n,r){return"rejectionHandled"===t?e.emit(t,r):e.emit(t,n,r)};var t=!1,n=!0;try{var r=new self.CustomEvent("test");t=r instanceof CustomEvent}catch(i){}if(!t)try{var o=document.createEvent("CustomEvent");o.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(o)}catch(i){n=!1}n&&(b=function(e,n){var r;return t?r=new self.CustomEvent(e,{detail:n,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(r=document.createEvent("CustomEvent"),r.initCustomEvent(e,!1,!0,n)),!!r&&!self.dispatchEvent(r)});var s={};return s.unhandledRejection="onunhandledRejection".toLowerCase(),s.rejectionHandled="onrejectionHandled".toLowerCase(),function(t,e,n){var r=s[t],i=self[r];return!!i&&("rejectionHandled"===t?i.call(self,n):i.call(self,e,n),!0)}}();return"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(l=function(t){console.warn(t)},f.isNode&&e.stderr.isTTY?l=function(t){e.stderr.write("[31m"+t+"[39m\n")}:f.isNode||"string"!=typeof(new Error).stack||(l=function(t){console.warn("%c"+t,"color: red")})),n}},{"./async.js":2,"./util.js":38}],8:[function(t,e,n){"use strict";e.exports=function(e){function n(t,e,n){this._instances=t,this._callback=e,this._promise=n}function r(t,e){var n={},r=s(t).call(n,e);if(r===a)return r;var i=u(n);return i.length?(a.e=new h("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),
a):r}var i=t("./util.js"),o=t("./errors.js"),s=i.tryCatch,a=i.errorObj,u=t("./es5.js").keys,h=o.TypeError;return n.prototype.doFilter=function(t){for(var n=this._callback,i=this._promise,o=i._boundValue(),u=0,h=this._instances.length;u<h;++u){var c=this._instances[u],l=c===Error||null!=c&&c.prototype instanceof Error;if(l&&t instanceof c){var p=s(n).call(o,t);return p===a?(e.e=p.e,e):p}if("function"==typeof c&&!l){var f=r(c,t);if(f===a){t=a.e;break}if(f){var p=s(n).call(o,t);return p===a?(e.e=p.e,e):p}}}return e.e=t,e},n}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(t,e,n){"use strict";e.exports=function(t,e,n){function r(){this._trace=new e(o())}function i(){if(n())return new r}function o(){var t=s.length-1;if(t>=0)return s[t]}var s=[];return r.prototype._pushContext=function(){n()&&void 0!==this._trace&&s.push(this._trace)},r.prototype._popContext=function(){n()&&void 0!==this._trace&&s.pop()},t.prototype._peekContext=o,t.prototype._pushContext=r.prototype._pushContext,t.prototype._popContext=r.prototype._popContext,i}},{}],10:[function(t,n,r){"use strict";n.exports=function(n,r){var i,o,s=n._getDomain,a=t("./async.js"),u=t("./errors.js").Warning,h=t("./util.js"),c=h.canAttachTrace,l=h.isNode&&(!!e.env.BLUEBIRD_DEBUG||"development"===e.env.NODE_ENV);return h.isNode&&0==e.env.BLUEBIRD_DEBUG&&(l=!1),l&&a.disableTrampolineIfNecessary(),n.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=16777216|this._bitField},n.prototype._ensurePossibleRejectionHandled=function(){0===(16777216&this._bitField)&&(this._setRejectionIsUnhandled(),a.invokeLater(this._notifyUnhandledRejection,this,void 0))},n.prototype._notifyUnhandledRejectionIsHandled=function(){r.fireRejectionEvent("rejectionHandled",i,void 0,this)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),r.fireRejectionEvent("unhandledRejection",o,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},n.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},n.prototype._setCarriedStackTrace=function(t){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=t},n.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},n.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},n.prototype._captureStackTrace=function(){return l&&(this._trace=new r(this._peekContext())),this},n.prototype._attachExtraTrace=function(t,e){if(l&&c(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var i=r.parseStackAndMessage(t);h.notEnumerableProp(t,"stack",i.message+"\n"+i.stack.join("\n")),h.notEnumerableProp(t,"__stackCleaned__",!0)}}},n.prototype._warn=function(t){var e=new u(t),n=this._peekContext();if(n)n.attachExtraTrace(e);else{var i=r.parseStackAndMessage(e);e.stack=i.message+"\n"+i.stack.join("\n")}r.formatAndLogError(e,"")},n.onPossiblyUnhandledRejection=function(t){var e=s();o="function"==typeof t?null===e?t:e.bind(t):void 0},n.onUnhandledRejectionHandled=function(t){var e=s();i="function"==typeof t?null===e?t:e.bind(t):void 0},n.longStackTraces=function(){if(a.haveItemsQueued()&&l===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");l=r.isSupported(),l&&a.disableTrampolineIfNecessary()},n.hasLongStackTraces=function(){return l&&r.isSupported()},r.isSupported()||(n.longStackTraces=function(){},l=!1),function(){return l}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(t,e,n){"use strict";var r=t("./util.js"),i=r.isPrimitive;e.exports=function(t){var e=function(){return this},n=function(){throw this},r=function(){},o=function(){throw void 0},s=function(t,e){return 1===e?function(){throw t}:2===e?function(){return t}:void 0};t.prototype["return"]=t.prototype.thenReturn=function(n){return void 0===n?this.then(r):i(n)?this._then(s(n,2),void 0,void 0,void 0,void 0):(n instanceof t&&n._ignoreRejections(),this._then(e,void 0,void 0,n,void 0))},t.prototype["throw"]=t.prototype.thenThrow=function(t){return void 0===t?this.then(o):i(t)?this._then(s(t,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,t,void 0)}}},{"./util.js":38}],12:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.reduce;t.prototype.each=function(t){return n(this,t,null,e)},t.each=function(t,r){return n(t,r,null,e)}}},{}],13:[function(t,e,n){"use strict";function r(t,e){function n(r){return this instanceof n?(l(this,"message","string"==typeof r?r:e),l(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(r)}return c(n,Error),n}function i(t){return this instanceof i?(l(this,"name","OperationalError"),l(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(l(this,"message",t.message),l(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(t)}var o,s,a=t("./es5.js"),u=a.freeze,h=t("./util.js"),c=h.inherits,l=h.notEnumerableProp,p=r("Warning","warning"),f=r("CancellationError","cancellation error"),d=r("TimeoutError","timeout error"),m=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(g){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<v.length;++y)"function"==typeof Array.prototype[v[y]]&&(m.prototype[v[y]]=Array.prototype[v[y]]);a.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var _=0;m.prototype.toString=function(){var t=Array(4*_+1).join(" "),e="\n"+t+"AggregateError of:\n";_++,t=Array(4*_+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];r=i.join("\n"),e+=r+"\n"}return _--,e},c(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:f,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:m}),l(Error,"__BluebirdErrorTypes__",b)),e.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:p}},{"./es5.js":14,"./util.js":38}],14:[function(t,e,n){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e},u=function(t,e){return{value:t[e]}},h=function(t,e,n){return t[e]=n.value,t},c=function(t){return t},l=function(t){try{return Object(t).constructor.prototype}catch(e){return s}},p=function(t){try{return"[object Array]"===o.call(t)}catch(e){return!1}};e.exports={isArray:p,keys:a,names:a,defineProperty:h,getDescriptor:u,freeze:c,getPrototypeOf:l,isES5:r,propertyIsWritable:function(){return!0}}}},{}],15:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,i){return n(t,r,i,e)}}},{}],16:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(){return this}function o(){throw this}function s(t){return function(){return t}}function a(t){return function(){throw t}}function u(t,e,n){var r;return r=p(e)?n?s(e):a(e):n?i:o,t._then(r,f,void 0,e,void 0)}function h(t){var i=this.promise,o=this.handler,s=i._isBound()?o.call(i._boundValue()):o();if(void 0!==s){var a=r(s,i);if(a instanceof e)return a=a._target(),u(a,t,i.isFulfilled())}return i.isRejected()?(n.e=t,n):t}function c(t){var n=this.promise,i=this.handler,o=n._isBound()?i.call(n._boundValue(),t):i(t);if(void 0!==o){var s=r(o,n);if(s instanceof e)return s=s._target(),u(s,t,!0)}return t}var l=t("./util.js"),p=l.isPrimitive,f=l.thrower;e.prototype._passThroughHandler=function(t,e){if("function"!=typeof t)return this.then();var n={promise:this,handler:t};return this._then(e?h:c,e?h:void 0,void 0,n,void 0)},e.prototype.lastly=e.prototype["finally"]=function(t){return this._passThroughHandler(t,!0)},e.prototype.tap=function(t){return this._passThroughHandler(t,!1)}}},{"./util.js":38}],17:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=l(n[o])(t);if(r._popContext(),s===c){r._pushContext();var a=e.reject(c.e);return r._popContext(),a}var u=i(s,r);if(u instanceof e)return u}return null}function s(t,n,i,o){var s=this._promise=new e(r);s._captureStackTrace(),this._stack=o,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(p):p}var a=t("./errors.js"),u=a.TypeError,h=t("./util.js"),c=h.errorObj,l=h.tryCatch,p=[];s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},s.prototype._continue=function(t){if(t===c)return this._promise._rejectCallback(t.e,!1,!0);var n=t.value;if(t.done===!0)this._promise._resolveCallback(n);else{var r=i(n,this._promise);if(!(r instanceof e)&&(r=o(r,this._yieldHandlers,this._promise),null===r))return void this._throw(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",n)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));r._then(this._next,this._throw,void 0,this,null)}},s.prototype._throw=function(t){this._promise._attachExtraTrace(t),this._promise._pushContext();var e=l(this._generator["throw"]).call(this._generator,t);this._promise._popContext(),this._continue(e)},s.prototype._next=function(t){this._promise._pushContext();var e=l(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},e.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var n=Object(e).yieldHandler,r=s,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new r((void 0),(void 0),n,i);return o._generator=e,o._next(void 0),o.promise()}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("fn must be a function\n\n    See http://goo.gl/916lJJ\n");p.push(t)},e.spawn=function(t){if("function"!=typeof t)return n("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var r=new s(t,this),i=r.promise();return r._run(e.spawn),i}}},{"./errors.js":13,"./util.js":38}],18:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util.js");o.canEvaluate,o.tryCatch,o.errorObj;e.join=function(){var t,e=arguments.length-1;if(e>0&&"function"==typeof arguments[e]){t=arguments[e];var r}for(var i=arguments.length,o=new Array(i),s=0;s<i;++s)o[s]=arguments[s];t&&o.pop();var r=new n(o).promise();return void 0!==t?r.spread(t):r}}},{"./util.js":38}],19:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){function s(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var i=h();this._callback=null===i?e:i.bind(e),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:m,c.invoke(a,this,void 0)}function a(){this._init$(void 0,-2)}function u(t,e,n,r){var i="object"==typeof n&&null!==n?n.concurrency:0;return i="number"==typeof i&&isFinite(i)&&i>=1?i:0,new s(t,e,i,r)}var h=e._getDomain,c=t("./async.js"),l=t("./util.js"),p=l.tryCatch,f=l.errorObj,d={},m=[];l.inherits(s,n),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,n){var r=this._values,o=this.length(),s=this._preservedValues,a=this._limit;if(r[n]===d){if(r[n]=t,a>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(a>=1&&this._inFlight>=a)return r[n]=t,void this._queue.push(n);null!==s&&(s[n]=t);var u=this._callback,h=this._promise._boundValue();this._promise._pushContext();var c=p(u).call(h,t,n,o);if(this._promise._popContext(),c===f)return this._reject(c.e);var l=i(c,this._promise);if(l instanceof e){if(l=l._target(),l._isPending())return a>=1&&this._inFlight++,r[n]=d,l._proxyPromiseArray(this,n);if(!l._isFulfilled())return this._reject(l._reason());c=l._value()}r[n]=c}var m=++this._totalResolved;m>=o&&(null!==s?this._filter(r,s):this._resolve(r))},s.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;o<n;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return"function"!=typeof t?r("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):u(this,t,e,null).promise()},e.map=function(t,e,n,i){return"function"!=typeof e?r("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):u(t,e,n,i).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util.js"),s=o.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var r=new e(n);r._captureStackTrace(),r._pushContext();var i=s(t).apply(this,arguments);return r._popContext(),r._resolveFromSyncValue(i),r}},e.attempt=e["try"]=function(t,r,a){if("function"!=typeof t)return i("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var u=new e(n);u._captureStackTrace(),u._pushContext();var h=o.isArray(r)?s(t).apply(a,r):s(t).call(a,r);return u._popContext(),u._resolveFromSyncValue(h),u},e.prototype._resolveFromSyncValue=function(t){t===o.errorObj?this._rejectCallback(t.e,!1,!0):this._resolveCallback(t,!0)}}},{"./util.js":38}],21:[function(t,e,n){"use strict";e.exports=function(e){function n(t,e){var n=this;if(!o.isArray(t))return r.call(n,t,e);var i=a(e).apply(n._boundValue(),[null].concat(t));i===u&&s.throwLater(i.e)}function r(t,e){var n=this,r=n._boundValue(),i=void 0===t?a(e).call(r,null):a(e).call(r,null,t);i===u&&s.throwLater(i.e)}function i(t,e){var n=this;if(!t){var r=n._target(),i=r._getCarriedStackTrace();i.cause=t,t=i}var o=a(e).call(n._boundValue(),t);o===u&&s.throwLater(o.e)}var o=t("./util.js"),s=t("./async.js"),a=o.tryCatch,u=o.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var o=r;void 0!==e&&Object(e).spread&&(o=n),this._then(o,i,void 0,this,t)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(t,e,n){"use strict";e.exports=function(e,n){var r=t("./util.js"),i=t("./async.js"),o=r.tryCatch,s=r.errorObj;e.prototype.progressed=function(t){return this._then(void 0,void 0,t,void 0,void 0)},e.prototype._progress=function(t){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(t)},e.prototype._progressHandlerAt=function(t){return 0===t?this._progressHandler0:this[(t<<2)+t-5+2]},e.prototype._doProgressWith=function(t){var n=t.value,i=t.handler,a=t.promise,u=t.receiver,h=o(i).call(u,n);if(h===s){if(null!=h.e&&"StopProgressPropagation"!==h.e.name){var c=r.canAttachTrace(h.e)?h.e:new Error(r.toString(h.e));a._attachExtraTrace(c),a._progress(h.e)}}else h instanceof e?h._then(a._progress,null,null,a,void 0):a._progress(h)},e.prototype._progressUnchecked=function(t){for(var r=this._length(),o=this._progress,s=0;s<r;s++){var a=this._progressHandlerAt(s),u=this._promiseAt(s);if(u instanceof e)"function"==typeof a?i.invoke(this._doProgressWith,this,{handler:a,promise:u,receiver:this._receiverAt(s),value:t}):i.invoke(o,u,t);else{var h=this._receiverAt(s);"function"==typeof a?a.call(h,t,u):h instanceof n&&!h._isResolved()&&h._promiseProgressed(t,u)}}}}},{"./async.js":2,"./util.js":38}],23:[function(t,n,r){"use strict";n.exports=function(){function r(t){if("function"!=typeof t)throw new f("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==r)throw new f("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,t!==d&&this._resolveFromResolver(t)}function i(t){var e=new r(d);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._progressHandler0=t,e._promise0=t,e._receiver0=t,e._settledValue=t}var o,s=function(){return new f("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},a=function(){return new r.PromiseInspection(this._target())},u=function(t){return r.reject(new f(t))},h=t("./util.js");o=h.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},h.notEnumerableProp(r,"_getDomain",o);var c={},l=t("./async.js"),p=t("./errors.js"),f=r.TypeError=p.TypeError;r.RangeError=p.RangeError,r.CancellationError=p.CancellationError,r.TimeoutError=p.TimeoutError,r.OperationalError=p.OperationalError,r.RejectionError=p.OperationalError,r.AggregateError=p.AggregateError;var d=function(){},m={},g={e:null},v=t("./thenables.js")(r,d),y=t("./promise_array.js")(r,d,v,u),_=t("./captured_trace.js")(),b=t("./debuggability.js")(r,_),x=t("./context.js")(r,_,b),w=t("./catch_filter.js")(g),C=t("./promise_resolver.js"),k=C._nodebackForPromise,P=h.errorObj,S=h.tryCatch;return r.prototype.toString=function(){return"[object Promise]"},r.prototype.caught=r.prototype["catch"]=function(t){var e=arguments.length;if(e>1){var n,i=new Array(e-1),o=0;for(n=0;n<e-1;++n){var s=arguments[n];if("function"!=typeof s)return r.reject(new f("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));i[o++]=s}i.length=o,t=arguments[n];var a=new w(i,t,this);return this._then(void 0,a.doFilter,void 0,a,void 0)}return this._then(void 0,t,void 0,void 0,void 0)},r.prototype.reflect=function(){return this._then(a,a,void 0,this,void 0)},r.prototype.then=function(t,e,n){if(b()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var r=".then() only accepts functions but was passed: "+h.classString(t);arguments.length>1&&(r+=", "+h.classString(e)),this._warn(r)}return this._then(t,e,n,void 0,void 0)},r.prototype.done=function(t,e,n){var r=this._then(t,e,n,void 0,void 0);r._setIsFinal()},r.prototype.spread=function(t,e){return this.all()._then(t,e,void 0,m,void 0)},r.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},r.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},r.prototype.all=function(){return new y(this).promise()},r.prototype.error=function(t){return this.caught(h.originatesFromRejection,t)},r.getNewLibraryCopy=n.exports,r.is=function(t){return t instanceof r},r.fromNode=function(t){var e=new r(d),n=S(t)(k(e));return n===P&&e._rejectCallback(n.e,!0,!0),e},r.all=function(t){return new y(t).promise()},r.defer=r.pending=function(){var t=new r(d);return new C(t)},r.cast=function(t){var e=v(t);if(!(e instanceof r)){var n=e;e=new r(d),e._fulfillUnchecked(n)}return e},r.resolve=r.fulfilled=r.cast,r.reject=r.rejected=function(t){var e=new r(d);return e._captureStackTrace(),e._rejectCallback(t,!0),e},r.setScheduler=function(t){if("function"!=typeof t)throw new f("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var e=l._schedule;return l._schedule=t,e},r.prototype._then=function(t,e,n,i,s){var a=void 0!==s,u=a?s:new r(d);a||(u._propagateFrom(this,5),u._captureStackTrace());var h=this._target();h!==this&&(void 0===i&&(i=this._boundTo),a||u._setIsMigrated());var c=h._addCallbacks(t,e,n,u,i,o());return h._isResolved()&&!h._isSettlePromisesQueued()&&l.invoke(h._settlePromiseAtPostResolution,h,c),u},r.prototype._settlePromiseAtPostResolution=function(t){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(t)},r.prototype._length=function(){return 131071&this._bitField},r.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},r.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},r.prototype._setLength=function(t){this._bitField=this._bitField&-131072|131071&t},r.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},r.prototype._setRejected=function(){this._bitField=134217728|this._bitField},r.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},r.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},r.prototype._isFinal=function(){return(33554432&this._bitField)>0},r.prototype._cancellable=function(){return(67108864&this._bitField)>0},r.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},r.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},r.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},r.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&-4194305},r.prototype._isMigrated=function(){return(4194304&this._bitField)>0},r.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[5*t-5+4];if(e!==c)return void 0===e&&this._isBound()?this._boundValue():e},r.prototype._promiseAt=function(t){return 0===t?this._promise0:this[5*t-5+3]},r.prototype._fulfillmentHandlerAt=function(t){return 0===t?this._fulfillmentHandler0:this[5*t-5+0]},r.prototype._rejectionHandlerAt=function(t){return 0===t?this._rejectionHandler0:this[5*t-5+1]},r.prototype._boundValue=function(){var t=this._boundTo;return void 0!==t&&t instanceof r?t.isFulfilled()?t.value():void 0:t},r.prototype._migrateCallbacks=function(t,e){var n=t._fulfillmentHandlerAt(e),i=t._rejectionHandlerAt(e),o=t._progressHandlerAt(e),s=t._promiseAt(e),a=t._receiverAt(e);s instanceof r&&s._setIsMigrated(),void 0===a&&(a=c),this._addCallbacks(n,i,o,s,a,null)},r.prototype._addCallbacks=function(t,e,n,r,i,o){var s=this._length();if(s>=131066&&(s=0,this._setLength(0)),0===s)this._promise0=r,void 0!==i&&(this._receiver0=i),"function"!=typeof t||this._isCarryingStackTrace()||(this._fulfillmentHandler0=null===o?t:o.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===o?e:o.bind(e)),"function"==typeof n&&(this._progressHandler0=null===o?n:o.bind(n));else{var a=5*s-5;this[a+3]=r,this[a+4]=i,"function"==typeof t&&(this[a+0]=null===o?t:o.bind(t)),"function"==typeof e&&(this[a+1]=null===o?e:o.bind(e)),"function"==typeof n&&(this[a+2]=null===o?n:o.bind(n))}return this._setLength(s+1),s},r.prototype._setProxyHandlers=function(t,e){var n=this._length();if(n>=131066&&(n=0,this._setLength(0)),0===n)this._promise0=e,this._receiver0=t;else{var r=5*n-5;this[r+3]=e,this[r+4]=t}this._setLength(n+1)},r.prototype._proxyPromiseArray=function(t,e){this._setProxyHandlers(t,e)},r.prototype._resolveCallback=function(t,e){if(!this._isFollowingOrFulfilledOrRejected()){if(t===this)return this._rejectCallback(s(),!1,!0);var n=v(t,this);if(!(n instanceof r))return this._fulfill(t);var i=1|(e?4:0);this._propagateFrom(n,i);var o=n._target();if(o._isPending()){for(var a=this._length(),u=0;u<a;++u)o._migrateCallbacks(this,u);this._setFollowing(),this._setLength(0),this._setFollowee(o)}else o._isFulfilled()?this._fulfillUnchecked(o._value()):this._rejectUnchecked(o._reason(),o._getCarriedStackTrace())}},r.prototype._rejectCallback=function(t,e,n){n||h.markAsOriginatingFromRejection(t);var r=h.ensureErrorObject(t),i=r===t;this._attachExtraTrace(r,!!e&&i),this._reject(t,i?void 0:r)},r.prototype._resolveFromResolver=function(t){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=S(t)(function(t){null!==e&&(e._resolveCallback(t),e=null)},function(t){null!==e&&(e._rejectCallback(t,n),e=null)});n=!1,this._popContext(),void 0!==r&&r===P&&null!==e&&(e._rejectCallback(r.e,!0,!0),e=null)},r.prototype._settlePromiseFromHandler=function(t,e,n,r){if(!r._isRejected()){r._pushContext();var i;if(i=e!==m||this._isRejected()?S(t).call(e,n):S(t).apply(this._boundValue(),n),r._popContext(),i===P||i===r||i===g){var o=i===r?s():i.e;r._rejectCallback(o,!1,!0)}else r._resolveCallback(i)}},r.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},r.prototype._followee=function(){return this._rejectionHandler0},r.prototype._setFollowee=function(t){this._rejectionHandler0=t},r.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},r.prototype._propagateFrom=function(t,e){(1&e)>0&&t._cancellable()&&(this._setCancellable(),this._cancellationParent=t),(4&e)>0&&t._isBound()&&this._setBoundTo(t._boundTo)},r.prototype._fulfill=function(t){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(t)},r.prototype._reject=function(t,e){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(t,e)},r.prototype._settlePromiseAt=function(t){var e=this._promiseAt(t),n=e instanceof r;if(n&&e._isMigrated())return e._unsetIsMigrated(),l.invoke(this._settlePromiseAt,this,t);var i=this._isFulfilled()?this._fulfillmentHandlerAt(t):this._rejectionHandlerAt(t),o=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,s=this._settledValue,a=this._receiverAt(t);this._clearCallbackDataAtIndex(t),"function"==typeof i?n?this._settlePromiseFromHandler(i,a,s,e):i.call(a,s,e):a instanceof y?a._isResolved()||(this._isFulfilled()?a._promiseFulfilled(s,e):a._promiseRejected(s,e)):n&&(this._isFulfilled()?e._fulfill(s):e._reject(s,o)),t>=4&&4===(31&t)&&l.invokeLater(this._setLength,this,0)},r.prototype._clearCallbackDataAtIndex=function(t){if(0===t)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var e=5*t-5;this[e+3]=this[e+4]=this[e+0]=this[e+1]=this[e+2]=void 0}},r.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824},r.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824},r.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},r.prototype._queueSettlePromises=function(){l.settlePromises(this),this._setSettlePromisesQueued()},r.prototype._fulfillUnchecked=function(t){if(t===this){var e=s();return this._attachExtraTrace(e),this._rejectUnchecked(e,void 0)}this._setFulfilled(),this._settledValue=t,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},r.prototype._rejectUncheckedCheckError=function(t){var e=h.ensureErrorObject(t);this._rejectUnchecked(t,e===t?void 0:e)},r.prototype._rejectUnchecked=function(t,e){if(t===this){var n=s();return this._attachExtraTrace(n),this._rejectUnchecked(n)}return this._setRejected(),this._settledValue=t,this._cleanValues(),this._isFinal()?void l.throwLater(function(t){throw"stack"in t&&l.invokeFirst(_.unhandledRejection,void 0,t),t},void 0===e?t:e):(void 0!==e&&e!==t&&this._setCarriedStackTrace(e),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},r.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var t=this._length(),e=0;e<t;e++)this._settlePromiseAt(e)},h.notEnumerableProp(r,"_makeSelfResolutionError",s),t("./progress.js")(r,y),t("./method.js")(r,d,v,u),t("./bind.js")(r,d,v),t("./finally.js")(r,g,v),t("./direct_resolve.js")(r),t("./synchronous_inspection.js")(r),t("./join.js")(r,y,v,d),r.version="2.11.0",r.Promise=r,t("./map.js")(r,y,u,v,d),t("./cancel.js")(r),t("./using.js")(r,u,v,x),t("./generators.js")(r,u,d,v),t("./nodeify.js")(r),t("./call_get.js")(r),t("./props.js")(r,y,v,u),t("./race.js")(r,d,v,u),t("./reduce.js")(r,y,u,v,d),t("./settle.js")(r,y),t("./some.js")(r,y,u),t("./promisify.js")(r,d),t("./any.js")(r),t("./each.js")(r,d),t("./timers.js")(r,d),t("./filter.js")(r,d),h.toFastProperties(r),h.toFastProperties(r.prototype),i({a:1}),i({b:2}),i({c:3}),i(1),i(function(){}),i(void 0),i(!1),i(new r(d)),_.setBounds(l.firstLineError,h.lastLineError),r}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t){switch(t){case-2:return[];case-3:return{}}}function s(t){var r,i=this._promise=new e(n);t instanceof e&&(r=t,i._propagateFrom(r,5)),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var a=t("./util.js"),u=a.isArray;return s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function h(t,n){var s=r(this._values,this._promise);if(s instanceof e){if(s=s._target(),this._values=s,!s._isFulfilled())return s._isPending()?void s._then(h,this._reject,void 0,this,n):void this._reject(s._reason());if(s=s._value(),!u(s)){var a=new e.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(a)}}else if(!u(s))return void this._promise._reject(i("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());if(0===s.length)return void(n===-5?this._resolveEmptyArray():this._resolve(o(n)));var c=this.getActualLength(s.length);this._length=c,this._values=this.shouldCopyValues()?new Array(c):this._values;for(var l=this._promise,p=0;p<c;++p){var f=this._isResolved(),d=r(s[p],l);d instanceof e?(d=d._target(),f?d._ignoreRejections():d._isPending()?d._proxyPromiseArray(this,p):d._isFulfilled()?this._promiseFulfilled(d._value(),p):this._promiseRejected(d._reason(),p)):f||this._promiseFulfilled(d,p)}},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype.__hardReject__=s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1,!0)},s.prototype._promiseProgressed=function(t,e){this._promise._progress({index:e,value:t})},s.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)},s.prototype._promiseRejected=function(t,e){this._totalResolved++,this._reject(t)},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},{"./util.js":38}],25:[function(t,e,n){"use strict";function r(t){
return t instanceof Error&&f.getPrototypeOf(t)===Error.prototype}function i(t){var e;if(r(t)){e=new l(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var n=f.keys(t),i=0;i<n.length;++i){var o=n[i];d.test(o)||(e[o]=t[o])}return e}return a.markAsOriginatingFromRejection(t),t}function o(t){return function(e,n){if(null!==t){if(e){var r=i(u(e));t._attachExtraTrace(r),t._reject(r)}else if(arguments.length>2){for(var o=arguments.length,s=new Array(o-1),a=1;a<o;++a)s[a-1]=arguments[a];t._fulfill(s)}else t._fulfill(n);t=null}}}var s,a=t("./util.js"),u=a.maybeWrapAsError,h=t("./errors.js"),c=h.TimeoutError,l=h.OperationalError,p=a.haveGetters,f=t("./es5.js"),d=/^(?:name|message|stack|cause)$/;if(s=p?function(t){this.promise=t}:function(t){this.promise=t,this.asCallback=o(t),this.callback=this.asCallback},p){var m={get:function(){return o(this.promise)}};f.defineProperty(s.prototype,"asCallback",m),f.defineProperty(s.prototype,"callback",m)}s._nodebackForPromise=o,s.prototype.toString=function(){return"[object PromiseResolver]"},s.prototype.resolve=s.prototype.fulfill=function(t){if(!(this instanceof s))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(t)},s.prototype.reject=function(t){if(!(this instanceof s))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(t)},s.prototype.progress=function(t){if(!(this instanceof s))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(t)},s.prototype.cancel=function(t){this.promise.cancel(t)},s.prototype.timeout=function(){this.reject(new c("timeout"))},s.prototype.isResolved=function(){return this.promise.isResolved()},s.prototype.toJSON=function(){return this.promise.toJSON()},e.exports=s},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t){return!w.test(t)}function i(t){try{return t.__isPromisified__===!0}catch(e){return!1}}function o(t,e,n){var r=f.getDataPropertyOrDefault(t,e+n,b);return!!r&&i(r)}function s(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",e))}}function a(t,e,n,r){for(var a=f.inheritedDataKeys(t),u=[],h=0;h<a.length;++h){var c=a[h],l=t[c],p=r===C||C(c,l,t);"function"!=typeof l||i(l)||o(t,c,e)||!r(c,l,t,p)||u.push(c,l)}return s(u,e,n),u}function u(t,r,i,o){function s(){var i=r;r===p&&(i=this);var o=new e(n);o._captureStackTrace();var s="string"==typeof u&&this!==a?this[u]:t,h=d(o);try{s.apply(i,m(arguments,h))}catch(c){o._rejectCallback(g(c),!0,!0)}return o}var a=function(){return this}(),u=t;return"string"==typeof u&&(t=o),f.notEnumerableProp(s,"__isPromisified__",!0),s}function h(t,e,n,r){for(var i=new RegExp(k(e)+"$"),o=a(t,e,i,n),s=0,u=o.length;s<u;s+=2){var h=o[s],c=o[s+1],l=h+e;if(r===P)t[l]=P(h,p,h,c,e);else{var d=r(c,function(){return P(h,p,h,c,e)});f.notEnumerableProp(d,"__isPromisified__",!0),t[l]=d}}return f.toFastProperties(t),t}function c(t,e){return P(t,e,void 0,t)}var l,p={},f=t("./util.js"),d=t("./promise_resolver.js")._nodebackForPromise,m=f.withAppended,g=f.maybeWrapAsError,v=f.canEvaluate,y=t("./errors").TypeError,_="Async",b={__isPromisified__:!0},x=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],w=new RegExp("^(?:"+x.join("|")+")$"),C=function(t){return f.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},k=function(t){return t.replace(/([$])/,"\\$")},P=v?l:u;e.promisify=function(t,e){if("function"!=typeof t)throw new y("fn must be a function\n\n    See http://goo.gl/916lJJ\n");if(i(t))return t;var n=c(t,arguments.length<2?p:e);return f.copyDescriptors(t,n,r),n},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");e=Object(e);var n=e.suffix;"string"!=typeof n&&(n=_);var r=e.filter;"function"!=typeof r&&(r=C);var i=e.promisifier;if("function"!=typeof i&&(i=P),!f.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var o=f.inheritedDataKeys(t),s=0;s<o.length;++s){var a=t[o[s]];"constructor"!==o[s]&&f.isClass(a)&&(h(a.prototype,n,r,i),h(a,n,r,i))}return h(t,n,r,i)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t){for(var e=h.keys(t),n=e.length,r=new Array(2*n),i=0;i<n;++i){var o=e[i];r[i]=t[o],r[i+n]=o}this.constructor$(r)}function s(t){var n,s=r(t);return u(s)?(n=s instanceof e?s._then(e.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof e&&n._propagateFrom(s,4),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var a=t("./util.js"),u=a.isObject,h=t("./es5.js");a.inherits(o,n),o.prototype._init=function(){this._init$(void 0,-3)},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;if(n>=this._length){for(var r={},i=this.length(),o=0,s=this.length();o<s;++o)r[this._values[o+i]]=this._values[o];this._resolve(r)}},o.prototype._promiseProgressed=function(t,e){this._promise._progress({key:this._values[e+this.length()],value:t})},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return s(this)},e.props=function(t){return s(t)}}},{"./es5.js":14,"./util.js":38}],28:[function(t,e,n){"use strict";function r(t,e,n,r,i){for(var o=0;o<i;++o)n[o+r]=t[o+e],t[o+e]=void 0}function i(t){this._capacity=t,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var n=this._front+e&this._capacity-1;this[n]=t,this._length=e+1},i.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var n=this._front,r=(n-1&e-1^e)-e;this[r]=t,this._front=r,this._length=this.length()+1},i.prototype.unshift=function(t,e,n){this._unshiftOne(n),this._unshiftOne(e),this._unshiftOne(t)},i.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,i=this._length,o=n+i&e-1;r(this,0,this,e,o)},e.exports=i},{}],29:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t,o){var u=r(t);if(u instanceof e)return a(u);if(!s(t))return i("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var h=new e(n);void 0!==o&&h._propagateFrom(o,5);for(var c=h._fulfill,l=h._reject,p=0,f=t.length;p<f;++p){var d=t[p];(void 0!==d||p in t)&&e.cast(d)._then(c,l,void 0,h,null)}return h}var s=t("./util.js").isArray,a=function(t){return t.then(function(e){return o(e,t)})};e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util.js":38}],30:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){function s(t,n,r,s){this.constructor$(t),this._promise._captureStackTrace(),this._preservedValues=s===o?[]:null,this._zerothIsAccum=void 0===r,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var u=i(r,this._promise),l=!1,p=u instanceof e;p&&(u=u._target(),u._isPending()?u._proxyPromiseArray(this,-1):u._isFulfilled()?(r=u._value(),this._gotAccum=!0):(this._reject(u._reason()),l=!0)),p||this._zerothIsAccum||(this._gotAccum=!0);var f=h();this._callback=null===f?n:f.bind(n),this._accum=r,l||c.invoke(a,this,void 0)}function a(){this._init$(void 0,-5)}function u(t,e,n,i){if("function"!=typeof e)return r("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var o=new s(t,e,n,i);return o.promise()}var h=e._getDomain,c=t("./async.js"),l=t("./util.js"),p=l.tryCatch,f=l.errorObj;l.inherits(s,n),s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},s.prototype._promiseFulfilled=function(t,n){var r=this._values;r[n]=t;var o,s=this.length(),a=this._preservedValues,u=null!==a,h=this._gotAccum,c=this._valuesPhase;if(!c)for(c=this._valuesPhase=new Array(s),o=0;o<s;++o)c[o]=0;if(o=c[n],0===n&&this._zerothIsAccum?(this._accum=t,this._gotAccum=h=!0,c[n]=0===o?1:2):n===-1?(this._accum=t,this._gotAccum=h=!0):0===o?c[n]=1:(c[n]=2,this._accum=t),h){for(var l,d=this._callback,m=this._promise._boundValue(),g=this._reducingIndex;g<s;++g)if(o=c[g],2!==o){if(1!==o)return;if(t=r[g],this._promise._pushContext(),u?(a.push(t),l=p(d).call(m,t,g,s)):l=p(d).call(m,this._accum,t,g,s),this._promise._popContext(),l===f)return this._reject(l.e);var v=i(l,this._promise);if(v instanceof e){if(v=v._target(),v._isPending())return c[g]=4,v._proxyPromiseArray(this,g);if(!v._isFulfilled())return this._reject(v._reason());l=v._value()}this._reducingIndex=g+1,this._accum=l}else this._reducingIndex=g+1;this._resolve(u?a:this._accum)}},e.prototype.reduce=function(t,e){return u(this,t,e,null)},e.reduce=function(t,e,n,r){return u(t,e,n,r)}}},{"./async.js":2,"./util.js":38}],31:[function(t,n,r){"use strict";var o,s=t("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")};if(s.isNode&&"undefined"==typeof MutationObserver){var u=i.setImmediate,h=e.nextTick;o=s.isRecentNode?function(t){u.call(i,t)}:function(t){h.call(e,t)}}else"undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?o="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:a:(o=function(t){var e=document.createElement("div"),n=new MutationObserver(t);return n.observe(e,{attributes:!0}),function(){e.classList.toggle("foo")}},o.isStatic=!0);n.exports=o},{"./util":38}],32:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t){this.constructor$(t)}var i=e.PromiseInspection,o=t("./util.js");o.inherits(r,n),r.prototype._promiseResolved=function(t,e){this._values[t]=e;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)},r.prototype._promiseFulfilled=function(t,e){var n=new i;n._bitField=268435456,n._settledValue=t,this._promiseResolved(e,n)},r.prototype._promiseRejected=function(t,e){var n=new i;n._bitField=134217728,n._settledValue=t,this._promiseResolved(e,n)},e.settle=function(t){return new r(t).promise()},e.prototype.settle=function(){return new r(this).promise()}}},{"./util.js":38}],33:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||e<0)return r("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var n=new i(t),o=n.promise();return n.setHowMany(e),n.init(),o}var s=t("./util.js"),a=t("./errors.js").RangeError,u=t("./errors.js").AggregateError,h=s.isArray;s.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=h(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(t){this._howMany=t},i.prototype._promiseFulfilled=function(t){this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},i.prototype._promiseRejected=function(t){if(this._addRejected(t),this.howMany()>this._canPossiblyFulfill()){for(var e=new u,n=this.length();n<this._values.length;++n)e.push(this._values[n]);this._reject(e)}},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(t){this._values.push(t)},i.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=i}},{"./errors.js":13,"./util.js":38}],34:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValue=t._settledValue):(this._bitField=0,this._settledValue=void 0)}e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},e.prototype.isFulfilled=t.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},e.prototype.isRejected=t.prototype._isRejected=function(){return(134217728&this._bitField)>0},e.prototype.isPending=t.prototype._isPending=function(){return 0===(402653184&this._bitField)},e.prototype.isResolved=t.prototype._isResolved=function(){return(402653184&this._bitField)>0},t.prototype.isPending=function(){return this._target()._isPending()},t.prototype.isRejected=function(){return this._target()._isRejected()},t.prototype.isFulfilled=function(){return this._target()._isFulfilled()},t.prototype.isResolved=function(){return this._target()._isResolved()},t.prototype._value=function(){return this._settledValue},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},t.prototype.value=function(){var t=this._target();if(!t.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return t._settledValue},t.prototype.reason=function(){var t=this._target();if(!t.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return t._unsetRejectionIsUnhandled(),t._settledValue},t.PromiseInspection=e}},{}],35:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t,r){if(h(t)){if(t instanceof e)return t;if(o(t)){var c=new e(n);return t._then(c._fulfillUnchecked,c._rejectUncheckedCheckError,c._progressUnchecked,c,null),c}var l=a.tryCatch(i)(t);if(l===u){r&&r._pushContext();var c=e.reject(l.e);return r&&r._popContext(),c}if("function"==typeof l)return s(t,l,r)}return t}function i(t){return t.then}function o(t){return c.call(t,"_promise0")}function s(t,r,i){function o(t){c&&(c._resolveCallback(t),c=null)}function s(t){c&&(c._rejectCallback(t,p,!0),c=null)}function h(t){c&&"function"==typeof c._progress&&c._progress(t)}var c=new e(n),l=c;i&&i._pushContext(),c._captureStackTrace(),i&&i._popContext();var p=!0,f=a.tryCatch(r).call(t,o,s,h);return p=!1,c&&f===u&&(c._rejectCallback(f.e,!0,!0),c=null),l}var a=t("./util.js"),u=a.errorObj,h=a.isObject,c={}.hasOwnProperty;return r}},{"./util.js":38}],36:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t){var e=this;return e instanceof Number&&(e=+e),clearTimeout(e),t}function i(t){var e=this;throw e instanceof Number&&(e=+e),clearTimeout(e),t}var o=t("./util.js"),s=e.TimeoutError,a=function(t,e){if(t.isPending()){var n;!o.isPrimitive(e)&&e instanceof Error?n=e:("string"!=typeof e&&(e="operation timed out"),n=new s(e)),o.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._cancel(n)}},u=function(t){return h(+this).thenReturn(t)},h=e.delay=function(t,r){if(void 0===r){r=t,t=void 0;var i=new e(n);return setTimeout(function(){i._fulfill()},r),i}return r=+r,e.resolve(t)._then(u,null,null,r,void 0)};e.prototype.delay=function(t){return h(this,t)},e.prototype.timeout=function(t,e){t=+t;var n=this.then().cancellable();n._cancellationParent=this;var o=setTimeout(function(){a(n,e)},t);return n._then(r,i,void 0,o,void 0)}}},{"./util.js":38}],37:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t){for(var n=t.length,r=0;r<n;++r){var i=t[r];if(i.isRejected())return e.reject(i.error());t[r]=i._settledValue}return t}function s(t){setTimeout(function(){throw t},0)}function a(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function u(t,n){function i(){if(o>=u)return h.resolve();var c=a(t[o++]);if(c instanceof e&&c._isDisposable()){try{c=r(c._getDisposer().tryDispose(n),t.promise)}catch(l){return s(l)}if(c instanceof e)return c._then(i,s,null,null,null)}i()}var o=0,u=t.length,h=e.defer();return i(),h.promise}function h(t){var e=new g;return e._settledValue=t,e._bitField=268435456,u(this,e).thenReturn(t)}function c(t){var e=new g;return e._settledValue=t,e._bitField=134217728,u(this,e).thenThrow(t)}function l(t,e,n){this._data=t,this._promise=e,this._context=n}function p(t,e,n){this.constructor$(t,e,n)}function f(t){return l.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}var d=t("./errors.js").TypeError,m=t("./util.js").inherits,g=e.PromiseInspection;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=null!==e?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},m(p,l),p.prototype.doDispose=function(t,e){var n=this.data();return n.call(t,t,e)},e.using=function(){var t=arguments.length;if(t<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return n("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var s,a=!0;2===t&&Array.isArray(arguments[0])?(s=arguments[0],t=s.length,a=!1):(s=arguments,t--);for(var u=new Array(t),p=0;p<t;++p){var d=s[p];if(l.isDisposer(d)){var m=d;d=d.promise(),d._setDisposable(m)}else{var g=r(d);g instanceof e&&(d=g._then(f,null,null,{resources:u,index:p},void 0))}u[p]=d}var v=e.settle(u).then(o).then(function(t){v._pushContext();var e;try{e=a?i.apply(void 0,t):i.call(void 0,t)}finally{v._popContext()}return e})._then(h,c,void 0,u,void 0);return u.promise=v,v},e.prototype._setDisposable=function(t){this._bitField=262144|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(262144&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new p(t,this,i());throw new d}}},{"./errors.js":13,"./util.js":38}],38:[function(t,n,r){"use strict";function i(){try{var t=j;return j=null,t.apply(this,arguments)}catch(e){return S.e=e,S}}function o(t){return j=t,i}function s(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function a(t){return!s(t)}function u(t){return s(t)?new Error(v(t)):t}function h(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=t[n];return i[n]=e,i}function c(t,e,n){if(!C.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function l(t,e,n){if(s(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return C.defineProperty(t,e,r),t}function p(t){throw t}function f(t){try{if("function"==typeof t){var e=C.names(t.prototype),n=C.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=A.test(t+"")&&C.names(t).length>0;if(n||r||i)return!0}return!1}catch(o){return!1}}function d(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t}function m(t){return T.test(t)}function g(t,e,n){for(var r=new Array(t),i=0;i<t;++i)r[i]=e+i+n;return r}function v(t){try{return t+""}catch(e){return"[no string representation]"}}function y(t){try{l(t,"isOperational",!0)}catch(e){}}function _(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0)}function b(t){return t instanceof Error&&C.propertyIsWritable(t,"stack")}function x(t){return{}.toString.call(t)}function w(t,e,n){for(var r=C.names(t),i=0;i<r.length;++i){var o=r[i];if(n(o))try{C.defineProperty(e,o,C.getDescriptor(t,o))}catch(s){}}}var C=t("./es5.js"),k="undefined"==typeof navigator,P=function(){try{var t={};return C.defineProperty(t,"f",{get:function(){return 3}}),3===t.f}catch(e){return!1}}(),S={e:{}},j,O=function(t,e){function n(){this.constructor=t,this.constructor$=e;for(var n in e.prototype)r.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var r={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},E=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(C.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var r=[],i=Object.create(null);null!=t&&!e(t);){var o;try{o=n(t)}catch(s){return r}for(var a=0;a<o.length;++a){var u=o[a];if(!i[u]){i[u]=!0;var h=Object.getOwnPropertyDescriptor(t,u);null!=h&&null==h.get&&null==h.set&&r.push(u)}}t=C.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(n){if(e(n))return[];var i=[];t:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<t.length;++s)if(r.call(t[s],o))continue t;i.push(o)}return i}}(),A=/this\s*\.\s*\S+\s*=/,T=/^[a-z$_][a-z$_0-9]*$/i,M=function(){return"stack"in new Error?function(t){return b(t)?t:new Error(v(t))}:function(t){if(b(t))return t;try{throw new Error(v(t))}catch(e){return e}}}(),F={isClass:f,isIdentifier:m,inheritedDataKeys:E,getDataPropertyOrDefault:c,thrower:p,isArray:C.isArray,haveGetters:P,notEnumerableProp:l,isPrimitive:s,isObject:a,canEvaluate:k,errorObj:S,tryCatch:o,inherits:O,withAppended:h,maybeWrapAsError:u,toFastProperties:d,filledRange:g,toString:v,canAttachTrace:b,ensureErrorObject:M,originatesFromRejection:_,markAsOriginatingFromRejection:y,classString:x,copyDescriptors:w,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:"undefined"!=typeof e&&"[object process]"===x(e).toLowerCase()};F.isRecentNode=F.isNode&&function(){var t=e.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),F.isNode&&F.toFastProperties(e);try{throw new Error}catch(R){F.lastLineError=R}n.exports=F},{"./es5.js":14}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:21}],21:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(p===clearTimeout)return clearTimeout(t);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function a(){g&&d&&(g=!1,d.length?m=d.concat(m):v=-1,m.length&&u())}function u(){if(!g){var t=o(a);g=!0;for(var e=m.length;e;){for(d=m,m=[];++v<e;)d&&d[v].run();v=-1,e=m.length}d=null,g=!1,s(t)}}function h(t,e){this.fun=t,this.array=e}function c(){}var l,p,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(t){p=i}}();var d,m=[],g=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new h(t,e)),1!==m.length||g||o(u)},h.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],22:[function(e,n,r){!function(e){var r,i,o="0.4.2",s="hasOwnProperty",a=/[\.\/]/,u=/\s*,\s*/,h="*",c=function(t,e){return t-e},l={n:{}},p=function(){for(var t=0,e=this.length;t<e;t++)if("undefined"!=typeof this[t])return this[t]},f=function(){for(var t=this.length;--t;)if("undefined"!=typeof this[t])return this[t]},d=function(t,e){t=String(t);var n,o=i,s=Array.prototype.slice.call(arguments,2),a=d.listeners(t),u=0,h=[],l={},m=[],g=r;m.firstDefined=p,m.lastDefined=f,r=t,i=0;for(var v=0,y=a.length;v<y;v++)"zIndex"in a[v]&&(h.push(a[v].zIndex),a[v].zIndex<0&&(l[a[v].zIndex]=a[v]));for(h.sort(c);h[u]<0;)if(n=l[h[u++]],m.push(n.apply(e,s)),i)return i=o,m;for(v=0;v<y;v++)if(n=a[v],"zIndex"in n)if(n.zIndex==h[u]){if(m.push(n.apply(e,s)),i)break;do if(u++,n=l[h[u]],n&&m.push(n.apply(e,s)),i)break;while(n)}else l[n.zIndex]=n;else if(m.push(n.apply(e,s)),i)break;return i=o,r=g,m};d._events=l,d.listeners=function(t){var e,n,r,i,o,s,u,c,p=t.split(a),f=l,d=[f],m=[];for(i=0,o=p.length;i<o;i++){for(c=[],s=0,u=d.length;s<u;s++)for(f=d[s].n,n=[f[p[i]],f[h]],r=2;r--;)e=n[r],e&&(c.push(e),m=m.concat(e.f||[]));d=c}return m},d.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var n=t.split(u),r=0,i=n.length;r<i;r++)!function(t){for(var n,r=t.split(a),i=l,o=0,s=r.length;o<s;o++)i=i.n,i=i.hasOwnProperty(r[o])&&i[r[o]]||(i[r[o]]={n:{}});for(i.f=i.f||[],o=0,s=i.f.length;o<s;o++)if(i.f[o]==e){n=!0;break}!n&&i.f.push(e)}(n[r]);return function(t){+t==+t&&(e.zIndex=+t)}},d.f=function(t){var e=[].slice.call(arguments,1);return function(){d.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},d.stop=function(){i=1},d.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(r):r},d.nts=function(){return r.split(a)},d.off=d.unbind=function(t,e){if(!t)return void(d._events=l={n:{}});var n=t.split(u);if(n.length>1)for(var r=0,i=n.length;r<i;r++)d.off(n[r],e);else{n=t.split(a);var o,c,p,r,i,f,m,g=[l];for(r=0,i=n.length;r<i;r++)for(f=0;f<g.length;f+=p.length-2){if(p=[f,1],o=g[f].n,n[r]!=h)o[n[r]]&&p.push(o[n[r]]);else for(c in o)o[s](c)&&p.push(o[c]);g.splice.apply(g,p)}for(r=0,i=g.length;r<i;r++)for(o=g[r];o.n;){if(e){if(o.f){for(f=0,m=o.f.length;f<m;f++)if(o.f[f]==e){o.f.splice(f,1);break}!o.f.length&&delete o.f}for(c in o.n)if(o.n[s](c)&&o.n[c].f){var v=o.n[c].f;for(f=0,m=v.length;f<m;f++)if(v[f]==e){v.splice(f,1);break}!v.length&&delete o.n[c].f}}else{delete o.f;for(c in o.n)o.n[s](c)&&o.n[c].f&&delete o.n[c].f}o=o.n}}},d.once=function(t,e){var n=function(){return d.unbind(t,n),e.apply(this,arguments)};return d.on(t,n)},d.version=o,d.toString=function(){return"You are running Eve "+o},"undefined"!=typeof n&&n.exports?n.exports=d:"function"==typeof t&&t.amd?t("eve",[],function(){return d}):e.eve=d}(this),function(i,o){if("function"==typeof t&&t.amd)t(["eve"],function(t){return o(i,t)});else if("undefined"!=typeof r){var s=e("eve");n.exports=o(i,s)}else o(i,i.eve)}(window||this,function(t,e){var n=function(e){var n={},r=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},i=Array.isArray||function(t){return t instanceof Array||"[object Array]"==Object.prototype.toString.call(t)},o=0,s="M"+(+new Date).toString(36),a=function(){return s+(o++).toString(36)},u=Date.now||function(){return+new Date},h=function(t){var e=this;if(null==t)return e.s;var n=e.s-t;e.b+=e.dur*n,e.B+=e.dur*n,e.s=t},c=function(t){var e=this;return null==t?e.spd:void(e.spd=t)},l=function(t){var e=this;return null==t?e.dur:(e.s=e.s*t/e.dur,void(e.dur=t))},p=function(){var t=this;delete n[t.id],t.update(),e("mina.stop."+t.id,t)},f=function(){var t=this;t.pdif||(delete n[t.id],t.update(),t.pdif=t.get()-t.b)},d=function(){var t=this;t.pdif&&(t.b=t.get()-t.pdif,delete t.pdif,n[t.id]=t)},m=function(){var t,e=this;if(i(e.start)){t=[];for(var n=0,r=e.start.length;n<r;n++)t[n]=+e.start[n]+(e.end[n]-e.start[n])*e.easing(e.s)}else t=+e.start+(e.end-e.start)*e.easing(e.s);e.set(t)},g=function(){var t=0;for(var i in n)if(n.hasOwnProperty(i)){var o=n[i],s=o.get();t++,o.s=(s-o.b)/(o.dur/o.spd),o.s>=1&&(delete n[i],o.s=1,t--,function(t){setTimeout(function(){e("mina.finish."+t.id,t)})}(o)),o.update()}t&&r(g)},v=function(t,e,i,o,s,u,y){var _={id:a(),start:t,end:e,b:i,s:0,dur:o-i,spd:1,get:s,set:u,easing:y||v.linear,status:h,speed:c,duration:l,stop:p,pause:f,resume:d,update:m};n[_.id]=_;var b,x=0;for(b in n)if(n.hasOwnProperty(b)&&(x++,2==x))break;return 1==x&&r(g),_};return v.time=u,v.getById=function(t){return n[t]||null},v.linear=function(t){return t},v.easeout=function(t){return Math.pow(t,1.7)},v.easein=function(t){return Math.pow(t,.48)},v.easeinout=function(t){if(1==t)return 1;if(0==t)return 0;var e=.48-t/1.04,n=Math.sqrt(.1734+e*e),r=n-e,i=Math.pow(Math.abs(r),1/3)*(r<0?-1:1),o=-n-e,s=Math.pow(Math.abs(o),1/3)*(o<0?-1:1),a=i+s+.5;return 3*(1-a)*a*a+a*a*a},v.backin=function(t){if(1==t)return 1;var e=1.70158;return t*t*((e+1)*t-e)},v.backout=function(t){if(0==t)return 0;t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},v.elastic=function(t){return t==!!t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},v.bounce=function(t){var e,n=7.5625,r=2.75;return t<1/r?e=n*t*t:t<2/r?(t-=1.5/r,e=n*t*t+.75):t<2.5/r?(t-=2.25/r,e=n*t*t+.9375):(t-=2.625/r,e=n*t*t+.984375),e},t.mina=v,v}("undefined"==typeof e?function(){}:e),r=function(t){function n(t,e){if(t){if(t.nodeType)return w(t);if(i(t,"array")&&n.set)return n.set.apply(n,t);if(t instanceof y)return t;if(null==e)return t=k.doc.querySelector(String(t)),w(t)}return t=null==t?"100%":t,e=null==e?"100%":e,new x(t,e)}function r(t,e){if(e){if("#text"==t&&(t=k.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==t&&(t=k.doc.createComment(e.text||e["#text"]||"")),"string"==typeof t&&(t=r(t)),"string"==typeof e)return 1==t.nodeType?"xlink:"==e.substring(0,6)?t.getAttributeNS(X,e.substring(6)):"xml:"==e.substring(0,4)?t.getAttributeNS(q,e.substring(4)):t.getAttribute(e):"text"==e?t.nodeValue:null;if(1==t.nodeType){for(var n in e)if(e[P](n)){var i=S(e[n]);i?"xlink:"==n.substring(0,6)?t.setAttributeNS(X,n.substring(6),i):"xml:"==n.substring(0,4)?t.setAttributeNS(q,n.substring(4),i):t.setAttribute(n,i):t.removeAttribute(n);
}}else"text"in e&&(t.nodeValue=e.text)}else t=k.doc.createElementNS(q,t);return t}function i(t,e){return e=S.prototype.toLowerCase.call(e),"finite"==e?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||("null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||B.call(t).slice(8,-1).toLowerCase()==e)}function o(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)t[P](n)&&(e[n]=o(t[n]));return e}function s(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}function a(t,e,n){function r(){var i=Array.prototype.slice.call(arguments,0),o=i.join("␀"),a=r.cache=r.cache||{},u=r.count=r.count||[];return a[P](o)?(s(u,o),n?n(a[o]):a[o]):(u.length>=1e3&&delete a[u.shift()],u.push(o),a[o]=t.apply(e,i),n?n(a[o]):a[o])}return r}function u(t,e,n,r,i,o){if(null==i){var s=t-n,a=e-r;return s||a?(180+180*E.atan2(-a,-s)/F+360)%360:0}return u(t,e,i,o)-u(n,r,i,o)}function h(t){return t%360*F/180}function c(t){return 180*t/F%360}function l(t){var e=[];return t=t.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(t,n,r){return r=r.split(/\s*,\s*|\s+/),"rotate"==n&&1==r.length&&r.push(0,0),"scale"==n&&(r.length>2?r=r.slice(0,2):2==r.length&&r.push(0,0),1==r.length&&r.push(r[0],0,0)),"skewX"==n?e.push(["m",1,0,E.tan(h(r[0])),1,0,0]):"skewY"==n?e.push(["m",1,E.tan(h(r[0])),0,1,0,0]):e.push([n.charAt(0)].concat(r)),t}),e}function p(t,e){var r=tt(t),i=new n.Matrix;if(r)for(var o=0,s=r.length;o<s;o++){var a,u,h,c,l,p=r[o],f=p.length,d=S(p[0]).toLowerCase(),m=p[0]!=d,g=m?i.invert():0;"t"==d&&2==f?i.translate(p[1],0):"t"==d&&3==f?m?(a=g.x(0,0),u=g.y(0,0),h=g.x(p[1],p[2]),c=g.y(p[1],p[2]),i.translate(h-a,c-u)):i.translate(p[1],p[2]):"r"==d?2==f?(l=l||e,i.rotate(p[1],l.x+l.width/2,l.y+l.height/2)):4==f&&(m?(h=g.x(p[2],p[3]),c=g.y(p[2],p[3]),i.rotate(p[1],h,c)):i.rotate(p[1],p[2],p[3])):"s"==d?2==f||3==f?(l=l||e,i.scale(p[1],p[f-1],l.x+l.width/2,l.y+l.height/2)):4==f?m?(h=g.x(p[2],p[3]),c=g.y(p[2],p[3]),i.scale(p[1],p[1],h,c)):i.scale(p[1],p[1],p[2],p[3]):5==f&&(m?(h=g.x(p[3],p[4]),c=g.y(p[3],p[4]),i.scale(p[1],p[2],h,c)):i.scale(p[1],p[2],p[3],p[4])):"m"==d&&7==f&&i.add(p[1],p[2],p[3],p[4],p[5],p[6])}return i}function f(t){var e=t.node.ownerSVGElement&&w(t.node.ownerSVGElement)||t.node.parentNode&&w(t.node.parentNode)||n.select("svg")||n(0,0),r=e.select("defs"),i=null!=r&&r.node;return i||(i=b("defs",e.node).node),i}function d(t){return t.node.ownerSVGElement&&w(t.node.ownerSVGElement)||n.select("svg")}function m(t,e,n){function i(t){if(null==t)return R;if(t==+t)return t;r(h,{width:t});try{return h.getBBox().width}catch(e){return 0}}function o(t){if(null==t)return R;if(t==+t)return t;r(h,{height:t});try{return h.getBBox().height}catch(e){return 0}}function s(r,i){null==e?u[r]=i(t.attr(r)||0):r==e&&(u=i(null==n?t.attr(r)||0:n))}var a=d(t).node,u={},h=a.querySelector(".svg---mgr");switch(h||(h=r("rect"),r(h,{x:-9e9,y:-9e9,width:10,height:10,"class":"svg---mgr",fill:"none"}),a.appendChild(h)),t.type){case"rect":s("rx",i),s("ry",o);case"image":s("width",i),s("height",o);case"text":s("x",i),s("y",o);break;case"circle":s("cx",i),s("cy",o),s("r",i);break;case"ellipse":s("cx",i),s("cy",o),s("rx",i),s("ry",o);break;case"line":s("x1",i),s("x2",i),s("y1",o),s("y2",o);break;case"marker":s("refX",i),s("markerWidth",i),s("refY",o),s("markerHeight",o);break;case"radialGradient":s("fx",i),s("fy",o);break;case"tspan":s("dx",i),s("dy",o);break;default:s(e,i)}return a.removeChild(h),u}function v(t){i(t,"array")||(t=Array.prototype.slice.call(arguments,0));for(var e=0,n=0,r=this.node;this[e];)delete this[e++];for(e=0;e<t.length;e++)"set"==t[e].type?t[e].forEach(function(t){r.appendChild(t.node)}):r.appendChild(t[e].node);var o=r.childNodes;for(e=0;e<o.length;e++)this[n++]=w(o[e]);return this}function y(t){if(t.snap in Y)return Y[t.snap];var e;try{e=t.ownerSVGElement}catch(n){}this.node=t,e&&(this.paper=new x(e)),this.type=t.tagName||t.nodeName;var r=this.id=U(this);if(this.anims={},this._={transform:[]},t.snap=r,Y[r]=this,"g"==this.type&&(this.add=v),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var i in x.prototype)x.prototype[P](i)&&(this[i]=x.prototype[i])}function _(t){this.node=t}function b(t,e){var n=r(t);e.appendChild(n);var i=w(n);return i}function x(t,e){var n,i,o,s=x.prototype;if(t&&"svg"==t.tagName){if(t.snap in Y)return Y[t.snap];var a=t.ownerDocument;n=new y(t),i=t.getElementsByTagName("desc")[0],o=t.getElementsByTagName("defs")[0],i||(i=r("desc"),i.appendChild(a.createTextNode("Created with Snap")),n.node.appendChild(i)),o||(o=r("defs"),n.node.appendChild(o)),n.defs=o;for(var u in s)s[P](u)&&(n[u]=s[u]);n.paper=n.root=n}else n=b("svg",k.doc.body),r(n.node,{height:e,version:1.1,width:t,xmlns:q});return n}function w(t){return t?t instanceof y||t instanceof _?t:t.tagName&&"svg"==t.tagName.toLowerCase()?new x(t):t.tagName&&"object"==t.tagName.toLowerCase()&&"image/svg+xml"==t.type?new x(t.contentDocument.getElementsByTagName("svg")[0]):new y(t):t}function C(t,e){for(var n=0,r=t.length;n<r;n++){var i={type:t[n].type,attr:t[n].attr()},o=t[n].children();e.push(i),o.length&&C(o,i.childNodes=[])}}n.version="0.4.0",n.toString=function(){return"Snap v"+this.version},n._={};var k={win:t.window,doc:t.window.document};n._.glob=k;var P="hasOwnProperty",S=String,j=parseFloat,O=parseInt,E=Math,A=E.max,T=E.min,M=E.abs,F=(E.pow,E.PI),R=(E.round,""),B=Object.prototype.toString,I=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,L=(n._.separator=/[,\s]+/,/[\s]*,[\s]*/),D={hs:1,rg:1},N=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,V=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,G=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,H=0,z="S"+(+new Date).toString(36),U=function(t){return(t&&t.type?t.type:R)+z+(H++).toString(36)},X="http://www.w3.org/1999/xlink",q="http://www.w3.org/2000/svg",Y={};n.url=function(t){return"url('#"+t+"')"};n._.$=r,n._.id=U,n.format=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(t,n,r){var i=r;return n.replace(e,function(t,e,n,r,o){e=e||r,i&&(e in i&&(i=i[e]),"function"==typeof i&&o&&(i=i()))}),i=(null==i||i==r?t:i)+""};return function(e,r){return S(e).replace(t,function(t,e){return n(t,e,r)})}}(),n._.clone=o,n._.cacher=a,n.rad=h,n.deg=c,n.sin=function(t){return E.sin(n.rad(t))},n.tan=function(t){return E.tan(n.rad(t))},n.cos=function(t){return E.cos(n.rad(t))},n.asin=function(t){return n.deg(E.asin(t))},n.acos=function(t){return n.deg(E.acos(t))},n.atan=function(t){return n.deg(E.atan(t))},n.atan2=function(t){return n.deg(E.atan2(t))},n.angle=u,n.len=function(t,e,r,i){return Math.sqrt(n.len2(t,e,r,i))},n.len2=function(t,e,n,r){return(t-n)*(t-n)+(e-r)*(e-r)},n.closestPoint=function(t,e,n){function r(t){var r=t.x-e,i=t.y-n;return r*r+i*i}for(var i,o,s,a,u=t.node,h=u.getTotalLength(),c=h/u.pathSegList.numberOfItems*.125,l=1/0,p=0;p<=h;p+=c)(a=r(s=u.getPointAtLength(p)))<l&&(i=s,o=p,l=a);for(c*=.5;c>.5;){var f,d,m,g,v,y;(m=o-c)>=0&&(v=r(f=u.getPointAtLength(m)))<l?(i=f,o=m,l=v):(g=o+c)<=h&&(y=r(d=u.getPointAtLength(g)))<l?(i=d,o=g,l=y):c*=.5}return i={x:i.x,y:i.y,length:o,distance:Math.sqrt(l)}},n.is=i,n.snapTo=function(t,e,n){if(n=i(n,"finite")?n:10,i(t,"array")){for(var r=t.length;r--;)if(M(t[r]-e)<=n)return t[r]}else{t=+t;var o=e%t;if(o<n)return e-o;if(o>t-n)return e-o+t}return e},n.getRGB=a(function(t){if(!t||(t=S(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Q};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:Q};if(!(D[P](t.toLowerCase().substring(0,2))||"#"==t.charAt())&&(t=$(t)),!t)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Q};var e,r,o,s,a,u,h=t.match(I);return h?(h[2]&&(o=O(h[2].substring(5),16),r=O(h[2].substring(3,5),16),e=O(h[2].substring(1,3),16)),h[3]&&(o=O((a=h[3].charAt(3))+a,16),r=O((a=h[3].charAt(2))+a,16),e=O((a=h[3].charAt(1))+a,16)),h[4]&&(u=h[4].split(L),e=j(u[0]),"%"==u[0].slice(-1)&&(e*=2.55),r=j(u[1]),"%"==u[1].slice(-1)&&(r*=2.55),o=j(u[2]),"%"==u[2].slice(-1)&&(o*=2.55),"rgba"==h[1].toLowerCase().slice(0,4)&&(s=j(u[3])),u[3]&&"%"==u[3].slice(-1)&&(s/=100)),h[5]?(u=h[5].split(L),e=j(u[0]),"%"==u[0].slice(-1)&&(e/=100),r=j(u[1]),"%"==u[1].slice(-1)&&(r/=100),o=j(u[2]),"%"==u[2].slice(-1)&&(o/=100),("deg"==u[0].slice(-3)||"°"==u[0].slice(-1))&&(e/=360),"hsba"==h[1].toLowerCase().slice(0,4)&&(s=j(u[3])),u[3]&&"%"==u[3].slice(-1)&&(s/=100),n.hsb2rgb(e,r,o,s)):h[6]?(u=h[6].split(L),e=j(u[0]),"%"==u[0].slice(-1)&&(e/=100),r=j(u[1]),"%"==u[1].slice(-1)&&(r/=100),o=j(u[2]),"%"==u[2].slice(-1)&&(o/=100),("deg"==u[0].slice(-3)||"°"==u[0].slice(-1))&&(e/=360),"hsla"==h[1].toLowerCase().slice(0,4)&&(s=j(u[3])),u[3]&&"%"==u[3].slice(-1)&&(s/=100),n.hsl2rgb(e,r,o,s)):(e=T(E.round(e),255),r=T(E.round(r),255),o=T(E.round(o),255),s=T(A(s,0),1),h={r:e,g:r,b:o,toString:Q},h.hex="#"+(16777216|o|r<<8|e<<16).toString(16).slice(1),h.opacity=i(s,"finite")?s:1,h)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Q}},n),n.hsb=a(function(t,e,r){return n.hsb2rgb(t,e,r).hex}),n.hsl=a(function(t,e,r){return n.hsl2rgb(t,e,r).hex}),n.rgb=a(function(t,e,n,r){if(i(r,"finite")){var o=E.round;return"rgba("+[o(t),o(e),o(n),+r.toFixed(2)]+")"}return"#"+(16777216|n|e<<8|t<<16).toString(16).slice(1)});var $=function(t){var e=k.doc.getElementsByTagName("head")[0]||k.doc.getElementsByTagName("svg")[0],n="rgb(255, 0, 0)";return($=a(function(t){if("red"==t.toLowerCase())return n;e.style.color=n,e.style.color=t;var r=k.doc.defaultView.getComputedStyle(e,R).getPropertyValue("color");return r==n?null:r}))(t)},W=function(){return"hsb("+[this.h,this.s,this.b]+")"},Z=function(){return"hsl("+[this.h,this.s,this.l]+")"},Q=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},J=function(t,e,r){if(null==e&&i(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(r=t.b,e=t.g,t=t.r),null==e&&i(t,string)){var o=n.getRGB(t);t=o.r,e=o.g,r=o.b}return(t>1||e>1||r>1)&&(t/=255,e/=255,r/=255),[t,e,r]},K=function(t,e,r,o){t=E.round(255*t),e=E.round(255*e),r=E.round(255*r);var s={r:t,g:e,b:r,opacity:i(o,"finite")?o:1,hex:n.rgb(t,e,r),toString:Q};return i(o,"finite")&&(s.opacity=o),s};n.color=function(t){var e;return i(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=n.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):i(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=n.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):(i(t,"string")&&(t=n.getRGB(t)),i(t,"object")&&"r"in t&&"g"in t&&"b"in t&&!("error"in t)?(e=n.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=n.rgb2hsb(t),t.v=e.b):(t={hex:"none"},t.r=t.g=t.b=t.h=t.s=t.v=t.l=-1,t.error=1)),t.toString=Q,t},n.hsb2rgb=function(t,e,n,r){i(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(n=t.b,e=t.s,r=t.o,t=t.h),t*=360;var o,s,a,u,h;return t=t%360/60,h=n*e,u=h*(1-M(t%2-1)),o=s=a=n-h,t=~~t,o+=[h,u,0,0,u,h][t],s+=[u,h,h,u,0,0][t],a+=[0,0,u,h,h,u][t],K(o,s,a,r)},n.hsl2rgb=function(t,e,n,r){i(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(n=t.l,e=t.s,t=t.h),(t>1||e>1||n>1)&&(t/=360,e/=100,n/=100),t*=360;var o,s,a,u,h;return t=t%360/60,h=2*e*(n<.5?n:1-n),u=h*(1-M(t%2-1)),o=s=a=n-h/2,t=~~t,o+=[h,u,0,0,u,h][t],s+=[u,h,h,u,0,0][t],a+=[0,0,u,h,h,u][t],K(o,s,a,r)},n.rgb2hsb=function(t,e,n){n=J(t,e,n),t=n[0],e=n[1],n=n[2];var r,i,o,s;return o=A(t,e,n),s=o-T(t,e,n),r=0==s?null:o==t?(e-n)/s:o==e?(n-t)/s+2:(t-e)/s+4,r=(r+360)%6*60/360,i=0==s?0:s/o,{h:r,s:i,b:o,toString:W}},n.rgb2hsl=function(t,e,n){n=J(t,e,n),t=n[0],e=n[1],n=n[2];var r,i,o,s,a,u;return s=A(t,e,n),a=T(t,e,n),u=s-a,r=0==u?null:s==t?(e-n)/u:s==e?(n-t)/u+2:(t-e)/u+4,r=(r+360)%6*60/360,o=(s+a)/2,i=0==u?0:o<.5?u/(2*o):u/(2-2*o),{h:r,s:i,l:o,toString:Z}},n.parsePathString=function(t){if(!t)return null;var e=n.path(t);if(e.arr)return n.path.clone(e.arr);var r={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},o=[];return i(t,"array")&&i(t[0],"array")&&(o=n.path.clone(t)),o.length||S(t).replace(N,function(t,e,n){var i=[],s=e.toLowerCase();if(n.replace(G,function(t,e){e&&i.push(+e)}),"m"==s&&i.length>2&&(o.push([e].concat(i.splice(0,2))),s="l",e="m"==e?"l":"L"),"o"==s&&1==i.length&&o.push([e,i[0]]),"r"==s)o.push([e].concat(i));else for(;i.length>=r[s]&&(o.push([e].concat(i.splice(0,r[s]))),r[s]););}),o.toString=n.path.toString,e.arr=n.path.clone(o),o};var tt=n.parseTransformString=function(t){if(!t)return null;var e=[];return i(t,"array")&&i(t[0],"array")&&(e=n.path.clone(t)),e.length||S(t).replace(V,function(t,n,r){var i=[];n.toLowerCase();r.replace(G,function(t,e){e&&i.push(+e)}),e.push([n].concat(i))}),e.toString=n.path.toString,e};n._.svgTransform2string=l,n._.rgTransform=/^[a-z][\s]*-?\.?\d/i,n._.transform2matrix=p,n._unit2px=m;k.doc.contains||k.doc.compareDocumentPosition?function(t,e){var n=9==t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t==r||!(!r||1!=r.nodeType||!(n.contains?n.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e;)if(e=e.parentNode,e==t)return!0;return!1};n._.getSomeDefs=f,n._.getSomeSVG=d,n.select=function(t){return t=S(t).replace(/([^\\]):/g,"$1\\:"),w(k.doc.querySelector(t))},n.selectAll=function(t){for(var e=k.doc.querySelectorAll(t),r=(n.set||Array)(),i=0;i<e.length;i++)r.push(w(e[i]));return r},setInterval(function(){for(var t in Y)if(Y[P](t)){var e=Y[t],n=e.node;("svg"!=e.type&&!n.ownerSVGElement||"svg"==e.type&&(!n.parentNode||"ownerSVGElement"in n.parentNode&&!n.ownerSVGElement))&&delete Y[t]}},1e4),y.prototype.attr=function(t,n){var r=this,o=r.node;if(!t){if(1!=o.nodeType)return{text:o.nodeValue};for(var s=o.attributes,a={},u=0,h=s.length;u<h;u++)a[s[u].nodeName]=s[u].nodeValue;return a}if(i(t,"string")){if(!(arguments.length>1))return e("snap.util.getattr."+t,r).firstDefined();var c={};c[t]=n,t=c}for(var l in t)t[P](l)&&e("snap.util.attr."+l,r,t[l]);return r},n.parse=function(t){var e=k.doc.createDocumentFragment(),n=!0,r=k.doc.createElement("div");if(t=S(t),t.match(/^\s*<\s*svg(?:\s|>)/)||(t="<svg>"+t+"</svg>",n=!1),r.innerHTML=t,t=r.getElementsByTagName("svg")[0])if(n)e=t;else for(;t.firstChild;)e.appendChild(t.firstChild);return new _(e)},n.fragment=function(){for(var t=Array.prototype.slice.call(arguments,0),e=k.doc.createDocumentFragment(),r=0,i=t.length;r<i;r++){var o=t[r];o.node&&o.node.nodeType&&e.appendChild(o.node),o.nodeType&&e.appendChild(o),"string"==typeof o&&e.appendChild(n.parse(o).node)}return new _(e)},n._.make=b,n._.wrap=w,x.prototype.el=function(t,e){var n=b(t,this.node);return e&&n.attr(e),n},y.prototype.children=function(){for(var t=[],e=this.node.childNodes,r=0,i=e.length;r<i;r++)t[r]=n(e[r]);return t},y.prototype.toJSON=function(){var t=[];return C([this],t),t[0]},e.on("snap.util.getattr",function(){var t=e.nt();t=t.substring(t.lastIndexOf(".")+1);var n=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});return et[P](n)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(n):r(this.node,t)});var et={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};e.on("snap.util.attr",function(t){var n=e.nt(),i={};n=n.substring(n.lastIndexOf(".")+1),i[n]=t;var o=n.replace(/-(\w)/gi,function(t,e){return e.toUpperCase()}),s=n.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});et[P](s)?this.node.style[o]=null==t?R:t:r(this.node,i)}),function(t){}(x.prototype),n.ajax=function(t,n,r,o){var s=new XMLHttpRequest,a=U();if(s){if(i(n,"function"))o=r,r=n,n=null;else if(i(n,"object")){var u=[];for(var h in n)n.hasOwnProperty(h)&&u.push(encodeURIComponent(h)+"="+encodeURIComponent(n[h]));n=u.join("&")}return s.open(n?"POST":"GET",t,!0),n&&(s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),r&&(e.once("snap.ajax."+a+".0",r),e.once("snap.ajax."+a+".200",r),e.once("snap.ajax."+a+".304",r)),s.onreadystatechange=function(){4==s.readyState&&e("snap.ajax."+a+"."+s.status,o,s)},4==s.readyState?s:(s.send(n),s)}},n.load=function(t,e,r){n.ajax(t,function(t){var i=n.parse(t.responseText);r?e.call(r,i):e(i)})};var nt=function(t){var e=t.getBoundingClientRect(),n=t.ownerDocument,r=n.body,i=n.documentElement,o=i.clientTop||r.clientTop||0,s=i.clientLeft||r.clientLeft||0,a=e.top+(g.win.pageYOffset||i.scrollTop||r.scrollTop)-o,u=e.left+(g.win.pageXOffset||i.scrollLeft||r.scrollLeft)-s;return{y:a,x:u}};return n.getElementByPoint=function(t,e){var n=this,r=(n.canvas,k.doc.elementFromPoint(t,e));if(k.win.opera&&"svg"==r.tagName){var i=nt(r),o=r.createSVGRect();o.x=t-i.x,o.y=e-i.y,o.width=o.height=1;var s=r.getIntersectionList(o,null);s.length&&(r=s[s.length-1])}return r?w(r):null},n.plugin=function(t){t(n,y,x,k,_)},k.win.Snap=n,n}(t||this);return r.plugin(function(r,i,o,s,a){function u(t,e){if(null==e){var n=!0;if(e="linearGradient"==t.type||"radialGradient"==t.type?t.node.getAttribute("gradientTransform"):"pattern"==t.type?t.node.getAttribute("patternTransform"):t.node.getAttribute("transform"),!e)return new r.Matrix;e=r._.svgTransform2string(e)}else e=r._.rgTransform.test(e)?d(e).replace(/\.{3}|\u2026/g,t._.transform||E):r._.svgTransform2string(e),f(e,"array")&&(e=r.path?r.path.toString.call(e):d(e)),t._.transform=e;var i=r._.transform2matrix(e,t.getBBox(1));return n?i:void(t.matrix=i)}function h(t){function e(t,e){var n=g(t.node,e);n=n&&n.match(o),n=n&&n[2],n&&"#"==n.charAt()&&(n=n.substring(1),n&&(a[n]=(a[n]||[]).concat(function(n){var r={};r[e]=URL(n),g(t.node,r)})))}function n(t){var e=g(t.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1),e&&(a[e]=(a[e]||[]).concat(function(e){t.attr("xlink:href","#"+e)})))}for(var r,i=t.selectAll("*"),o=/^\s*url\(("|'|)(.*)\1\)\s*$/,s=[],a={},u=0,h=i.length;u<h;u++){r=i[u],e(r,"fill"),e(r,"stroke"),e(r,"filter"),e(r,"mask"),e(r,"clip-path"),n(r);var c=g(r.node,"id");c&&(g(r.node,{id:r.id}),s.push({old:c,id:r.id}))}for(u=0,h=s.length;u<h;u++){var l=a[s[u].old];if(l)for(var p=0,f=l.length;p<f;p++)l[p](s[u].id)}}function c(t,e,n){return function(r){var i=r.slice(t,e);return 1==i.length&&(i=i[0]),n?n(i):i}}function l(t){return function(){var e=t?"<"+this.type:"",n=this.node.attributes,r=this.node.childNodes;if(t)for(var i=0,o=n.length;i<o;i++)e+=" "+n[i].name+'="'+n[i].value.replace(/"/g,'\\"')+'"';if(r.length){for(t&&(e+=">"),i=0,o=r.length;i<o;i++)3==r[i].nodeType?e+=r[i].nodeValue:1==r[i].nodeType&&(e+=b(r[i]).toString());t&&(e+="</"+this.type+">")}else t&&(e+="/>");return e}}var p=i.prototype,f=r.is,d=String,m=r._unit2px,g=r._.$,v=r._.make,y=r._.getSomeDefs,_="hasOwnProperty",b=r._.wrap;p.getBBox=function(t){if(!r.Matrix||!r.path)return this.node.getBBox();var e=this,n=new r.Matrix;if(e.removed)return r._.box();for(;"use"==e.type;)if(t||(n=n.add(e.transform().localMatrix.translate(e.attr("x")||0,e.attr("y")||0))),e.original)e=e.original;else{var i=e.attr("xlink:href");e=e.original=e.node.ownerDocument.getElementById(i.substring(i.indexOf("#")+1))}var o=e._,s=r.path.get[e.type]||r.path.get.deflt;try{return t?(o.bboxwt=s?r.path.getBBox(e.realPath=s(e)):r._.box(e.node.getBBox()),r._.box(o.bboxwt)):(e.realPath=s(e),e.matrix=e.transform().localMatrix,o.bbox=r.path.getBBox(r.path.map(e.realPath,n.add(e.matrix))),r._.box(o.bbox))}catch(a){return r._.box()}};var x=function(){return this.string};p.transform=function(t){var e=this._;if(null==t){for(var n,i=this,o=new r.Matrix(this.node.getCTM()),s=u(this),a=[s],h=new r.Matrix,c=s.toTransformString(),l=d(s)==d(this.matrix)?d(e.transform):c;"svg"!=i.type&&(i=i.parent());)a.push(u(i));for(n=a.length;n--;)h.add(a[n]);return{string:l,globalMatrix:o,totalMatrix:h,localMatrix:s,diffMatrix:o.clone().add(s.invert()),global:o.toTransformString(),total:h.toTransformString(),local:c,toString:x}}return t instanceof r.Matrix?(this.matrix=t,this._.transform=t.toTransformString()):u(this,t),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?g(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?g(this.node,{patternTransform:this.matrix}):g(this.node,{transform:this.matrix})),this},p.parent=function(){return b(this.node.parentNode)},p.append=p.add=function(t){if(t){if("set"==t.type){var e=this;return t.forEach(function(t){e.add(t)}),this}t=b(t),this.node.appendChild(t.node),t.paper=this.paper}return this},p.appendTo=function(t){return t&&(t=b(t),t.append(this)),this},p.prepend=function(t){if(t){if("set"==t.type){var e,n=this;return t.forEach(function(t){e?e.after(t):n.prepend(t),e=t}),this}t=b(t);var r=t.parent();this.node.insertBefore(t.node,this.node.firstChild),this.add&&this.add(),t.paper=this.paper,this.parent()&&this.parent().add(),r&&r.add()}return this},p.prependTo=function(t){return t=b(t),t.prepend(this),this},p.before=function(t){if("set"==t.type){var e=this;return t.forEach(function(t){var n=t.parent();e.node.parentNode.insertBefore(t.node,e.node),n&&n.add()}),this.parent().add(),this}t=b(t);var n=t.parent();return this.node.parentNode.insertBefore(t.node,this.node),this.parent()&&this.parent().add(),n&&n.add(),t.paper=this.paper,this},p.after=function(t){t=b(t);var e=t.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(t.node,this.node.nextSibling):this.node.parentNode.appendChild(t.node),this.parent()&&this.parent().add(),e&&e.add(),t.paper=this.paper,this},p.insertBefore=function(t){t=b(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},p.insertAfter=function(t){t=b(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node.nextSibling),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},p.remove=function(){var t=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,t&&t.add(),this},p.select=function(t){return t=d(t).replace(/([^\\]):/g,"$1\\:"),b(this.node.querySelector(t))},p.selectAll=function(t){for(var e=this.node.querySelectorAll(t),n=(r.set||Array)(),i=0;i<e.length;i++)n.push(b(e[i]));return n},p.asPX=function(t,e){return null==e&&(e=this.attr(t)),+m(this,t,e)},p.use=function(){var t,e=this.node.id;return e||(e=this.id,g(this.node,{id:e})),t="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?v(this.type,this.node.parentNode):v("use",this.node.parentNode),g(t.node,{"xlink:href":"#"+e}),t.original=this,t},p.clone=function(){var t=b(this.node.cloneNode(!0));return g(t.node,"id")&&g(t.node,{id:t.id}),h(t),t.insertAfter(this),t},p.toDefs=function(){var t=y(this);return t.appendChild(this.node),this},p.pattern=p.toPattern=function(t,e,n,r){var i=v("pattern",y(this));return null==t&&(t=this.getBBox()),f(t,"object")&&"x"in t&&(e=t.y,n=t.width,r=t.height,t=t.x),g(i.node,{x:t,y:e,width:n,height:r,patternUnits:"userSpaceOnUse",id:i.id,viewBox:[t,e,n,r].join(" ")}),i.node.appendChild(this.node),i},p.marker=function(t,e,n,r,i,o){var s=v("marker",y(this));return null==t&&(t=this.getBBox()),f(t,"object")&&"x"in t&&(e=t.y,n=t.width,r=t.height,i=t.refX||t.cx,o=t.refY||t.cy,t=t.x),g(s.node,{viewBox:[t,e,n,r].join(" "),markerWidth:n,markerHeight:r,orient:"auto",refX:i||0,refY:o||0,id:s.id}),s.node.appendChild(this.node),s};var w=function(t,e,r,i){"function"!=typeof r||r.length||(i=r,r=n.linear),this.attr=t,this.dur=e,r&&(this.easing=r),i&&(this.callback=i)};r._.Animation=w,r.animation=function(t,e,n,r){return new w(t,e,n,r)},p.inAnim=function(){var t=this,e=[];for(var n in t.anims)t.anims[_](n)&&!function(t){e.push({anim:new w(t._attrs,t.dur,t.easing,t._callback),mina:t,curStatus:t.status(),status:function(e){return t.status(e)},stop:function(){t.stop()}})}(t.anims[n]);return e},r.animate=function(t,r,i,o,s,a){"function"!=typeof s||s.length||(a=s,s=n.linear);var u=n.time(),h=n(t,r,u,u+o,n.time,i,s);return a&&e.once("mina.finish."+h.id,a),h},p.stop=function(){for(var t=this.inAnim(),e=0,n=t.length;e<n;e++)t[e].stop();return this},p.animate=function(t,r,i,o){"function"!=typeof i||i.length||(o=i,i=n.linear),t instanceof w&&(o=t.callback,i=t.easing,r=i.dur,t=t.attr);var s,a,u,h,l=[],p=[],m={},g=this;for(var v in t)if(t[_](v)){g.equal?(h=g.equal(v,d(t[v])),s=h.from,a=h.to,u=h.f):(s=+g.attr(v),a=+t[v]);var y=f(s,"array")?s.length:1;m[v]=c(l.length,l.length+y,u),l=l.concat(s),p=p.concat(a)}var b=n.time(),x=n(l,p,b,b+r,n.time,function(t){var e={};for(var n in m)m[_](n)&&(e[n]=m[n](t));g.attr(e)},i);return g.anims[x.id]=x,x._attrs=t,x._callback=o,e("snap.animcreated."+g.id,x),e.once("mina.finish."+x.id,function(){delete g.anims[x.id],o&&o.call(g)}),e.once("mina.stop."+x.id,function(){delete g.anims[x.id]}),g};var C={};p.data=function(t,n){var i=C[this.id]=C[this.id]||{};if(0==arguments.length)return e("snap.data.get."+this.id,this,i,null),i;if(1==arguments.length){if(r.is(t,"object")){for(var o in t)t[_](o)&&this.data(o,t[o]);return this}return e("snap.data.get."+this.id,this,i[t],t),i[t]}return i[t]=n,e("snap.data.set."+this.id,this,n,t),this},p.removeData=function(t){return null==t?C[this.id]={}:C[this.id]&&delete C[this.id][t],this},p.outerSVG=p.toString=l(1),p.innerSVG=l(),p.toDataURL=function(){if(t&&t.btoa){var e=this.getBBox(),n=r.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)))}},a.prototype.select=p.select,a.prototype.selectAll=p.selectAll}),r.plugin(function(t,e,n,r,i){function o(t,e,n,r,i,o){return null==e&&"[object SVGMatrix]"==s.call(t)?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,void(this.f=t.f)):void(null!=t?(this.a=+t,this.b=+e,this.c=+n,this.d=+r,this.e=+i,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0))}var s=Object.prototype.toString,a=String,u=Math,h="";!function(e){function n(t){return t[0]*t[0]+t[1]*t[1]}function r(t){var e=u.sqrt(n(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,n,r,i,s){var a,u,h,c,l=[[],[],[]],p=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[t,n,i],[e,r,s],[0,0,1]];for(t&&t instanceof o&&(f=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),a=0;a<3;a++)for(u=0;u<3;u++){for(c=0,h=0;h<3;h++)c+=p[a][h]*f[h][u];l[a][u]=c}return this.a=l[0][0],this.b=l[1][0],this.c=l[0][1],this.d=l[1][1],this.e=l[0][2],this.f=l[1][2],this},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new o(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){return this.add(1,0,0,1,t,e)},e.scale=function(t,e,n,r){return null==e&&(e=t),(n||r)&&this.add(1,0,0,1,n,r),this.add(t,0,0,e,0,0),(n||r)&&this.add(1,0,0,1,-n,-r),this},e.rotate=function(e,n,r){e=t.rad(e),n=n||0,r=r||0;var i=+u.cos(e).toFixed(9),o=+u.sin(e).toFixed(9);return this.add(i,o,-o,i,n,r),this.add(1,0,0,1,-n,-r)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[a.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.determinant=function(){return this.a*this.d-this.b*this.c},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var i=[[this.a,this.c],[this.b,this.d]];e.scalex=u.sqrt(n(i[0])),r(i[0]),e.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*e.shear,i[1][1]-i[0][1]*e.shear],e.scaley=u.sqrt(n(i[1])),r(i[1]),e.shear/=e.scaley,this.determinant()<0&&(e.scalex=-e.scalex);var o=-i[0][1],s=i[1][1];return s<0?(e.rotate=t.deg(u.acos(s)),o<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(u.asin(o)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){var e=t||this.split();return+e.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[+e.dx.toFixed(4),+e.dy.toFixed(4)]:h)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:h)+(e.rotate?"r"+[+e.rotate.toFixed(4),0,0]:h))}}(o.prototype),t.Matrix=o,t.matrix=function(t,e,n,r,i,s){return new o(t,e,n,r,i,s)}}),r.plugin(function(t,n,r,i,o){function s(r){return function(i){if(e.stop(),i instanceof o&&1==i.node.childNodes.length&&("radialGradient"==i.node.firstChild.tagName||"linearGradient"==i.node.firstChild.tagName||"pattern"==i.node.firstChild.tagName)&&(i=i.node.firstChild,f(this).appendChild(i),i=l(i)),i instanceof n)if("radialGradient"==i.type||"linearGradient"==i.type||"pattern"==i.type){i.node.id||m(i.node,{id:i.id});var s=g(i.node.id)}else s=i.attr(r);else if(s=t.color(i),s.error){var a=t(f(this).ownerSVGElement).gradient(i);a?(a.node.id||m(a.node,{id:a.id}),s=g(a.node.id)):s=i}else s=v(s);var u={};u[r]=s,m(this.node,u),this.node.style[r]=_}}function a(t){e.stop(),t==+t&&(t+="px"),this.node.style.fontSize=t}function u(t){for(var e=[],n=t.childNodes,r=0,i=n.length;r<i;r++){var o=n[r];3==o.nodeType&&e.push(o.nodeValue),"tspan"==o.tagName&&(1==o.childNodes.length&&3==o.firstChild.nodeType?e.push(o.firstChild.nodeValue):e.push(u(o)))}return e}function h(){return e.stop(),this.node.style.fontSize}var c=t._.make,l=t._.wrap,p=t.is,f=t._.getSomeDefs,d=/^url\(#?([^)]+)\)$/,m=t._.$,g=t.url,v=String,y=t._.separator,_="";e.on("snap.util.attr.mask",function(t){if(t instanceof n||t instanceof o){if(e.stop(),t instanceof o&&1==t.node.childNodes.length&&(t=t.node.firstChild,f(this).appendChild(t),t=l(t)),"mask"==t.type)var r=t;else r=c("mask",f(this)),r.node.appendChild(t.node);!r.node.id&&m(r.node,{id:r.id}),m(this.node,{mask:g(r.id)})}}),function(t){e.on("snap.util.attr.clip",t),e.on("snap.util.attr.clip-path",t),e.on("snap.util.attr.clipPath",t)}(function(t){if(t instanceof n||t instanceof o){if(e.stop(),"clipPath"==t.type)var r=t;else r=c("clipPath",f(this)),r.node.appendChild(t.node),!r.node.id&&m(r.node,{id:r.id});m(this.node,{"clip-path":g(r.node.id||r.id)})}}),e.on("snap.util.attr.fill",s("fill")),e.on("snap.util.attr.stroke",s("stroke"));var b=/^([lr])(?:\(([^)]*)\))?(.*)$/i;e.on("snap.util.grad.parse",function(t){t=v(t);var e=t.match(b);if(!e)return null;var n=e[1],r=e[2],i=e[3];return r=r.split(/\s*,\s*/).map(function(t){return+t==t?+t:t}),1==r.length&&0==r[0]&&(r=[]),i=i.split("-"),i=i.map(function(t){t=t.split(":");var e={color:t[0]};return t[1]&&(e.offset=parseFloat(t[1])),e}),{type:n,params:r,stops:i}}),e.on("snap.util.attr.d",function(n){e.stop(),p(n,"array")&&p(n[0],"array")&&(n=t.path.toString.call(n)),n=v(n),
n.match(/[ruo]/i)&&(n=t.path.toAbsolute(n)),m(this.node,{d:n})})(-1),e.on("snap.util.attr.#text",function(t){e.stop(),t=v(t);for(var n=i.doc.createTextNode(t);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(n)})(-1),e.on("snap.util.attr.path",function(t){e.stop(),this.attr({d:t})})(-1),e.on("snap.util.attr.class",function(t){e.stop(),this.node.className.baseVal=t})(-1),e.on("snap.util.attr.viewBox",function(t){var n;n=p(t,"object")&&"x"in t?[t.x,t.y,t.width,t.height].join(" "):p(t,"array")?t.join(" "):t,m(this.node,{viewBox:n}),e.stop()})(-1),e.on("snap.util.attr.transform",function(t){this.transform(t),e.stop()})(-1),e.on("snap.util.attr.r",function(t){"rect"==this.type&&(e.stop(),m(this.node,{rx:t,ry:t}))})(-1),e.on("snap.util.attr.textpath",function(t){if(e.stop(),"text"==this.type){var r,i,o;if(!t&&this.textPath){for(i=this.textPath;i.node.firstChild;)this.node.appendChild(i.node.firstChild);return i.remove(),void delete this.textPath}if(p(t,"string")){var s=f(this),a=l(s.parentNode).path(t);s.appendChild(a.node),r=a.id,a.attr({id:r})}else t=l(t),t instanceof n&&(r=t.attr("id"),r||(r=t.id,t.attr({id:r})));if(r)if(i=this.textPath,o=this.node,i)i.attr({"xlink:href":"#"+r});else{for(i=m("textPath",{"xlink:href":"#"+r});o.firstChild;)i.appendChild(o.firstChild);o.appendChild(i),this.textPath=l(i)}}})(-1),e.on("snap.util.attr.text",function(t){if("text"==this.type){for(var n=this.node,r=function(t){var e=m("tspan");if(p(t,"array"))for(var n=0;n<t.length;n++)e.appendChild(r(t[n]));else e.appendChild(i.doc.createTextNode(t));return e.normalize&&e.normalize(),e};n.firstChild;)n.removeChild(n.firstChild);for(var o=r(t);o.firstChild;)n.appendChild(o.firstChild)}e.stop()})(-1),e.on("snap.util.attr.fontSize",a)(-1),e.on("snap.util.attr.font-size",a)(-1),e.on("snap.util.getattr.transform",function(){return e.stop(),this.transform()})(-1),e.on("snap.util.getattr.textpath",function(){return e.stop(),this.textPath})(-1),function(){function n(n){return function(){e.stop();var r=i.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+n);return"none"==r?r:t(i.doc.getElementById(r.match(d)[1]))}}function r(t){return function(n){e.stop();var r="marker"+t.charAt(0).toUpperCase()+t.substring(1);if(""==n||!n)return void(this.node.style[r]="none");if("marker"==n.type){var i=n.node.id;return i||m(n.node,{id:n.id}),void(this.node.style[r]=g(i))}}}e.on("snap.util.getattr.marker-end",n("end"))(-1),e.on("snap.util.getattr.markerEnd",n("end"))(-1),e.on("snap.util.getattr.marker-start",n("start"))(-1),e.on("snap.util.getattr.markerStart",n("start"))(-1),e.on("snap.util.getattr.marker-mid",n("mid"))(-1),e.on("snap.util.getattr.markerMid",n("mid"))(-1),e.on("snap.util.attr.marker-end",r("end"))(-1),e.on("snap.util.attr.markerEnd",r("end"))(-1),e.on("snap.util.attr.marker-start",r("start"))(-1),e.on("snap.util.attr.markerStart",r("start"))(-1),e.on("snap.util.attr.marker-mid",r("mid"))(-1),e.on("snap.util.attr.markerMid",r("mid"))(-1)}(),e.on("snap.util.getattr.r",function(){if("rect"==this.type&&m(this.node,"rx")==m(this.node,"ry"))return e.stop(),m(this.node,"rx")})(-1),e.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){e.stop();var t=u(this.node);return 1==t.length?t[0]:t}})(-1),e.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1),e.on("snap.util.getattr.viewBox",function(){e.stop();var n=m(this.node,"viewBox");return n?(n=n.split(y),t._.box(+n[0],+n[1],+n[2],+n[3])):void 0})(-1),e.on("snap.util.getattr.points",function(){var t=m(this.node,"points");return e.stop(),t?t.split(y):void 0})(-1),e.on("snap.util.getattr.path",function(){var t=m(this.node,"d");return e.stop(),t})(-1),e.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1),e.on("snap.util.getattr.fontSize",h)(-1),e.on("snap.util.getattr.font-size",h)(-1)}),r.plugin(function(t,e,n,r,i){var o=/\S+/g,s=String,a=e.prototype;a.addClass=function(t){var e,n,r,i,a=s(t||"").match(o)||[],u=this.node,h=u.className.baseVal,c=h.match(o)||[];if(a.length){for(e=0;r=a[e++];)n=c.indexOf(r),~n||c.push(r);i=c.join(" "),h!=i&&(u.className.baseVal=i)}return this},a.removeClass=function(t){var e,n,r,i,a=s(t||"").match(o)||[],u=this.node,h=u.className.baseVal,c=h.match(o)||[];if(c.length){for(e=0;r=a[e++];)n=c.indexOf(r),~n&&c.splice(n,1);i=c.join(" "),h!=i&&(u.className.baseVal=i)}return this},a.hasClass=function(t){var e=this.node,n=e.className.baseVal,r=n.match(o)||[];return!!~r.indexOf(t)},a.toggleClass=function(t,e){if(null!=e)return e?this.addClass(t):this.removeClass(t);var n,r,i,s,a=(t||"").match(o)||[],u=this.node,h=u.className.baseVal,c=h.match(o)||[];for(n=0;i=a[n++];)r=c.indexOf(i),~r?c.splice(r,1):c.push(i);return s=c.join(" "),h!=s&&(u.className.baseVal=s),this}}),r.plugin(function(t,n,r,i,o){function s(t){return t}function a(t){return function(e){return+e.toFixed(3)+t}}var u={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e}},h=String,c=/[a-z]+$/i,l=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;e.on("snap.util.attr",function(t){var n=h(t).match(l);if(n){var r=e.nt(),i=r.substring(r.lastIndexOf(".")+1),o=this.attr(i),s={};e.stop();var a=n[3]||"",p=o.match(c),f=u[n[1]];if(p&&p==a?t=f(parseFloat(o),+n[2]):(o=this.asPX(i),t=f(this.asPX(i),this.asPX(i,n[2]+a))),isNaN(o)||isNaN(t))return;s[i]=t,this.attr(s)}})(-10),e.on("snap.util.equal",function(t,n){var r=h(this.attr(t)||""),i=h(n).match(l);if(i){e.stop();var o=i[3]||"",p=r.match(c),f=u[i[1]];return p&&p==o?{from:parseFloat(r),to:f(parseFloat(r),+i[2]),f:a(p)}:(r=this.asPX(t),{from:r,to:f(r,this.asPX(t,i[2]+o)),f:s})}})(-10)}),r.plugin(function(n,r,i,o,s){var a=i.prototype,u=n.is;a.rect=function(t,e,n,r,i,o){var s;return null==o&&(o=i),u(t,"object")&&"[object Object]"==t?s=t:null!=t&&(s={x:t,y:e,width:n,height:r},null!=i&&(s.rx=i,s.ry=o)),this.el("rect",s)},a.circle=function(t,e,n){var r;return u(t,"object")&&"[object Object]"==t?r=t:null!=t&&(r={cx:t,cy:e,r:n}),this.el("circle",r)};var h=function(){function t(){this.parentNode.removeChild(this)}return function(e,n){var r=o.doc.createElement("img"),i=o.doc.body;r.style.cssText="position:absolute;left:-9999em;top:-9999em",r.onload=function(){n.call(r),r.onload=r.onerror=null,i.removeChild(r)},r.onerror=t,i.appendChild(r),r.src=e}}();a.image=function(t,e,r,i,o){var s=this.el("image");if(u(t,"object")&&"src"in t)s.attr(t);else if(null!=t){var a={"xlink:href":t,preserveAspectRatio:"none"};null!=e&&null!=r&&(a.x=e,a.y=r),null!=i&&null!=o?(a.width=i,a.height=o):h(t,function(){n._.$(s.node,{width:this.offsetWidth,height:this.offsetHeight})}),n._.$(s.node,a)}return s},a.ellipse=function(t,e,n,r){var i;return u(t,"object")&&"[object Object]"==t?i=t:null!=t&&(i={cx:t,cy:e,rx:n,ry:r}),this.el("ellipse",i)},a.path=function(t){var e;return u(t,"object")&&!u(t,"array")?e=t:t&&(e={d:t}),this.el("path",e)},a.group=a.g=function(t){var e=this.el("g");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.svg=function(t,e,n,r,i,o,s,a){var h={};return u(t,"object")&&null==e?h=t:(null!=t&&(h.x=t),null!=e&&(h.y=e),null!=n&&(h.width=n),null!=r&&(h.height=r),null!=i&&null!=o&&null!=s&&null!=a&&(h.viewBox=[i,o,s,a])),this.el("svg",h)},a.mask=function(t){var e=this.el("mask");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.ptrn=function(t,e,n,r,i,o,s,a){if(u(t,"object"))var h=t;else h={patternUnits:"userSpaceOnUse"},t&&(h.x=t),e&&(h.y=e),null!=n&&(h.width=n),null!=r&&(h.height=r),null!=i&&null!=o&&null!=s&&null!=a?h.viewBox=[i,o,s,a]:h.viewBox=[t||0,e||0,n||0,r||0];return this.el("pattern",h)},a.use=function(t){return null!=t?(t instanceof r&&(t.attr("id")||t.attr({id:n._.id(t)}),t=t.attr("id")),"#"==String(t).charAt()&&(t=t.substring(1)),this.el("use",{"xlink:href":"#"+t})):r.prototype.use.call(this)},a.symbol=function(t,e,n,r){var i={};return null!=t&&null!=e&&null!=n&&null!=r&&(i.viewBox=[t,e,n,r]),this.el("symbol",i)},a.text=function(t,e,n){var r={};return u(t,"object")?r=t:null!=t&&(r={x:t,y:e,text:n||""}),this.el("text",r)},a.line=function(t,e,n,r){var i={};return u(t,"object")?i=t:null!=t&&(i={x1:t,x2:n,y1:e,y2:r}),this.el("line",i)},a.polyline=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return u(t,"object")&&!u(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polyline",e)},a.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return u(t,"object")&&!u(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polygon",e)},function(){function r(){return this.selectAll("stop")}function i(t,e){var r=c("stop"),i={offset:+e+"%"};return t=n.color(t),i["stop-color"]=t.hex,t.opacity<1&&(i["stop-opacity"]=t.opacity),c(r,i),this.node.appendChild(r),this}function o(){if("linearGradient"==this.type){var t=c(this.node,"x1")||0,e=c(this.node,"x2")||1,r=c(this.node,"y1")||0,i=c(this.node,"y2")||0;return n._.box(t,r,math.abs(e-t),math.abs(i-r))}var o=this.node.cx||.5,s=this.node.cy||.5,a=this.node.r||0;return n._.box(o-a,s-a,2*a,2*a)}function s(t,n){function r(t,e){for(var n=(e-l)/(t-p),r=p;r<t;r++)s[r].offset=+(+l+n*(r-p)).toFixed(2);p=t,l=e}var i,o=e("snap.util.grad.parse",null,n).firstDefined();if(!o)return null;o.params.unshift(t),i="l"==o.type.toLowerCase()?u.apply(0,o.params):h.apply(0,o.params),o.type!=o.type.toLowerCase()&&c(i.node,{gradientUnits:"userSpaceOnUse"});var s=o.stops,a=s.length,l=0,p=0;a--;for(var f=0;f<a;f++)"offset"in s[f]&&r(f,s[f].offset);for(s[a].offset=s[a].offset||100,r(a,s[a].offset),f=0;f<=a;f++){var d=s[f];i.addStop(d.color,d.offset)}return i}function u(t,e,s,a,u){var h=n._.make("linearGradient",t);return h.stops=r,h.addStop=i,h.getBBox=o,null!=e&&c(h.node,{x1:e,y1:s,x2:a,y2:u}),h}function h(t,e,s,a,u,h){var l=n._.make("radialGradient",t);return l.stops=r,l.addStop=i,l.getBBox=o,null!=e&&c(l.node,{cx:e,cy:s,r:a}),null!=u&&null!=h&&c(l.node,{fx:u,fy:h}),l}var c=n._.$;a.gradient=function(t){return s(this.defs,t)},a.gradientLinear=function(t,e,n,r){return u(this.defs,t,e,n,r)},a.gradientRadial=function(t,e,n,r,i){return h(this.defs,t,e,n,r,i)},a.toString=function(){var t,e=this.node.ownerDocument,r=e.createDocumentFragment(),i=e.createElement("div"),o=this.node.cloneNode(!0);return r.appendChild(i),i.appendChild(o),n._.$(o,{xmlns:"http://www.w3.org/2000/svg"}),t=i.innerHTML,r.removeChild(r.firstChild),t},a.toDataURL=function(){if(t&&t.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},a.clear=function(){for(var t,e=this.node.firstChild;e;)t=e.nextSibling,"defs"!=e.tagName?e.parentNode.removeChild(e):a.clear.call({node:e}),e=t}}()}),r.plugin(function(t,e,n,r){function i(t){var e=i.ps=i.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout(function(){for(var n in e)e[D](n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])}),e[t]}function o(t,e,n,r){return null==t&&(t=e=n=r=0),null==e&&(e=t.y,n=t.width,r=t.height,t=t.x),{x:t,y:e,width:n,w:n,height:r,h:r,x2:t+n,y2:e+r,cx:t+n/2,cy:e+r/2,r1:G.min(n,r)/2,r2:G.max(n,r)/2,r0:G.sqrt(n*n+r*r)/2,path:k(t,e,n,r),vb:[t,e,n,r].join(" ")}}function s(){return this.join(",").replace(N,"$1")}function a(t){var e=L(t);return e.toString=s,e}function u(t,e,n,r,i,o,s,a,u){return null==u?m(t,e,n,r,i,o,s,a):c(t,e,n,r,i,o,s,a,g(t,e,n,r,i,o,s,a,u))}function h(n,r){function i(t){return+(+t).toFixed(3)}return t._.cacher(function(t,o,s){t instanceof e&&(t=t.attr("d")),t=M(t);for(var a,h,l,p,f,d="",m={},g=0,v=0,y=t.length;v<y;v++){if(l=t[v],"M"==l[0])a=+l[1],h=+l[2];else{if(p=u(a,h,l[1],l[2],l[3],l[4],l[5],l[6]),g+p>o){if(r&&!m.start){if(f=u(a,h,l[1],l[2],l[3],l[4],l[5],l[6],o-g),d+=["C"+i(f.start.x),i(f.start.y),i(f.m.x),i(f.m.y),i(f.x),i(f.y)],s)return d;m.start=d,d=["M"+i(f.x),i(f.y)+"C"+i(f.n.x),i(f.n.y),i(f.end.x),i(f.end.y),i(l[5]),i(l[6])].join(),g+=p,a=+l[5],h=+l[6];continue}if(!n&&!r)return f=u(a,h,l[1],l[2],l[3],l[4],l[5],l[6],o-g)}g+=p,a=+l[5],h=+l[6]}d+=l.shift()+l}return m.end=d,f=n?g:r?m:c(a,h,l[0],l[1],l[2],l[3],l[4],l[5],1)},null,t._.clone)}function c(t,e,n,r,i,o,s,a,u){var h=1-u,c=X(h,3),l=X(h,2),p=u*u,f=p*u,d=c*t+3*l*u*n+3*h*u*u*i+f*s,m=c*e+3*l*u*r+3*h*u*u*o+f*a,g=t+2*u*(n-t)+p*(i-2*n+t),v=e+2*u*(r-e)+p*(o-2*r+e),y=n+2*u*(i-n)+p*(s-2*i+n),_=r+2*u*(o-r)+p*(a-2*o+r),b=h*t+u*n,x=h*e+u*r,w=h*i+u*s,C=h*o+u*a,k=90-180*G.atan2(g-y,v-_)/H;return{x:d,y:m,m:{x:g,y:v},n:{x:y,y:_},start:{x:b,y:x},end:{x:w,y:C},alpha:k}}function l(e,n,r,i,s,a,u,h){t.is(e,"array")||(e=[e,n,r,i,s,a,u,h]);var c=T.apply(null,e);return o(c.min.x,c.min.y,c.max.x-c.min.x,c.max.y-c.min.y)}function p(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function f(t,e){return t=o(t),e=o(e),p(e,t.x,t.y)||p(e,t.x2,t.y)||p(e,t.x,t.y2)||p(e,t.x2,t.y2)||p(t,e.x,e.y)||p(t,e.x2,e.y)||p(t,e.x,e.y2)||p(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}function d(t,e,n,r,i){var o=-3*e+9*n-9*r+3*i,s=t*o+6*e-12*n+6*r;return t*s-3*e+3*n}function m(t,e,n,r,i,o,s,a,u){null==u&&(u=1),u=u>1?1:u<0?0:u;for(var h=u/2,c=12,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,m=0;m<c;m++){var g=h*l[m]+h,v=d(g,t,n,i,s),y=d(g,e,r,o,a),_=v*v+y*y;f+=p[m]*G.sqrt(_)}return h*f}function g(t,e,n,r,i,o,s,a,u){if(!(u<0||m(t,e,n,r,i,o,s,a)<u)){var h,c=1,l=c/2,p=c-l,f=.01;for(h=m(t,e,n,r,i,o,s,a,p);q(h-u)>f;)l/=2,p+=(h<u?1:-1)*l,h=m(t,e,n,r,i,o,s,a,p);return p}}function v(t,e,n,r,i,o,s,a){if(!(U(t,n)<z(i,s)||z(t,n)>U(i,s)||U(e,r)<z(o,a)||z(e,r)>U(o,a))){var u=(t*r-e*n)*(i-s)-(t-n)*(i*a-o*s),h=(t*r-e*n)*(o-a)-(e-r)*(i*a-o*s),c=(t-n)*(o-a)-(e-r)*(i-s);if(c){var l=u/c,p=h/c,f=+l.toFixed(2),d=+p.toFixed(2);if(!(f<+z(t,n).toFixed(2)||f>+U(t,n).toFixed(2)||f<+z(i,s).toFixed(2)||f>+U(i,s).toFixed(2)||d<+z(e,r).toFixed(2)||d>+U(e,r).toFixed(2)||d<+z(o,a).toFixed(2)||d>+U(o,a).toFixed(2)))return{x:l,y:p}}}}function y(t,e,n){var r=l(t),i=l(e);if(!f(r,i))return n?0:[];for(var o=m.apply(0,t),s=m.apply(0,e),a=~~(o/8),u=~~(s/8),h=[],p=[],d={},g=n?0:[],y=0;y<a+1;y++){var _=c.apply(0,t.concat(y/a));h.push({x:_.x,y:_.y,t:y/a})}for(y=0;y<u+1;y++)_=c.apply(0,e.concat(y/u)),p.push({x:_.x,y:_.y,t:y/u});for(y=0;y<a;y++)for(var b=0;b<u;b++){var x=h[y],w=h[y+1],C=p[b],k=p[b+1],P=q(w.x-x.x)<.001?"y":"x",S=q(k.x-C.x)<.001?"y":"x",j=v(x.x,x.y,w.x,w.y,C.x,C.y,k.x,k.y);if(j){if(d[j.x.toFixed(4)]==j.y.toFixed(4))continue;d[j.x.toFixed(4)]=j.y.toFixed(4);var O=x.t+q((j[P]-x[P])/(w[P]-x[P]))*(w.t-x.t),E=C.t+q((j[S]-C[S])/(k[S]-C[S]))*(k.t-C.t);O>=0&&O<=1&&E>=0&&E<=1&&(n?g++:g.push({x:j.x,y:j.y,t1:O,t2:E}))}}return g}function _(t,e){return x(t,e)}function b(t,e){return x(t,e,1)}function x(t,e,n){t=M(t),e=M(e);for(var r,i,o,s,a,u,h,c,l,p,f=n?0:[],d=0,m=t.length;d<m;d++){var g=t[d];if("M"==g[0])r=a=g[1],i=u=g[2];else{"C"==g[0]?(l=[r,i].concat(g.slice(1)),r=l[6],i=l[7]):(l=[r,i,r,i,a,u,a,u],r=a,i=u);for(var v=0,_=e.length;v<_;v++){var b=e[v];if("M"==b[0])o=h=b[1],s=c=b[2];else{"C"==b[0]?(p=[o,s].concat(b.slice(1)),o=p[6],s=p[7]):(p=[o,s,o,s,h,c,h,c],o=h,s=c);var x=y(l,p,n);if(n)f+=x;else{for(var w=0,C=x.length;w<C;w++)x[w].segment1=d,x[w].segment2=v,x[w].bez1=l,x[w].bez2=p;f=f.concat(x)}}}}}return f}function w(t,e,n){var r=C(t);return p(r,e,n)&&x(t,[["M",e,n],["H",r.x2+10]],1)%2==1}function C(t){var e=i(t);if(e.bbox)return L(e.bbox);if(!t)return o();t=M(t);for(var n,r=0,s=0,a=[],u=[],h=0,c=t.length;h<c;h++)if(n=t[h],"M"==n[0])r=n[1],s=n[2],a.push(r),u.push(s);else{var l=T(r,s,n[1],n[2],n[3],n[4],n[5],n[6]);a=a.concat(l.min.x,l.max.x),u=u.concat(l.min.y,l.max.y),r=n[5],s=n[6]}var p=z.apply(0,a),f=z.apply(0,u),d=U.apply(0,a),m=U.apply(0,u),g=o(p,f,d-p,m-f);return e.bbox=L(g),g}function k(t,e,n,r,i){if(i)return[["M",+t+ +i,e],["l",n-2*i,0],["a",i,i,0,0,1,i,i],["l",0,r-2*i],["a",i,i,0,0,1,-i,i],["l",2*i-n,0],["a",i,i,0,0,1,-i,-i],["l",0,2*i-r],["a",i,i,0,0,1,i,-i],["z"]];var o=[["M",t,e],["l",n,0],["l",0,r],["l",-n,0],["z"]];return o.toString=s,o}function P(t,e,n,r,i){if(null==i&&null==r&&(r=n),t=+t,e=+e,n=+n,r=+r,null!=i)var o=Math.PI/180,a=t+n*Math.cos(-r*o),u=t+n*Math.cos(-i*o),h=e+n*Math.sin(-r*o),c=e+n*Math.sin(-i*o),l=[["M",a,h],["A",n,n,0,+(i-r>180),0,u,c]];else l=[["M",t,e],["m",0,-r],["a",n,r,0,1,1,0,2*r],["a",n,r,0,1,1,0,-2*r],["z"]];return l.toString=s,l}function S(e){var n=i(e),r=String.prototype.toLowerCase;if(n.rel)return a(n.rel);t.is(e,"array")&&t.is(e&&e[0],"array")||(e=t.parsePathString(e));var o=[],u=0,h=0,c=0,l=0,p=0;"M"==e[0][0]&&(u=e[0][1],h=e[0][2],c=u,l=h,p++,o.push(["M",u,h]));for(var f=p,d=e.length;f<d;f++){var m=o[f]=[],g=e[f];if(g[0]!=r.call(g[0]))switch(m[0]=r.call(g[0]),m[0]){case"a":m[1]=g[1],m[2]=g[2],m[3]=g[3],m[4]=g[4],m[5]=g[5],m[6]=+(g[6]-u).toFixed(3),m[7]=+(g[7]-h).toFixed(3);break;case"v":m[1]=+(g[1]-h).toFixed(3);break;case"m":c=g[1],l=g[2];default:for(var v=1,y=g.length;v<y;v++)m[v]=+(g[v]-(v%2?u:h)).toFixed(3)}else{m=o[f]=[],"m"==g[0]&&(c=g[1]+u,l=g[2]+h);for(var _=0,b=g.length;_<b;_++)o[f][_]=g[_]}var x=o[f].length;switch(o[f][0]){case"z":u=c,h=l;break;case"h":u+=+o[f][x-1];break;case"v":h+=+o[f][x-1];break;default:u+=+o[f][x-2],h+=+o[f][x-1]}}return o.toString=s,n.rel=a(o),o}function j(e){var n=i(e);if(n.abs)return a(n.abs);if(I(e,"array")&&I(e&&e[0],"array")||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var r,o=[],u=0,h=0,c=0,l=0,p=0;"M"==e[0][0]&&(u=+e[0][1],h=+e[0][2],c=u,l=h,p++,o[0]=["M",u,h]);for(var f,d,m=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),g=p,v=e.length;g<v;g++){if(o.push(f=[]),d=e[g],r=d[0],r!=r.toUpperCase())switch(f[0]=r.toUpperCase(),f[0]){case"A":f[1]=d[1],f[2]=d[2],f[3]=d[3],f[4]=d[4],f[5]=d[5],f[6]=+d[6]+u,f[7]=+d[7]+h;break;case"V":f[1]=+d[1]+h;break;case"H":f[1]=+d[1]+u;break;case"R":for(var y=[u,h].concat(d.slice(1)),_=2,b=y.length;_<b;_++)y[_]=+y[_]+u,y[++_]=+y[_]+h;o.pop(),o=o.concat(R(y,m));break;case"O":o.pop(),y=P(u,h,d[1],d[2]),y.push(y[0]),o=o.concat(y);break;case"U":o.pop(),o=o.concat(P(u,h,d[1],d[2],d[3])),f=["U"].concat(o[o.length-1].slice(-2));break;case"M":c=+d[1]+u,l=+d[2]+h;default:for(_=1,b=d.length;_<b;_++)f[_]=+d[_]+(_%2?u:h)}else if("R"==r)y=[u,h].concat(d.slice(1)),o.pop(),o=o.concat(R(y,m)),f=["R"].concat(d.slice(-2));else if("O"==r)o.pop(),y=P(u,h,d[1],d[2]),y.push(y[0]),o=o.concat(y);else if("U"==r)o.pop(),o=o.concat(P(u,h,d[1],d[2],d[3])),f=["U"].concat(o[o.length-1].slice(-2));else for(var x=0,w=d.length;x<w;x++)f[x]=d[x];if(r=r.toUpperCase(),"O"!=r)switch(f[0]){case"Z":u=+c,h=+l;break;case"H":u=f[1];break;case"V":h=f[1];break;case"M":c=f[f.length-2],l=f[f.length-1];default:u=f[f.length-2],h=f[f.length-1]}}return o.toString=s,n.abs=a(o),o}function O(t,e,n,r){return[t,e,n,r,n,r]}function E(t,e,n,r,i,o){var s=1/3,a=2/3;return[s*t+a*n,s*e+a*r,s*i+a*n,s*o+a*r,i,o]}function A(e,n,r,i,o,s,a,u,h,c){var l,p=120*H/180,f=H/180*(+o||0),d=[],m=t._.cacher(function(t,e,n){var r=t*G.cos(n)-e*G.sin(n),i=t*G.sin(n)+e*G.cos(n);return{x:r,y:i}});if(c)k=c[0],P=c[1],w=c[2],C=c[3];else{l=m(e,n,-f),e=l.x,n=l.y,l=m(u,h,-f),u=l.x,h=l.y;var g=(G.cos(H/180*o),G.sin(H/180*o),(e-u)/2),v=(n-h)/2,y=g*g/(r*r)+v*v/(i*i);y>1&&(y=G.sqrt(y),r=y*r,i=y*i);var _=r*r,b=i*i,x=(s==a?-1:1)*G.sqrt(q((_*b-_*v*v-b*g*g)/(_*v*v+b*g*g))),w=x*r*v/i+(e+u)/2,C=x*-i*g/r+(n+h)/2,k=G.asin(((n-C)/i).toFixed(9)),P=G.asin(((h-C)/i).toFixed(9));k=e<w?H-k:k,P=u<w?H-P:P,k<0&&(k=2*H+k),P<0&&(P=2*H+P),a&&k>P&&(k-=2*H),!a&&P>k&&(P-=2*H)}var S=P-k;if(q(S)>p){var j=P,O=u,E=h;P=k+p*(a&&P>k?1:-1),u=w+r*G.cos(P),h=C+i*G.sin(P),d=A(u,h,r,i,o,0,a,O,E,[P,j,w,C])}S=P-k;var T=G.cos(k),M=G.sin(k),F=G.cos(P),R=G.sin(P),B=G.tan(S/4),I=4/3*r*B,L=4/3*i*B,D=[e,n],N=[e+I*M,n-L*T],V=[u+I*R,h-L*F],z=[u,h];if(N[0]=2*D[0]-N[0],N[1]=2*D[1]-N[1],c)return[N,V,z].concat(d);d=[N,V,z].concat(d).join().split(",");for(var U=[],X=0,Y=d.length;X<Y;X++)U[X]=X%2?m(d[X-1],d[X],f).y:m(d[X],d[X+1],f).x;return U}function T(t,e,n,r,i,o,s,a){for(var u,h,c,l,p,f,d,m,g=[],v=[[],[]],y=0;y<2;++y)if(0==y?(h=6*t-12*n+6*i,u=-3*t+9*n-9*i+3*s,c=3*n-3*t):(h=6*e-12*r+6*o,u=-3*e+9*r-9*o+3*a,c=3*r-3*e),q(u)<1e-12){if(q(h)<1e-12)continue;l=-c/h,0<l&&l<1&&g.push(l)}else d=h*h-4*c*u,m=G.sqrt(d),d<0||(p=(-h+m)/(2*u),0<p&&p<1&&g.push(p),f=(-h-m)/(2*u),0<f&&f<1&&g.push(f));for(var _,b=g.length,x=b;b--;)l=g[b],_=1-l,v[0][b]=_*_*_*t+3*_*_*l*n+3*_*l*l*i+l*l*l*s,v[1][b]=_*_*_*e+3*_*_*l*r+3*_*l*l*o+l*l*l*a;return v[0][x]=t,v[1][x]=e,v[0][x+1]=s,v[1][x+1]=a,v[0].length=v[1].length=x+2,{min:{x:z.apply(0,v[0]),y:z.apply(0,v[1])},max:{x:U.apply(0,v[0]),y:U.apply(0,v[1])}}}function M(t,e){var n=!e&&i(t);if(!e&&n.curve)return a(n.curve);for(var r=j(t),o=e&&j(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},u={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(t,e,n){var r,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(A.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==n||"S"==n?(r=2*e.x-e.bx,i=2*e.y-e.by):(r=e.x,i=e.y),t=["C",r,i].concat(t.slice(1));break;case"T":"Q"==n||"T"==n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(E(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(E(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(O(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(O(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(O(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(O(e.x,e.y,e.X,e.Y))}return t}),c=function(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)p[e]="A",o&&(f[e]="A"),t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),v=U(r.length,o&&o.length||0)}},l=function(t,e,n,i,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",i.x,i.y]),n.bx=0,n.by=0,n.x=t[s][1],n.y=t[s][2],v=U(r.length,o&&o.length||0))},p=[],f=[],d="",m="",g=0,v=U(r.length,o&&o.length||0);g<v;g++){r[g]&&(d=r[g][0]),"C"!=d&&(p[g]=d,g&&(m=p[g-1])),r[g]=h(r[g],s,m),"A"!=p[g]&&"C"==d&&(p[g]="C"),c(r,g),o&&(o[g]&&(d=o[g][0]),"C"!=d&&(f[g]=d,g&&(m=f[g-1])),o[g]=h(o[g],u,m),"A"!=f[g]&&"C"==d&&(f[g]="C"),c(o,g)),l(r,o,s,u,g),l(o,r,u,s,g);var y=r[g],_=o&&o[g],b=y.length,x=o&&_.length;s.x=y[b-2],s.y=y[b-1],s.bx=V(y[b-4])||s.x,s.by=V(y[b-3])||s.y,u.bx=o&&(V(_[x-4])||u.x),u.by=o&&(V(_[x-3])||u.y),u.x=o&&_[x-2],u.y=o&&_[x-1]}return o||(n.curve=a(r)),o?[r,o]:r}function F(t,e){if(!e)return t;var n,r,i,o,s,a,u;for(t=M(t),i=0,s=t.length;i<s;i++)for(u=t[i],o=1,a=u.length;o<a;o+=2)n=e.x(u[o],u[o+1]),r=e.y(u[o],u[o+1]),u[o]=n,u[o+1]=r;return t}function R(t,e){for(var n=[],r=0,i=t.length;i-2*!e>r;r+=2){var o=[{x:+t[r-2],y:+t[r-1]},{x:+t[r],y:+t[r+1]},{x:+t[r+2],y:+t[r+3]},{x:+t[r+4],y:+t[r+5]}];e?r?i-4==r?o[3]={x:+t[0],y:+t[1]}:i-2==r&&(o[2]={x:+t[0],y:+t[1]},o[3]={x:+t[2],y:+t[3]}):o[0]={x:+t[i-2],y:+t[i-1]}:i-4==r?o[3]=o[2]:r||(o[0]={x:+t[r],y:+t[r+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n}var B=e.prototype,I=t.is,L=t._.clone,D="hasOwnProperty",N=/,?([a-z]),?/gi,V=parseFloat,G=Math,H=G.PI,z=G.min,U=G.max,X=G.pow,q=G.abs,Y=h(1),$=h(),W=h(0,1),Z=t._unit2px,Q={path:function(t){return t.attr("path")},circle:function(t){var e=Z(t);return P(e.cx,e.cy,e.r)},ellipse:function(t){var e=Z(t);return P(e.cx||0,e.cy||0,e.rx,e.ry)},rect:function(t){var e=Z(t);return k(e.x||0,e.y||0,e.width,e.height,e.rx,e.ry)},image:function(t){var e=Z(t);return k(e.x||0,e.y||0,e.width,e.height)},line:function(t){return"M"+[t.attr("x1")||0,t.attr("y1")||0,t.attr("x2"),t.attr("y2")]},polyline:function(t){return"M"+t.attr("points")},polygon:function(t){return"M"+t.attr("points")+"z"},deflt:function(t){var e=t.node.getBBox();return k(e.x,e.y,e.width,e.height)}};t.path=i,t.path.getTotalLength=Y,t.path.getPointAtLength=$,t.path.getSubpath=function(t,e,n){if(this.getTotalLength(t)-n<1e-6)return W(t,e).end;var r=W(t,n,1);return e?W(r,e).end:r},B.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},B.getPointAtLength=function(t){return $(this.attr("d"),t)},B.getSubpath=function(e,n){return t.path.getSubpath(this.attr("d"),e,n)},t._.box=o,t.path.findDotsAtSegment=c,t.path.bezierBBox=l,t.path.isPointInsideBBox=p,t.closest=function(e,n,r,i){for(var s=100,a=o(e-s/2,n-s/2,s,s),u=[],h=r[0].hasOwnProperty("x")?function(t){return{x:r[t].x,y:r[t].y}}:function(t){return{x:r[t],y:i[t]}},c=0;s<=1e6&&!c;){for(var l=0,f=r.length;l<f;l++){var d=h(l);if(p(a,d.x,d.y)){c++,u.push(d);break}}c||(s*=2,a=o(e-s/2,n-s/2,s,s))}if(1e6!=s){var m,g=1/0;for(l=0,f=u.length;l<f;l++){var v=t.len(e,n,u[l].x,u[l].y);g>v&&(g=v,u[l].len=v,m=u[l])}return m}},t.path.isBBoxIntersect=f,t.path.intersection=_,t.path.intersectionNumber=b,t.path.isPointInside=w,t.path.getBBox=C,t.path.get=Q,t.path.toRelative=S,t.path.toAbsolute=j,t.path.toCubic=M,t.path.map=F,t.path.toString=s,t.path.clone=a}),r.plugin(function(t,r,i,o){var s=Math.max,a=Math.min,u=function(t){if(this.items=[],this.bindings={},this.length=0,this.type="set",t)for(var e=0,n=t.length;e<n;e++)t[e]&&(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},h=u.prototype;h.push=function(){for(var t,e,n=0,r=arguments.length;n<r;n++)t=arguments[n],t&&(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},h.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},h.forEach=function(t,e){for(var n=0,r=this.items.length;n<r;n++)if(t.call(e,this.items[n],n)===!1)return this;return this},h.animate=function(r,i,o,s){"function"!=typeof o||o.length||(s=o,o=n.linear),r instanceof t._.Animation&&(s=r.callback,o=r.easing,i=o.dur,r=r.attr);var a=arguments;if(t.is(r,"array")&&t.is(a[a.length-1],"array"))var u=!0;var h,c=function(){h?this.b=h:h=this.b},l=0,p=this,f=s&&function(){++l==p.length&&s.call(this)};return this.forEach(function(t,n){e.once("snap.animcreated."+t.id,c),u?a[n]&&t.animate.apply(t,a[n]):t.animate(r,i,o,f)})},h.remove=function(){for(;this.length;)this.pop().remove();return this},h.bind=function(t,e,n){var r={};if("function"==typeof e)this.bindings[t]=e;else{var i=n||t;this.bindings[t]=function(t){r[i]=t,e.attr(r)}}return this},h.attr=function(t){var e={};for(var n in t)this.bindings[n]?this.bindings[n](t[n]):e[n]=t[n];for(var r=0,i=this.items.length;r<i;r++)this.items[r].attr(e);return this},h.clear=function(){for(;this.length;)this.pop()},h.splice=function(t,e,n){t=t<0?s(this.length+t,0):t,e=s(0,a(this.length-t,e));var r,i=[],o=[],h=[];for(r=2;r<arguments.length;r++)h.push(arguments[r]);for(r=0;r<e;r++)o.push(this[t+r]);for(;r<this.length-t;r++)i.push(this[t+r]);var c=h.length;for(r=0;r<c+i.length;r++)this.items[t+r]=this[t+r]=r<c?h[r]:i[r-c];for(r=this.items.length=this.length-=e-c;this[r];)delete this[r++];return new u(o)},h.exclude=function(t){for(var e=0,n=this.length;e<n;e++)if(this[e]==t)return this.splice(e,1),!0;return!1},h.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},h.getBBox=function(){for(var t=[],e=[],n=[],r=[],i=this.items.length;i--;)if(!this.items[i].removed){var o=this.items[i].getBBox();t.push(o.x),e.push(o.y),n.push(o.x+o.width),r.push(o.y+o.height)}return t=a.apply(0,t),e=a.apply(0,e),n=s.apply(0,n),r=s.apply(0,r),{x:t,y:e,x2:n,y2:r,width:n-t,height:r-e,cx:t+(n-t)/2,cy:e+(r-e)/2}},h.clone=function(t){t=new u;for(var e=0,n=this.items.length;e<n;e++)t.push(this.items[e].clone());return t},h.toString=function(){return"Snap‘s set"},h.type="set",t.Set=u,t.set=function(){var t=new u;return arguments.length&&t.push.apply(t,Array.prototype.slice.call(arguments,0)),t}}),r.plugin(function(t,n,r,i){function o(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}function s(e,n,r){n=v(n).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],n=t.parseTransformString(n)||[];for(var i,s,a,u,h=Math.max(e.length,n.length),c=[],f=[],d=0;d<h;d++){if(a=e[d]||o(n[d]),u=n[d]||o(a),a[0]!=u[0]||"r"==a[0].toLowerCase()&&(a[2]!=u[2]||a[3]!=u[3])||"s"==a[0].toLowerCase()&&(a[3]!=u[3]||a[4]!=u[4])){e=t._.transform2matrix(e,r()),n=t._.transform2matrix(n,r()),c=[["m",e.a,e.b,e.c,e.d,e.e,e.f]],f=[["m",n.a,n.b,n.c,n.d,n.e,n.f]];break}for(c[d]=[],f[d]=[],i=0,s=Math.max(a.length,u.length);i<s;i++)i in a&&(c[d][i]=a[i]),i in u&&(f[d][i]=u[i])}return{from:p(c),to:p(f),f:l(c)}}function a(t){return t}function u(t){return function(e){return+e.toFixed(3)+t}}function h(t){return t.join(" ")}function c(e){return t.rgb(e[0],e[1],e[2])}function l(t){var e,n,r,i,o,s,a=0,u=[];for(e=0,n=t.length;e<n;e++){for(o="[",s=['"'+t[e][0]+'"'],r=1,i=t[e].length;r<i;r++)s[r]="val["+a++ +"]";o+=s+"]",u[e]=o}return Function("val","return Snap.path.toString.call(["+u+"])")}function p(t){for(var e=[],n=0,r=t.length;n<r;n++)for(var i=1,o=t[n].length;i<o;i++)e.push(t[n][i]);return e}function f(t){return isFinite(parseFloat(t))}function d(e,n){return!(!t.is(e,"array")||!t.is(n,"array"))&&e.toString()==n.toString()}var m={},g=/[a-z]+$/i,v=String;m.stroke=m.fill="colour",n.prototype.equal=function(t,n){return e("snap.util.equal",this,t,n).firstDefined()},e.on("snap.util.equal",function(e,n){var r,i,o=v(this.attr(e)||""),y=this;if(f(o)&&f(n))return{from:parseFloat(o),to:parseFloat(n),f:a};if("colour"==m[e])return r=t.color(o),i=t.color(n),{from:[r.r,r.g,r.b,r.opacity],to:[i.r,i.g,i.b,i.opacity],f:c};if("viewBox"==e)return r=this.attr(e).vb.split(" ").map(Number),i=n.split(" ").map(Number),{from:r,to:i,f:h};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return n instanceof t.Matrix&&(n=n.toTransformString()),t._.rgTransform.test(n)||(n=t._.svgTransform2string(n)),s(o,n,function(){return y.getBBox(1)});if("d"==e||"path"==e)return r=t.path.toCubic(o,n),{from:p(r[0]),to:p(r[1]),f:l(r[0])};if("points"==e)return r=v(o).split(t._.separator),i=v(n).split(t._.separator),{from:r,to:i,f:function(t){return t}};var _=o.match(g),b=v(n).match(g);return _&&d(_,b)?{from:parseFloat(o),to:parseFloat(n),f:u(_)}:{from:this.asPX(e),to:this.asPX(e,n),f:a}})}),r.plugin(function(t,n,r,i){for(var o=n.prototype,s="hasOwnProperty",a=("createTouch"in i.doc),u=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],h={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},c=(function(t,e){var n="y"==t?"scrollTop":"scrollLeft",r=e&&e.node?e.node.ownerDocument:i.doc;return r[n in r.documentElement?"documentElement":"body"][n]}),l=function(){return this.originalEvent.preventDefault()},p=function(){return this.originalEvent.stopPropagation()},f=function(t,e,n,r){var i=a&&h[e]?h[e]:e,o=function(i){var o=c("y",r),u=c("x",r);if(a&&h[s](e))for(var f=0,d=i.targetTouches&&i.targetTouches.length;f<d;f++)if(i.targetTouches[f].target==t||t.contains(i.targetTouches[f].target)){var m=i;i=i.targetTouches[f],i.originalEvent=m,i.preventDefault=l,i.stopPropagation=p;break}var g=i.clientX+u,v=i.clientY+o;return n.call(r,i,g,v)};return e!==i&&t.addEventListener(e,o,!1),t.addEventListener(i,o,!1),function(){return e!==i&&t.removeEventListener(e,o,!1),t.removeEventListener(i,o,!1),!0}},d=[],m=function(t){for(var n,r=t.clientX,i=t.clientY,o=c("y"),s=c("x"),u=d.length;u--;){if(n=d[u],a){for(var h,l=t.touches&&t.touches.length;l--;)if(h=t.touches[l],h.identifier==n.el._drag.id||n.el.node.contains(h.target)){r=h.clientX,i=h.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var p=n.el.node;p.nextSibling,p.parentNode,p.style.display;r+=s,i+=o,e("snap.drag.move."+n.el.id,n.move_scope||n.el,r-n.el._drag.x,i-n.el._drag.y,r,i,t)}},g=function(n){t.unmousemove(m).unmouseup(g);for(var r,i=d.length;i--;)r=d[i],r.el._drag={},e("snap.drag.end."+r.el.id,r.end_scope||r.start_scope||r.move_scope||r.el,n),e.off("snap.drag.*."+r.el.id);d=[]},v=u.length;v--;)!function(e){
t[e]=o[e]=function(n,r){if(t.is(n,"function"))this.events=this.events||[],this.events.push({name:e,f:n,unbind:f(this.node||document,e,n,r||this)});else for(var i=0,o=this.events.length;i<o;i++)if(this.events[i].name==e)try{this.events[i].f.call(this)}catch(s){}return this},t["un"+e]=o["un"+e]=function(t){for(var n=this.events||[],r=n.length;r--;)if(n[r].name==e&&(n[r].f==t||!t))return n[r].unbind(),n.splice(r,1),!n.length&&delete this.events,this;return this}}(u[v]);o.hover=function(t,e,n,r){return this.mouseover(t,n).mouseout(e,r||n)},o.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var y=[];o.drag=function(n,r,i,o,s,a){function u(u,h,l){(u.originalEvent||u).preventDefault(),c._drag.x=h,c._drag.y=l,c._drag.id=u.identifier,!d.length&&t.mousemove(m).mouseup(g),d.push({el:c,move_scope:o,start_scope:s,end_scope:a}),r&&e.on("snap.drag.start."+c.id,r),n&&e.on("snap.drag.move."+c.id,n),i&&e.on("snap.drag.end."+c.id,i),e("snap.drag.start."+c.id,s||o||c,h,l,u)}function h(t,n,r){e("snap.draginit."+c.id,c,t,n,r)}var c=this;if(!arguments.length){var l;return c.drag(function(t,e){this.attr({transform:l+(l?"T":"t")+[t,e]})},function(){l=this.transform().local})}return e.on("snap.draginit."+c.id,u),c._drag={},y.push({el:c,start:u,init:h}),c.mousedown(h),c},o.undrag=function(){for(var n=y.length;n--;)y[n].el==this&&(this.unmousedown(y[n].init),y.splice(n,1),e.unbind("snap.drag.*."+this.id),e.unbind("snap.draginit."+this.id));return!y.length&&t.unmousemove(m).unmouseup(g),this}}),r.plugin(function(t,n,r,i){var o=(n.prototype,r.prototype),s=/^\s*url\((.+)\)/,a=String,u=t._.$;t.filter={},o.filter=function(e){var r=this;"svg"!=r.type&&(r=r.paper);var i=t.parse(a(e)),o=t._.id(),s=(r.node.offsetWidth,r.node.offsetHeight,u("filter"));return u(s,{id:o,filterUnits:"userSpaceOnUse"}),s.appendChild(i.node),r.defs.appendChild(s),new n(s)},e.on("snap.util.getattr.filter",function(){e.stop();var n=u(this.node,"filter");if(n){var r=a(n).match(s);return r&&t.select(r[1])}}),e.on("snap.util.attr.filter",function(r){if(r instanceof n&&"filter"==r.type){e.stop();var i=r.node.id;i||(u(r.node,{id:r.id}),i=r.id),u(this.node,{filter:t.url(i)})}r&&"none"!=r||(e.stop(),this.node.removeAttribute("filter"))}),t.filter.blur=function(e,n){null==e&&(e=2);var r=null==n?e:[e,n];return t.format('<feGaussianBlur stdDeviation="{def}"/>',{def:r})},t.filter.blur.toString=function(){return this()},t.filter.shadow=function(e,n,r,i,o){return"string"==typeof r&&(i=r,o=i,r=4),"string"!=typeof i&&(o=i,i="#000"),i=i||"#000",null==r&&(r=4),null==o&&(o=1),null==e&&(e=0,n=2),null==n&&(n=e),i=t.color(i),t.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:i,dx:e,dy:n,blur:r,opacity:o})},t.filter.shadow.toString=function(){return this()},t.filter.grayscale=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},t.filter.grayscale.toString=function(){return this()},t.filter.sepia=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},t.filter.sepia.toString=function(){return this()},t.filter.saturate=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})},t.filter.saturate.toString=function(){return this()},t.filter.hueRotate=function(e){return e=e||0,t.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})},t.filter.hueRotate.toString=function(){return this()},t.filter.invert=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})},t.filter.invert.toString=function(){return this()},t.filter.brightness=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})},t.filter.brightness.toString=function(){return this()},t.filter.contrast=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:e,amount2:.5-e/2})},t.filter.contrast.toString=function(){return this()}}),r.plugin(function(t,e,n,r,i){var o=t._.box,s=t.is,a=/^[^a-z]*([tbmlrc])/i,u=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(t,e){null==e&&s(t,"string")&&(e=t,t=null),t=t||this.paper;var n=t.getBBox?t.getBBox():o(t),r=this.getBBox(),i={};switch(e=e&&e.match(a),e=e?e[1].toLowerCase():"c"){case"t":i.dx=0,i.dy=n.y-r.y;break;case"b":i.dx=0,i.dy=n.y2-r.y2;break;case"m":i.dx=0,i.dy=n.cy-r.cy;break;case"l":i.dx=n.x-r.x,i.dy=0;break;case"r":i.dx=n.x2-r.x2,i.dy=0;break;default:i.dx=n.cx-r.cx,i.dy=0}return i.toString=u,i},e.prototype.align=function(t,e){return this.transform("..."+this.getAlign(t,e))}}),r})},{eve:23}],23:[function(e,n,r){!function(e){var r,i,o="0.4.2",s="hasOwnProperty",a=/[\.\/]/,u=/\s*,\s*/,h="*",c=function(t,e){return t-e},l={n:{}},p=function(){for(var t=0,e=this.length;t<e;t++)if("undefined"!=typeof this[t])return this[t]},f=function(){for(var t=this.length;--t;)if("undefined"!=typeof this[t])return this[t]},d=function(t,e){t=String(t);var n,o=i,s=Array.prototype.slice.call(arguments,2),a=d.listeners(t),u=0,h=[],l={},m=[],g=r;m.firstDefined=p,m.lastDefined=f,r=t,i=0;for(var v=0,y=a.length;v<y;v++)"zIndex"in a[v]&&(h.push(a[v].zIndex),a[v].zIndex<0&&(l[a[v].zIndex]=a[v]));for(h.sort(c);h[u]<0;)if(n=l[h[u++]],m.push(n.apply(e,s)),i)return i=o,m;for(v=0;v<y;v++)if(n=a[v],"zIndex"in n)if(n.zIndex==h[u]){if(m.push(n.apply(e,s)),i)break;do if(u++,n=l[h[u]],n&&m.push(n.apply(e,s)),i)break;while(n)}else l[n.zIndex]=n;else if(m.push(n.apply(e,s)),i)break;return i=o,r=g,m};d._events=l,d.listeners=function(t){var e,n,r,i,o,s,u,c,p=t.split(a),f=l,d=[f],m=[];for(i=0,o=p.length;i<o;i++){for(c=[],s=0,u=d.length;s<u;s++)for(f=d[s].n,n=[f[p[i]],f[h]],r=2;r--;)e=n[r],e&&(c.push(e),m=m.concat(e.f||[]));d=c}return m},d.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var n=t.split(u),r=0,i=n.length;r<i;r++)!function(t){for(var n,r=t.split(a),i=l,o=0,s=r.length;o<s;o++)i=i.n,i=i.hasOwnProperty(r[o])&&i[r[o]]||(i[r[o]]={n:{}});for(i.f=i.f||[],o=0,s=i.f.length;o<s;o++)if(i.f[o]==e){n=!0;break}!n&&i.f.push(e)}(n[r]);return function(t){+t==+t&&(e.zIndex=+t)}},d.f=function(t){var e=[].slice.call(arguments,1);return function(){d.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},d.stop=function(){i=1},d.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(r):r},d.nts=function(){return r.split(a)},d.off=d.unbind=function(t,e){if(!t)return void(d._events=l={n:{}});var n=t.split(u);if(n.length>1)for(var r=0,i=n.length;r<i;r++)d.off(n[r],e);else{n=t.split(a);var o,c,p,r,i,f,m,g=[l];for(r=0,i=n.length;r<i;r++)for(f=0;f<g.length;f+=p.length-2){if(p=[f,1],o=g[f].n,n[r]!=h)o[n[r]]&&p.push(o[n[r]]);else for(c in o)o[s](c)&&p.push(o[c]);g.splice.apply(g,p)}for(r=0,i=g.length;r<i;r++)for(o=g[r];o.n;){if(e){if(o.f){for(f=0,m=o.f.length;f<m;f++)if(o.f[f]==e){o.f.splice(f,1);break}!o.f.length&&delete o.f}for(c in o.n)if(o.n[s](c)&&o.n[c].f){var v=o.n[c].f;for(f=0,m=v.length;f<m;f++)if(v[f]==e){v.splice(f,1);break}!v.length&&delete o.n[c].f}}else{delete o.f;for(c in o.n)o.n[s](c)&&o.n[c].f&&delete o.n[c].f}o=o.n}}},d.once=function(t,e){var n=function(){return d.unbind(t,n),e.apply(this,arguments)};return d.on(t,n)},d.version=o,d.toString=function(){return"You are running Eve "+o},"undefined"!=typeof n&&n.exports?n.exports=d:"function"==typeof t&&t.amd?t("eve",[],function(){return d}):e.eve=d}(this)},{}],24:[function(t,e,n){var r;!function(t){function e(t,e,n,i,o){function s(t){function e(t){var e=Number.MAX_VALUE,n=Number.MAX_VALUE,r=0,o=0;t.array.forEach(function(t){var s="undefined"!=typeof t.width?t.width:i,a="undefined"!=typeof t.height?t.height:i;s/=2,a/=2,r=Math.max(t.x+s,r),e=Math.min(t.x-s,e),o=Math.max(t.y+a,o),n=Math.min(t.y-a,n)}),t.width=r-e,t.height=o-n}t.forEach(function(t){e(t)})}function a(t){t.forEach(function(t){var e={x:0,y:0};t.array.forEach(function(t){e.x+=t.x,e.y+=t.y}),e.x/=t.array.length,e.y/=t.array.length;var n={x:e.x-t.width/2,y:e.y-t.height/2},r={x:t.x-n.x+m/2-v/2,y:t.y-n.y+g/2-y/2};t.array.forEach(function(t){t.x+=r.x,t.y+=r.y})})}function u(t,e){var n=Number.POSITIVE_INFINITY,i=0;t.sort(function(t,e){return e.height-t.height}),_=t.reduce(function(t,e){return t.width<e.width?t.width:e.width});for(var o=m=_,s=g=l(t),a=0,u=Number.MAX_VALUE,c=Number.MAX_VALUE,p=-1,f=Number.MAX_VALUE,d=Number.MAX_VALUE;f>_||d>r.FLOAT_EPSILON;){if(1!=p)var m=s-(s-o)/r.GOLDEN_SECTION,u=h(t,m);if(0!=p)var g=o+(s-o)/r.GOLDEN_SECTION,c=h(t,g);if(f=Math.abs(m-g),d=Math.abs(u-c),u<n&&(n=u,i=m),c<n&&(n=c,i=g),u>c?(o=m,m=g,u=c,p=1):(s=g,g=m,c=u,p=0),a++>100)break}h(t,i)}function h(t,e){x=[],v=0,y=0,b=d;for(var n=0;n<t.length;n++){var r=t[n];c(r,e)}return Math.abs(p()-o)}function c(t,e){for(var n=void 0,i=0;i<x.length;i++)if(x[i].space_left>=t.height&&x[i].x+x[i].width+t.width+r.PADDING-e<=r.FLOAT_EPSILON){n=x[i];break}x.push(t),void 0!==n?(t.x=n.x+n.width+r.PADDING,t.y=n.bottom,t.space_left=t.height,t.bottom=t.y,n.space_left-=t.height+r.PADDING,n.bottom+=t.height+r.PADDING):(t.y=b,b+=t.height+r.PADDING,t.x=f,t.bottom=t.y,t.space_left=t.height),t.y+t.height-y>-r.FLOAT_EPSILON&&(y=t.y+t.height-d),t.x+t.width-v>-r.FLOAT_EPSILON&&(v=t.x+t.width-f)}function l(t){var e=0;return t.forEach(function(t){return e+=t.width+r.PADDING}),e}function p(){return v/y}void 0===o&&(o=1);var f=0,d=0,m=e,g=n,o="undefined"!=typeof o?o:1,i="undefined"!=typeof i?i:0,v=0,y=0,_=0,b=0,x=[];0!=t.length&&(s(t),u(t,o),a(t))}function n(t,e){function n(t,e){if(void 0===r[t.index]){e&&(s++,o.push({array:[]})),r[t.index]=s,o[s-1].array.push(t);var a=i[t.index];if(a)for(var u=0;u<a.length;u++)n(a[u],!1)}}for(var r={},i={},o=[],s=0,a=0;a<e.length;a++){var u=e[a],h=u.source,c=u.target;i[h.index]?i[h.index].push(c):i[h.index]=[c],i[c.index]?i[c.index].push(h):i[c.index]=[h]}for(var a=0;a<t.length;a++){var l=t[a];r[l.index]||n(l,!0)}return o}var r={PADDING:10,GOLDEN_SECTION:(1+Math.sqrt(5))/2,FLOAT_EPSILON:1e-4,MAX_INERATIONS:100};t.applyPacking=e,t.separateGraphs=n}(r||(r={}));var r;!function(t){var e;!function(t){var e=function(){function t(t){this.scale=t,this.AB=0,this.AD=0,this.A2=0}return t.prototype.addVariable=function(t){var e=this.scale/t.scale,n=t.offset/t.scale,r=t.weight;this.AB+=r*e*n,this.AD+=r*e*t.desiredPosition,this.A2+=r*e*e},t.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},t}();t.PositionStats=e;var n=function(){function t(t,e,n,r){void 0===r&&(r=!1),this.left=t,this.right=e,this.gap=n,this.equality=r,this.active=!1,this.unsatisfiable=!1,this.left=t,this.right=e,this.gap=n,this.equality=r}return t.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},t}();t.Constraint=n;var r=function(){function t(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1),this.desiredPosition=t,this.weight=e,this.scale=n,this.offset=0}return t.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},t.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},t.prototype.visitNeighbours=function(t,e){var n=function(n,r){return n.active&&t!==r&&e(n,r)};this.cOut.forEach(function(t){return n(t,t.right)}),this.cIn.forEach(function(t){return n(t,t.left)})},t}();t.Variable=r;var i=function(){function t(t){this.vars=[],t.offset=0,this.ps=new e(t.scale),this.addVariable(t)}return t.prototype.addVariable=function(t){t.block=this,this.vars.push(t),this.ps.addVariable(t),this.posn=this.ps.getPosn()},t.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var t=0,e=this.vars.length;t<e;++t)this.ps.addVariable(this.vars[t]);this.posn=this.ps.getPosn()},t.prototype.compute_lm=function(t,e,n){var r=this,i=t.dfdv();return t.visitNeighbours(e,function(e,o){var s=r.compute_lm(o,t,n);o===e.right?(i+=s*e.left.scale,e.lm=s):(i+=s*e.right.scale,e.lm=-s),n(e)}),i/t.scale},t.prototype.populateSplitBlock=function(t,e){var n=this;t.visitNeighbours(e,function(e,r){r.offset=t.offset+(r===e.right?e.gap:-e.gap),n.addVariable(r),n.populateSplitBlock(r,t)})},t.prototype.traverse=function(t,e,n,r){var i=this;void 0===n&&(n=this.vars[0]),void 0===r&&(r=null),n.visitNeighbours(r,function(r,o){e.push(t(r)),i.traverse(t,e,o,n)})},t.prototype.findMinLM=function(){var t=null;return this.compute_lm(this.vars[0],null,function(e){!e.equality&&(null===t||e.lm<t.lm)&&(t=e)}),t},t.prototype.findMinLMBetween=function(t,e){this.compute_lm(t,null,function(){});var n=null;return this.findPath(t,null,e,function(t,e){!t.equality&&t.right===e&&(null===n||t.lm<n.lm)&&(n=t)}),n},t.prototype.findPath=function(t,e,n,r){var i=this,o=!1;return t.visitNeighbours(e,function(e,s){o||s!==n&&!i.findPath(s,t,n,r)||(o=!0,r(e,s))}),o},t.prototype.isActiveDirectedPathBetween=function(t,e){if(t===e)return!0;for(var n=t.cOut.length;n--;){var r=t.cOut[n];if(r.active&&this.isActiveDirectedPathBetween(r.right,e))return!0}return!1},t.split=function(e){return e.active=!1,[t.createSplitBlock(e.left),t.createSplitBlock(e.right)]},t.createSplitBlock=function(e){var n=new t(e);return n.populateSplitBlock(e,null),n},t.prototype.splitBetween=function(e,n){var r=this.findMinLMBetween(e,n);if(null!==r){var i=t.split(r);return{constraint:r,lb:i[0],rb:i[1]}}return null},t.prototype.mergeAcross=function(t,e,n){e.active=!0;for(var r=0,i=t.vars.length;r<i;++r){var o=t.vars[r];o.offset+=n,this.addVariable(o)}this.posn=this.ps.getPosn()},t.prototype.cost=function(){for(var t=0,e=this.vars.length;e--;){var n=this.vars[e],r=n.position()-n.desiredPosition;t+=r*r*n.weight}return t},t}();t.Block=i;var o=function(){function t(t){this.vs=t;var e=t.length;for(this.list=new Array(e);e--;){var n=new i(t[e]);this.list[e]=n,n.blockInd=e}}return t.prototype.cost=function(){for(var t=0,e=this.list.length;e--;)t+=this.list[e].cost();return t},t.prototype.insert=function(t){t.blockInd=this.list.length,this.list.push(t)},t.prototype.remove=function(t){var e=this.list.length-1,n=this.list[e];this.list.length=e,t!==n&&(this.list[t.blockInd]=n,n.blockInd=t.blockInd)},t.prototype.merge=function(t){var e=t.left.block,n=t.right.block,r=t.right.offset-t.left.offset-t.gap;e.vars.length<n.vars.length?(n.mergeAcross(e,t,r),this.remove(e)):(e.mergeAcross(n,t,-r),this.remove(n))},t.prototype.forEach=function(t){this.list.forEach(t)},t.prototype.updateBlockPositions=function(){this.list.forEach(function(t){return t.updateWeightedPosition()})},t.prototype.split=function(t){var e=this;this.updateBlockPositions(),this.list.forEach(function(n){var r=n.findMinLM();null!==r&&r.lm<s.LAGRANGIAN_TOLERANCE&&(n=r.left.block,i.split(r).forEach(function(t){return e.insert(t)}),e.remove(n),t.push(r))})},t}();t.Blocks=o;var s=function(){function t(t,e){this.vs=t,this.cs=e,this.vs=t,t.forEach(function(t){t.cIn=[],t.cOut=[]}),this.cs=e,e.forEach(function(t){t.left.cOut.push(t),t.right.cIn.push(t)}),this.inactive=e.map(function(t){return t.active=!1,t}),this.bs=null}return t.prototype.cost=function(){return this.bs.cost()},t.prototype.setStartingPositions=function(t){this.inactive=this.cs.map(function(t){return t.active=!1,t}),this.bs=new o(this.vs),this.bs.forEach(function(e,n){return e.posn=t[n]})},t.prototype.setDesiredPositions=function(t){this.vs.forEach(function(e,n){return e.desiredPosition=t[n]})},t.prototype.mostViolated=function(){for(var e=Number.MAX_VALUE,n=null,r=this.inactive,i=r.length,o=i,s=0;s<i;++s){var a=r[s];if(!a.unsatisfiable){var u=a.slack();if((a.equality||u<e)&&(e=u,n=a,o=s,a.equality))break}}return o!==i&&(e<t.ZERO_UPPERBOUND&&!n.active||n.equality)&&(r[o]=r[i-1],r.length=i-1),n},t.prototype.satisfy=function(){null==this.bs&&(this.bs=new o(this.vs)),this.bs.split(this.inactive);for(var e=null;(e=this.mostViolated())&&(e.equality||e.slack()<t.ZERO_UPPERBOUND&&!e.active);){var n=e.left.block,r=e.right.block;if(n!==r)this.bs.merge(e);else{if(n.isActiveDirectedPathBetween(e.right,e.left)){e.unsatisfiable=!0;continue}var i=n.splitBetween(e.left,e.right);if(null===i){e.unsatisfiable=!0;continue}this.bs.insert(i.lb),this.bs.insert(i.rb),this.bs.remove(n),this.inactive.push(i.constraint),e.slack()>=0?this.inactive.push(e):this.bs.merge(e)}}},t.prototype.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,e=this.bs.cost();Math.abs(t-e)>1e-4;)this.satisfy(),t=e,e=this.bs.cost();return e},t.LAGRANGIAN_TOLERANCE=-1e-4,t.ZERO_UPPERBOUND=-1e-10,t}();t.Solver=s}(e=t.vpsc||(t.vpsc={}))}(r||(r={}));var r,i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n};!function(t){var e;!function(t){var e=function(){function t(){this.findIter=function(t){for(var e=this._root,n=this.iterator();null!==e;){var r=this._comparator(t,e.data);if(0===r)return n._cursor=e,n;n._ancestors.push(e),e=e.get_child(r>0)}return null}}return t.prototype.clear=function(){this._root=null,this.size=0},t.prototype.find=function(t){for(var e=this._root;null!==e;){var n=this._comparator(t,e.data);if(0===n)return e.data;e=e.get_child(n>0)}return null},t.prototype.lowerBound=function(t){return this._bound(t,this._comparator)},t.prototype.upperBound=function(t){function e(t,e){return n(e,t)}var n=this._comparator;return this._bound(t,e)},t.prototype.min=function(){var t=this._root;if(null===t)return null;for(;null!==t.left;)t=t.left;return t.data},t.prototype.max=function(){var t=this._root;if(null===t)return null;for(;null!==t.right;)t=t.right;return t.data},t.prototype.iterator=function(){return new n(this)},t.prototype.each=function(t){for(var e,n=this.iterator();null!==(e=n.next());)t(e)},t.prototype.reach=function(t){for(var e,n=this.iterator();null!==(e=n.prev());)t(e)},t.prototype._bound=function(t,e){for(var n=this._root,r=this.iterator();null!==n;){var i=this._comparator(t,n.data);if(0===i)return r._cursor=n,r;r._ancestors.push(n),n=n.get_child(i>0)}for(var o=r._ancestors.length-1;o>=0;--o)if(n=r._ancestors[o],e(t,n.data)>0)return r._cursor=n,r._ancestors.length=o,r;return r._ancestors.length=0,r},t}();t.TreeBase=e;var n=function(){function t(t){this._tree=t,this._ancestors=[],this._cursor=null}return t.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},t.prototype.next=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._minNode(t)}else if(null===this._cursor.right){var e;do{if(e=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===e)}else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return null!==this._cursor?this._cursor.data:null},t.prototype.prev=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._maxNode(t)}else if(null===this._cursor.left){var e;do{if(e=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===e)}else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return null!==this._cursor?this._cursor.data:null},t.prototype._minNode=function(t){for(;null!==t.left;)this._ancestors.push(t),t=t.left;this._cursor=t},t.prototype._maxNode=function(t){for(;null!==t.right;)this._ancestors.push(t),t=t.right;this._cursor=t},t}();t.Iterator=n;var r=function(){function t(t){this.data=t,this.left=null,this.right=null,this.red=!0}return t.prototype.get_child=function(t){return t?this.right:this.left},t.prototype.set_child=function(t,e){t?this.right=e:this.left=e},t}(),o=function(t){function e(e){t.call(this),this._root=null,this._comparator=e,this.size=0}return i(e,t),e.prototype.insert=function(t){var n=!1;if(null===this._root)this._root=new r(t),n=!0,this.size++;else{var i=new r((void 0)),o=!1,s=!1,a=null,u=i,h=null,c=this._root;for(u.right=this._root;;){if(null===c?(c=new r(t),h.set_child(o,c),n=!0,this.size++):e.is_red(c.left)&&e.is_red(c.right)&&(c.red=!0,c.left.red=!1,c.right.red=!1),e.is_red(c)&&e.is_red(h)){var l=u.right===a;c===h.get_child(s)?u.set_child(l,e.single_rotate(a,!s)):u.set_child(l,e.double_rotate(a,!s))}var p=this._comparator(c.data,t);if(0===p)break;s=o,o=p<0,null!==a&&(u=a),a=h,h=c,c=c.get_child(o)}this._root=i.right}return this._root.red=!1,n},e.prototype.remove=function(t){if(null===this._root)return!1;var n=new r((void 0)),i=n;i.right=this._root;for(var o=null,s=null,a=null,u=!0;null!==i.get_child(u);){var h=u;s=o,o=i,i=i.get_child(u);var c=this._comparator(t,i.data);if(u=c>0,0===c&&(a=i),!e.is_red(i)&&!e.is_red(i.get_child(u)))if(e.is_red(i.get_child(!u))){var l=e.single_rotate(i,u);o.set_child(h,l),o=l}else if(!e.is_red(i.get_child(!u))){var p=o.get_child(!h);if(null!==p)if(e.is_red(p.get_child(!h))||e.is_red(p.get_child(h))){var f=s.right===o;e.is_red(p.get_child(h))?s.set_child(f,e.double_rotate(o,h)):e.is_red(p.get_child(!h))&&s.set_child(f,e.single_rotate(o,h));var d=s.get_child(f);d.red=!0,i.red=!0,d.left.red=!1,d.right.red=!1}else o.red=!1,p.red=!0,i.red=!0}}return null!==a&&(a.data=i.data,o.set_child(o.right===i,i.get_child(null===i.left)),this.size--),this._root=n.right,null!==this._root&&(this._root.red=!1),null!==a},e.is_red=function(t){return null!==t&&t.red},e.single_rotate=function(t,e){var n=t.get_child(!e);return t.set_child(!e,n.get_child(e)),n.set_child(e,t),t.red=!0,n.red=!1,n},e.double_rotate=function(t,n){return t.set_child(!n,e.single_rotate(t.get_child(!n),!n)),e.single_rotate(t,n)},e}(e);t.RBTree=o}(e=t.vpsc||(t.vpsc={}))}(r||(r={}));var r;!function(t){var e;!function(t){function e(t){return t.bounds="undefined"!=typeof t.leaves?t.leaves.reduce(function(t,e){return e.bounds.union(t)},g.empty()):g.empty(),"undefined"!=typeof t.groups&&(t.bounds=t.groups.reduce(function(t,n){return e(n).union(t)},t.bounds)),t.bounds=t.bounds.inflate(t.padding),t.bounds}function n(t,e,n){var r=t.rayIntersection(e.cx(),e.cy())||{x:t.cx(),y:t.cy()},i=e.rayIntersection(t.cx(),t.cy())||{x:e.cx(),y:e.cy()},o=i.x-r.x,s=i.y-r.y,a=Math.sqrt(o*o+s*s),u=a-n;return{sourceIntersection:r,targetIntersection:i,arrowStart:{x:r.x+u*o/a,y:r.y+u*s/a}}}function r(t,e,n){var r=e.rayIntersection(t.x,t.y);r||(r={x:e.cx(),y:e.cy()});var i=r.x-t.x,o=r.y-t.y,s=Math.sqrt(i*i+o*o);return{x:r.x-n*i/s,y:r.y-n*o/s}}function o(t,e){return t.pos>e.pos?1:t.pos<e.pos?-1:t.isOpen?-1:e.isOpen?1:0}function s(){return new t.RBTree(function(t,e){return t.pos-e.pos})}function a(t,e,n,r){void 0===r&&(r=!1);var i=t.padding,o="undefined"!=typeof t.groups?t.groups.length:0,s="undefined"!=typeof t.leaves?t.leaves.length:0,h=o?t.groups.reduce(function(t,r){return t.concat(a(r,e,n,!0))},[]):[],c=(r?2:0)+s+o,l=new Array(c),p=new Array(c),f=0,d=function(t,e){p[f]=t,l[f++]=e};if(r){var m=t.bounds,g=e.getCentre(m),v=e.getSize(m)/2,y=e.getOpen(m),_=e.getClose(m),b=g-v+i/2,x=g+v-i/2;t.minVar.desiredPosition=b,d(e.makeRect(y,_,b,i),t.minVar),t.maxVar.desiredPosition=x,d(e.makeRect(y,_,x,i),t.maxVar)}s&&t.leaves.forEach(function(t){return d(t.bounds,t.variable)}),o&&t.groups.forEach(function(t){var n=t.bounds;d(e.makeRect(e.getOpen(n),e.getClose(n),e.getCentre(n),e.getSize(n)),t.minVar)});var w=u(p,l,e,n);return o&&(l.forEach(function(t){t.cOut=[],t.cIn=[]}),w.forEach(function(t){t.left.cOut.push(t),t.right.cIn.push(t)}),t.groups.forEach(function(t){var n=(t.padding-e.getSize(t.bounds))/2;t.minVar.cIn.forEach(function(t){return t.gap+=n}),t.minVar.cOut.forEach(function(e){e.left=t.maxVar,e.gap+=n})})),h.concat(w)}function u(e,n,r,i){var a,u=e.length,h=2*u;console.assert(n.length>=u);var c=new Array(h);for(a=0;a<u;++a){var l=e[a],p=new v(n[a],l,r.getCentre(l));c[a]=new y((!0),p,r.getOpen(l)),c[a+u]=new y((!1),p,r.getClose(l))}c.sort(o);var f=new Array,d=s();for(a=0;a<h;++a){var m=c[a],p=m.v;if(m.isOpen)d.insert(p),r.findNeighbours(p,d);else{d.remove(p);var g=function(e,n){var o=(r.getSize(e.r)+r.getSize(n.r))/2+i;f.push(new t.Constraint(e.v,n.v,o))},_=function(t,e,n){for(var r,i=p[t].iterator();null!==(r=i[t]());)n(r,p),r[e].remove(p)};_("prev","next",function(t,e){return g(t,e)}),_("next","prev",function(t,e){return g(e,t)})}}return console.assert(0===d.size),f}function h(t,e){var n=function(n,r){for(var i,o=e.findIter(t);null!==(i=o[n]());){var s=i.r.overlapX(t.r);if((s<=0||s<=i.r.overlapY(t.r))&&(t[n].insert(i),i[r].insert(t)),s<=0)break}};n("next","prev"),n("prev","next")}function c(t,e){var n=function(n,r){var i=e.findIter(t)[n]();null!==i&&i.r.overlapX(t.r)>0&&(t[n].insert(i),i[r].insert(t))};n("next","prev"),n("prev","next")}function l(t,e){return u(t,e,_,1e-6)}function p(t,e){return u(t,e,b,1e-6)}function f(t){return a(t,_,1e-6)}function d(t){return a(t,b,1e-6)}function m(e){var n=e.map(function(e){return new t.Variable(e.cx())}),r=t.generateXConstraints(e,n),i=new t.Solver(n,r);i.solve(),n.forEach(function(t,n){return e[n].setXCentre(t.position())}),n=e.map(function(e){return new t.Variable(e.cy())}),r=t.generateYConstraints(e,n),i=new t.Solver(n,r),i.solve(),n.forEach(function(t,n){return e[n].setYCentre(t.position())})}t.computeGroupBounds=e;var g=function(){function t(t,e,n,r){this.x=t,this.X=e,this.y=n,this.Y=r}return t.empty=function(){return new t(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},t.prototype.cx=function(){return(this.x+this.X)/2},t.prototype.cy=function(){return(this.y+this.Y)/2},t.prototype.overlapX=function(t){var e=this.cx(),n=t.cx();return e<=n&&t.x<this.X?this.X-t.x:n<=e&&this.x<t.X?t.X-this.x:0},t.prototype.overlapY=function(t){var e=this.cy(),n=t.cy();return e<=n&&t.y<this.Y?this.Y-t.y:n<=e&&this.y<t.Y?t.Y-this.y:0},t.prototype.setXCentre=function(t){var e=t-this.cx();this.x+=e,this.X+=e},t.prototype.setYCentre=function(t){var e=t-this.cy();this.y+=e,this.Y+=e},t.prototype.width=function(){return this.X-this.x},t.prototype.height=function(){return this.Y-this.y},t.prototype.union=function(e){return new t(Math.min(this.x,e.x),Math.max(this.X,e.X),Math.min(this.y,e.y),Math.max(this.Y,e.Y))},t.prototype.lineIntersections=function(e,n,r,i){for(var o=[[this.x,this.y,this.X,this.y],[this.X,this.y,this.X,this.Y],[this.X,this.Y,this.x,this.Y],[this.x,this.Y,this.x,this.y]],s=[],a=0;a<4;++a){var u=t.lineIntersection(e,n,r,i,o[a][0],o[a][1],o[a][2],o[a][3]);null!==u&&s.push({x:u.x,y:u.y})}return s},t.prototype.rayIntersection=function(t,e){var n=this.lineIntersections(this.cx(),this.cy(),t,e);return n.length>0?n[0]:null},t.prototype.vertices=function(){return[{x:this.x,y:this.y},{x:this.X,y:this.y},{x:this.X,y:this.Y},{x:this.x,y:this.Y},{x:this.x,y:this.y}]},t.lineIntersection=function(t,e,n,r,i,o,s,a){var u=n-t,h=s-i,c=r-e,l=a-o,p=l*u-h*c;if(0==p)return null;var f=t-i,d=e-o,m=h*d-l*f,g=m/p,v=u*d-c*f,y=v/p;return g>=0&&g<=1&&y>=0&&y<=1?{x:t+g*u,y:e+g*c}:null},t.prototype.inflate=function(e){return new t(this.x-e,this.X+e,this.y-e,this.Y+e)},t}();t.Rectangle=g,t.makeEdgeBetween=n,t.makeEdgeTo=r;var v=function(){function t(t,e,n){this.v=t,this.r=e,this.pos=n,this.prev=s(),this.next=s()}return t}(),y=function(){function t(t,e,n){this.isOpen=t,this.v=e,this.pos=n}return t}(),_={getCentre:function(t){return t.cx()},getOpen:function(t){return t.y},getClose:function(t){return t.Y},getSize:function(t){return t.width()},makeRect:function(t,e,n,r){return new g(n-r/2,n+r/2,t,e)},findNeighbours:h},b={getCentre:function(t){return t.cy()},getOpen:function(t){return t.x},getClose:function(t){return t.X},getSize:function(t){return t.height()},makeRect:function(t,e,n,r){return new g(t,e,n-r/2,n+r/2)},findNeighbours:c};t.generateXConstraints=l,t.generateYConstraints=p,t.generateXGroupConstraints=f,t.generateYGroupConstraints=d,t.removeOverlaps=m;var x=function(t){function e(e,n){t.call(this,0,n),this.index=e}return i(e,t),e}(t.Variable);t.IndexedVariable=x;var w=function(){function n(n,r,i,o,s){var a=this;if(void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=!1),this.nodes=n,this.groups=r,this.rootGroup=i,this.avoidOverlaps=s,this.variables=n.map(function(t,e){return t.variable=new x(e,1)}),o&&this.createConstraints(o),s&&i&&"undefined"!=typeof i.groups){n.forEach(function(e){if(!e.width||!e.height)return void(e.bounds=new t.Rectangle(e.x,e.x,e.y,e.y));var n=e.width/2,r=e.height/2;e.bounds=new t.Rectangle(e.x-n,e.x+n,e.y-r,e.y+r)}),e(i);var u=n.length;r.forEach(function(t){a.variables[u]=t.minVar=new x((u++),"undefined"!=typeof t.stiffness?t.stiffness:.01),a.variables[u]=t.maxVar=new x((u++),"undefined"!=typeof t.stiffness?t.stiffness:.01)})}}return n.prototype.createSeparation=function(e){return new t.Constraint(this.nodes[e.left].variable,this.nodes[e.right].variable,e.gap,"undefined"!=typeof e.equality&&e.equality)},n.prototype.makeFeasible=function(t){var e=this;if(this.avoidOverlaps){var n="x",r="width";"x"===t.axis&&(n="y",r="height");var i=t.offsets.map(function(t){return e.nodes[t.node]}).sort(function(t,e){return t[n]-e[n]}),o=null;i.forEach(function(t){o&&(t[n]=o[n]+o[r]+1),o=t})}},n.prototype.createAlignment=function(e){var n=this,r=this.nodes[e.offsets[0].node].variable;this.makeFeasible(e);var i="x"===e.axis?this.xConstraints:this.yConstraints;e.offsets.slice(1).forEach(function(e){var o=n.nodes[e.node].variable;i.push(new t.Constraint(r,o,e.offset,(!0)))})},n.prototype.createConstraints=function(t){var e=this,n=function(t){return"undefined"==typeof t.type||"separation"===t.type};this.xConstraints=t.filter(function(t){return"x"===t.axis&&n(t)}).map(function(t){return e.createSeparation(t)}),this.yConstraints=t.filter(function(t){return"y"===t.axis&&n(t)}).map(function(t){return e.createSeparation(t)}),t.filter(function(t){return"alignment"===t.type}).forEach(function(t){return e.createAlignment(t)})},n.prototype.setupVariablesAndBounds=function(t,e,n,r){this.nodes.forEach(function(i,o){i.fixed?(i.variable.weight=i.fixedWeight?i.fixedWeight:1e3,n[o]=r(i)):i.variable.weight=1;var s=(i.width||0)/2,a=(i.height||0)/2,u=t[o],h=e[o];i.bounds=new g(u-s,u+s,h-a,h+a)})},n.prototype.xProject=function(t,e,n){(this.rootGroup||this.avoidOverlaps||this.xConstraints)&&this.project(t,e,t,n,function(t){return t.px},this.xConstraints,f,function(t){return t.bounds.setXCentre(n[t.variable.index]=t.variable.position())},function(t){var e=n[t.minVar.index]=t.minVar.position(),r=n[t.maxVar.index]=t.maxVar.position(),i=t.padding/2;t.bounds.x=e-i,t.bounds.X=r+i})},n.prototype.yProject=function(t,e,n){(this.rootGroup||this.yConstraints)&&this.project(t,e,e,n,function(t){return t.py},this.yConstraints,d,function(t){return t.bounds.setYCentre(n[t.variable.index]=t.variable.position())},function(t){var e=n[t.minVar.index]=t.minVar.position(),r=n[t.maxVar.index]=t.maxVar.position(),i=t.padding/2;t.bounds.y=e-i,t.bounds.Y=r+i})},n.prototype.projectFunctions=function(){var t=this;return[function(e,n,r){return t.xProject(e,n,r)},function(e,n,r){return t.yProject(e,n,r)}]},n.prototype.project=function(t,n,r,i,o,s,a,u,h){this.setupVariablesAndBounds(t,n,i,o),this.rootGroup&&this.avoidOverlaps&&(e(this.rootGroup),
s=s.concat(a(this.rootGroup))),this.solve(this.variables,s,r,i),this.nodes.forEach(u),this.rootGroup&&this.avoidOverlaps&&this.groups.forEach(h)},n.prototype.solve=function(e,n,r,i){var o=new t.Solver(e,n);o.setStartingPositions(r),o.setDesiredPositions(i),o.solve()},n}();t.Projection=w}(e=t.vpsc||(t.vpsc={}))}(r||(r={}));var r;!function(t){var e;!function(e){function n(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function r(t,e,r){return n(t,e,r)>0}function o(t,e,r){return n(t,e,r)<0}function s(t){var e,r=t.slice(0).sort(function(t,e){return t.x!==e.x?e.x-t.x:e.y-t.y}),i=t.length,o=0,s=r[0].x;for(e=1;e<i&&r[e].x===s;++e);var a=e-1,u=[];if(u.push(r[o]),a===i-1)r[a].y!==r[o].y&&u.push(r[a]);else{var h,c=i-1,l=r[i-1].x;for(e=i-2;e>=0&&r[e].x===l;e--);for(h=e+1,e=a;++e<=h;)if(!(n(r[o],r[h],r[e])>=0&&e<h)){for(;u.length>1&&!(n(u[u.length-2],u[u.length-1],r[e])>0);)u.length-=1;e!=o&&u.push(r[e])}c!=h&&u.push(r[c]);var p=u.length;for(e=h;--e>=a;)if(!(n(r[c],r[a],r[e])>=0&&e>a)){for(;u.length>p&&!(n(u[u.length-2],u[u.length-1],r[e])>0);)u.length-=1;e!=o&&u.push(r[e])}}return u}function a(t,e,n){e.slice(0).sort(function(e,n){return Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(n.y-t.y,n.x-t.x)}).forEach(n)}function u(t,e){return{rtan:h(t,e),ltan:c(t,e)}}function h(t,e){var n,i,s,a,u,h=e.length-1;if(o(t,e[1],e[0])&&!r(t,e[h-1],e[0]))return 0;for(n=0,i=h;;){if(i-n===1)return r(t,e[n],e[i])?n:i;if(s=Math.floor((n+i)/2),u=o(t,e[s+1],e[s]),u&&!r(t,e[s-1],e[s]))return s;a=r(t,e[n+1],e[n]),a?u?i=s:r(t,e[n],e[s])?i=s:n=s:u&&o(t,e[n],e[s])?i=s:n=s}}function c(t,e){var n,i,s,a,u,h=e.length-1;if(r(t,e[h-1],e[0])&&!o(t,e[1],e[0]))return 0;for(n=0,i=h;;){if(i-n===1)return o(t,e[n],e[i])?n:i;if(s=Math.floor((n+i)/2),u=o(t,e[s+1],e[s]),r(t,e[s-1],e[s])&&!u)return s;a=o(t,e[n+1],e[n]),a?u?o(t,e[n],e[s])?i=s:n=s:i=s:u?n=s:r(t,e[n],e[s])?i=s:n=s}}function l(t,e,n,r,i,o){var s,a;s=n(e[0],t),a=r(t[s],e);for(var u=!1;!u;){for(u=!0;;){if(s===t.length-1&&(s=0),i(e[a],t[s],t[s+1]))break;++s}for(;;){if(0===a&&(a=e.length-1),o(t[s],e[a],e[a-1]))break;--a,u=!1}}return{t1:s,t2:a}}function p(t,e){var n=f(e,t);return{t1:n.t2,t2:n.t1}}function f(t,e){return l(t,e,h,c,r,o)}function d(t,e){return l(t,e,c,c,o,o)}function m(t,e){return l(t,e,h,h,r,r)}function g(e,n){for(var r=[],i=1,o=n.length;i<o;++i){var s=t.vpsc.Rectangle.lineIntersection(e.x1,e.y1,e.x2,e.y2,n[i-1].x,n[i-1].y,n[i].x,n[i].y);s&&r.push(s)}return r}function v(t,e){for(var r=t.length-1,i=e.length-1,o=new P,s=0;s<r;++s)for(var a=0;a<i;++a){var u=t[0==s?r-1:s-1],h=t[s],c=t[s+1],l=e[0==a?i-1:a-1],p=e[a],f=e[a+1],d=n(u,h,p),m=n(h,l,p),g=n(h,p,f),v=n(l,p,h),y=n(p,u,h),_=n(p,h,c);d>=0&&m>=0&&g<0&&v>=0&&y>=0&&_<0?o.ll=new k(s,a):d<=0&&m<=0&&g>0&&v<=0&&y<=0&&_>0?o.rr=new k(s,a):d<=0&&m>0&&g<=0&&v>=0&&y<0&&_>=0?o.rl=new k(s,a):d>=0&&m<0&&g>=0&&v<=0&&y>0&&_<=0&&(o.lr=new k(s,a))}return o}function y(t,e){for(var n=1,r=e.length;n<r;++n)if(o(e[n-1],e[n],t))return!1;return!0}function _(t,e){return!t.every(function(t){return!y(t,e)})}function b(t,e){if(_(t,e))return!0;if(_(e,t))return!0;for(var n=1,r=t.length;n<r;++n){var i=t[n],o=t[n-1];if(g(new w(o.x,o.y,i.x,i.y),e).length>0)return!0}return!1}var x=function(){function t(){}return t}();e.Point=x;var w=function(){function t(t,e,n,r){this.x1=t,this.y1=e,this.x2=n,this.y2=r}return t}();e.LineSegment=w;var C=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(x);e.PolyPoint=C,e.isLeft=n,e.ConvexHull=s,e.clockwiseRadialSweep=a,e.tangent_PolyPolyC=l,e.LRtangent_PolyPolyC=p,e.RLtangent_PolyPolyC=f,e.LLtangent_PolyPolyC=d,e.RRtangent_PolyPolyC=m;var k=function(){function t(t,e){this.t1=t,this.t2=e}return t}();e.BiTangent=k;var P=function(){function t(){}return t}();e.BiTangents=P;var S=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(x);e.TVGPoint=S;var j=function(){function t(t,e,n,r){this.id=t,this.polyid=e,this.polyvertid=n,this.p=r,r.vv=this}return t}();e.VisibilityVertex=j;var O=function(){function t(t,e){this.source=t,this.target=e}return t.prototype.length=function(){var t=this.source.p.x-this.target.p.x,e=this.source.p.y-this.target.p.y;return Math.sqrt(t*t+e*e)},t}();e.VisibilityEdge=O;var E=function(){function t(t,n){if(this.P=t,this.V=[],this.E=[],n)this.V=n.V.slice(0),this.E=n.E.slice(0);else{for(var r=t.length,i=0;i<r;i++)for(var o=t[i],s=0;s<o.length;++s){var a=o[s],u=new j(this.V.length,i,s,a);this.V.push(u),s>0&&this.E.push(new O(o[s-1].vv,u))}for(var i=0;i<r-1;i++)for(var h=t[i],s=i+1;s<r;s++){var c=t[s],l=e.tangents(h,c);for(var p in l){var f=l[p],d=h[f.t1],m=c[f.t2];this.addEdgeIfVisible(d,m,i,s)}}}}return t.prototype.addEdgeIfVisible=function(t,e,n,r){this.intersectsPolys(new w(t.x,t.y,e.x,e.y),n,r)||this.E.push(new O(t.vv,e.vv))},t.prototype.addPoint=function(t,e){var n=this.P.length;this.V.push(new j(this.V.length,n,0,t));for(var r=0;r<n;++r)if(r!==e){var i=this.P[r],o=u(t,i);this.addEdgeIfVisible(t,i[o.ltan],e,r),this.addEdgeIfVisible(t,i[o.rtan],e,r)}return t.vv},t.prototype.intersectsPolys=function(t,e,n){for(var r=0,i=this.P.length;r<i;++r)if(r!=e&&r!=n&&g(t,this.P[r]).length>0)return!0;return!1},t}();e.TangentVisibilityGraph=E,e.tangents=v,e.polysOverlap=b}(e=t.geom||(t.geom={}))}(r||(r={}));var r;!function(t){var e=function(){function t(){this.locks={}}return t.prototype.add=function(t,e){this.locks[t]=e},t.prototype.clear=function(){this.locks={}},t.prototype.isEmpty=function(){for(var t in this.locks)return!1;return!0},t.prototype.apply=function(t){for(var e in this.locks)t(e,this.locks[e])},t}();t.Locks=e;var n=function(){function t(t,n,i){void 0===i&&(i=null),this.D=n,this.G=i,this.threshold=1e-4,this.numGridSnapNodes=0,this.snapGridSize=100,this.snapStrength=1e3,this.scaleSnapByMaxH=!1,this.random=new r,this.project=null,this.x=t,this.k=t.length;var o=this.n=t[0].length;this.H=new Array(this.k),this.g=new Array(this.k),this.Hd=new Array(this.k),this.a=new Array(this.k),this.b=new Array(this.k),this.c=new Array(this.k),this.d=new Array(this.k),this.e=new Array(this.k),this.ia=new Array(this.k),this.ib=new Array(this.k),this.xtmp=new Array(this.k),this.locks=new e,this.minD=Number.MAX_VALUE;for(var s,a=o;a--;)for(s=o;--s>a;){var u=n[a][s];u>0&&u<this.minD&&(this.minD=u)}for(this.minD===Number.MAX_VALUE&&(this.minD=1),a=this.k;a--;){for(this.g[a]=new Array(o),this.H[a]=new Array(o),s=o;s--;)this.H[a][s]=new Array(o);this.Hd[a]=new Array(o),this.a[a]=new Array(o),this.b[a]=new Array(o),this.c[a]=new Array(o),this.d[a]=new Array(o),this.e[a]=new Array(o),this.ia[a]=new Array(o),this.ib[a]=new Array(o),this.xtmp[a]=new Array(o)}}return t.createSquareMatrix=function(t,e){for(var n=new Array(t),r=0;r<t;++r){n[r]=new Array(t);for(var i=0;i<t;++i)n[r][i]=e(r,i)}return n},t.prototype.offsetDir=function(){for(var t=this,e=new Array(this.k),n=0,r=0;r<this.k;++r){var i=e[r]=this.random.getNextBetween(.01,1)-.5;n+=i*i}return n=Math.sqrt(n),e.map(function(e){return e*=t.minD/n})},t.prototype.computeDerivatives=function(t){var e=this,n=this.n;if(!(n<1)){for(var r,i=new Array(this.k),o=new Array(this.k),s=new Array(this.k),a=0,u=0;u<n;++u){for(r=0;r<this.k;++r)s[r]=this.g[r][u]=0;for(var h=0;h<n;++h)if(u!==h){for(var c=n;c--;){var l=0;for(r=0;r<this.k;++r){var p=i[r]=t[r][u]-t[r][h];l+=o[r]=p*p}if(l>1e-9)break;var f=this.offsetDir();for(r=0;r<this.k;++r)t[r][h]+=f[r]}var d=Math.sqrt(l),m=this.D[u][h],g=null!=this.G?this.G[u][h]:1;if(g>1&&d>m||!isFinite(m))for(r=0;r<this.k;++r)this.H[r][u][h]=0;else{g>1&&(g=1);var v=m*m,y=2*g*(d-m)/(v*d),_=d*d*d,b=2*-g/(v*_);for(isFinite(y)||console.log(y),r=0;r<this.k;++r)this.g[r][u]+=i[r]*y,s[r]-=this.H[r][u][h]=b*(_+m*(o[r]-l)+d*l)}}for(r=0;r<this.k;++r)a=Math.max(a,this.H[r][u][u]=s[r])}for(var x=this.snapGridSize/2,w=this.snapGridSize,C=this.snapStrength,k=C/(x*x),P=this.numGridSnapNodes,u=0;u<P;++u)for(r=0;r<this.k;++r){var S=this.x[r][u],j=S/w,O=j%1,E=j-O,A=Math.abs(O),p=A<=.5?S-E*w:S>0?S-(E+1)*w:S-(E-1)*w;-x<p&&p<=x&&(this.scaleSnapByMaxH?(this.g[r][u]+=a*k*p,this.H[r][u][u]+=a*k):(this.g[r][u]+=k*p,this.H[r][u][u]+=k))}this.locks.isEmpty()||this.locks.apply(function(n,i){for(r=0;r<e.k;++r)e.H[r][n][n]+=a,e.g[r][n]-=a*(i[r]-t[r][n])})}},t.dotProd=function(t,e){for(var n=0,r=t.length;r--;)n+=t[r]*e[r];return n},t.rightMultiply=function(e,n,r){for(var i=e.length;i--;)r[i]=t.dotProd(e[i],n)},t.prototype.computeStepSize=function(e){for(var n=0,r=0,i=0;i<this.k;++i)n+=t.dotProd(this.g[i],e[i]),t.rightMultiply(this.H[i],e[i],this.Hd[i]),r+=t.dotProd(e[i],this.Hd[i]);return 0!==r&&isFinite(r)?1*n/r:0},t.prototype.reduceStress=function(){this.computeDerivatives(this.x);for(var t=this.computeStepSize(this.g),e=0;e<this.k;++e)this.takeDescentStep(this.x[e],this.g[e],t);return this.computeStress()},t.copy=function(t,e){for(var n=t.length,r=e[0].length,i=0;i<n;++i)for(var o=0;o<r;++o)e[i][o]=t[i][o]},t.prototype.stepAndProject=function(e,n,r,i){t.copy(e,n),this.takeDescentStep(n[0],r[0],i),this.project&&this.project[0](e[0],e[1],n[0]),this.takeDescentStep(n[1],r[1],i),this.project&&this.project[1](n[0],e[1],n[1]);for(var o=2;o<this.k;o++)this.takeDescentStep(n[o],r[o],i)},t.mApply=function(t,e,n){for(var r=t;r-- >0;)for(var i=e;i-- >0;)n(r,i)},t.prototype.matrixApply=function(e){t.mApply(this.k,this.n,e)},t.prototype.computeNextPosition=function(t,e){var n=this;this.computeDerivatives(t);var r=this.computeStepSize(this.g);if(this.stepAndProject(t,e,this.g,r),this.project){this.matrixApply(function(r,i){return n.e[r][i]=t[r][i]-e[r][i]});var i=this.computeStepSize(this.e);i=Math.max(.2,Math.min(i,1)),this.stepAndProject(t,e,this.e,i)}},t.prototype.run=function(t){for(var e=Number.MAX_VALUE,n=!1;!n&&t-- >0;){var r=this.rungeKutta();n=Math.abs(e/r-1)<this.threshold,e=r}return e},t.prototype.rungeKutta=function(){var e=this;this.computeNextPosition(this.x,this.a),t.mid(this.x,this.a,this.ia),this.computeNextPosition(this.ia,this.b),t.mid(this.x,this.b,this.ib),this.computeNextPosition(this.ib,this.c),this.computeNextPosition(this.c,this.d);var n=0;return this.matrixApply(function(t,r){var i=(e.a[t][r]+2*e.b[t][r]+2*e.c[t][r]+e.d[t][r])/6,o=e.x[t][r]-i;n+=o*o,e.x[t][r]=i}),n},t.mid=function(e,n,r){t.mApply(e.length,e[0].length,function(t,i){return r[t][i]=e[t][i]+(n[t][i]-e[t][i])/2})},t.prototype.takeDescentStep=function(t,e,n){for(var r=0;r<this.n;++r)t[r]=t[r]-n*e[r]},t.prototype.computeStress=function(){for(var t=0,e=0,n=this.n-1;e<n;++e)for(var r=e+1,i=this.n;r<i;++r){for(var o=0,s=0;s<this.k;++s){var a=this.x[s][e]-this.x[s][r];o+=a*a}o=Math.sqrt(o);var u=this.D[e][r];if(isFinite(u)){var h=u-o,c=u*u;t+=h*h/c}}return t},t.zeroDistance=1e-10,t}();t.Descent=n;var r=function(){function t(t){void 0===t&&(t=1),this.seed=t,this.a=214013,this.c=2531011,this.m=2147483648,this.range=32767}return t.prototype.getNext=function(){return this.seed=(this.seed*this.a+this.c)%this.m,(this.seed>>16)/this.range},t.prototype.getNextBetween=function(t,e){return t+this.getNext()*(e-t)},t}();t.PseudoRandom=r}(r||(r={}));var r;!function(t){var e;!function(t){function e(t,n,r){t.forAll(function(t){if(t.isLeaf())n.leaves||(n.leaves=[]),n.leaves.push(t.id);else{var i=n;if(t.gid=r.length,!t.isIsland()||t.isPredefined()){if(i={id:t.gid},t.isPredefined())for(var o in t.definition)i[o]=t.definition[o];n.groups||(n.groups=[]),n.groups.push(t.gid),r.push(i)}e(t.children,i,r)}})}function n(t,e){var n={};for(var r in t)r in e&&(n[r]=t[r]);return n}function r(e,n,r,i){for(var o=e.length,s=new t.Configuration(o,n,r,i);s.greedyMerge(););var a=[],u=s.getGroupHierarchy(a);return a.forEach(function(t){var n=function(n){var r=t[n];"number"==typeof r&&(t[n]=e[r])};n("source"),n("target")}),{groups:u,powerEdges:a}}var i=function(){function t(t,e,n){this.source=t,this.target=e,this.type=n}return t}();t.PowerEdge=i;var o=function(){function t(t,e,n,r){var i=this;if(this.linkAccessor=n,this.modules=new Array(t),this.roots=[],r)this.initModulesFromGroup(r);else{this.roots.push(new a);for(var o=0;o<t;++o)this.roots[0].add(this.modules[o]=new s(o))}this.R=e.length,e.forEach(function(t){var e=i.modules[n.getSourceIndex(t)],r=i.modules[n.getTargetIndex(t)],o=n.getType(t);e.outgoing.add(o,r),r.incoming.add(o,e)})}return t.prototype.initModulesFromGroup=function(t){var e=new a;this.roots.push(e);for(var n=0;n<t.leaves.length;++n){var r=t.leaves[n],i=new s(r.id);this.modules[r.id]=i,e.add(i)}if(t.groups)for(var o=0;o<t.groups.length;++o){var h=t.groups[o],c={};for(var l in h)"leaves"!==l&&"groups"!==l&&h.hasOwnProperty(l)&&(c[l]=h[l]);e.add(new s(-1-o,new u,new u,this.initModulesFromGroup(h),c))}return e},t.prototype.merge=function(t,e,n){void 0===n&&(n=0);var r=t.incoming.intersection(e.incoming),i=t.outgoing.intersection(e.outgoing),o=new a;o.add(t),o.add(e);var u=new s(this.modules.length,i,r,o);this.modules.push(u);var h=function(n,r,i){n.forAll(function(n,o){n.forAll(function(n){var s=n[r];s.add(o,u),s.remove(o,t),s.remove(o,e),t[i].remove(o,n),e[i].remove(o,n)})})};return h(i,"incoming","outgoing"),h(r,"outgoing","incoming"),this.R-=r.count()+i.count(),this.roots[n].remove(t),this.roots[n].remove(e),this.roots[n].add(u),u},t.prototype.rootMerges=function(t){void 0===t&&(t=0);for(var e=this.roots[t].modules(),n=e.length,r=new Array(n*(n-1)),i=0,o=0,s=n-1;o<s;++o)for(var a=o+1;a<n;++a){var u=e[o],h=e[a];r[i]={id:i,nEdges:this.nEdges(u,h),a:u,b:h},i++}return r},t.prototype.greedyMerge=function(){for(var t=0;t<this.roots.length;++t)if(!(this.roots[t].modules().length<2)){var e=this.rootMerges(t).sort(function(t,e){return t.nEdges==e.nEdges?t.id-e.id:t.nEdges-e.nEdges}),n=e[0];if(!(n.nEdges>=this.R))return this.merge(n.a,n.b,t),!0}},t.prototype.nEdges=function(t,e){var n=t.incoming.intersection(e.incoming),r=t.outgoing.intersection(e.outgoing);return this.R-n.count()-r.count()},t.prototype.getGroupHierarchy=function(t){var n=this,r=[],o={};e(this.roots[0],o,r);var s=this.allEdges();return s.forEach(function(e){var o=n.modules[e.source],s=n.modules[e.target];t.push(new i("undefined"==typeof o.gid?e.source:r[o.gid],"undefined"==typeof s.gid?e.target:r[s.gid],e.type))}),r},t.prototype.allEdges=function(){var e=[];return t.getEdges(this.roots[0],e),e},t.getEdges=function(e,n){e.forAll(function(e){e.getEdges(n),t.getEdges(e.children,n)})},t}();t.Configuration=o;var s=function(){function t(t,e,n,r,i){void 0===e&&(e=new u),void 0===n&&(n=new u),void 0===r&&(r=new a),this.id=t,this.outgoing=e,this.incoming=n,this.children=r,this.definition=i}return t.prototype.getEdges=function(t){var e=this;this.outgoing.forAll(function(n,r){n.forAll(function(n){t.push(new i(e.id,n.id,r))})})},t.prototype.isLeaf=function(){return 0===this.children.count()},t.prototype.isIsland=function(){return 0===this.outgoing.count()&&0===this.incoming.count()},t.prototype.isPredefined=function(){return"undefined"!=typeof this.definition},t}();t.Module=s;var a=function(){function t(){this.table={}}return t.prototype.count=function(){return Object.keys(this.table).length},t.prototype.intersection=function(e){var r=new t;return r.table=n(this.table,e.table),r},t.prototype.intersectionCount=function(t){return this.intersection(t).count()},t.prototype.contains=function(t){return t in this.table},t.prototype.add=function(t){this.table[t.id]=t},t.prototype.remove=function(t){delete this.table[t.id]},t.prototype.forAll=function(t){for(var e in this.table)t(this.table[e])},t.prototype.modules=function(){var t=[];return this.forAll(function(e){e.isPredefined()||t.push(e)}),t},t}();t.ModuleSet=a;var u=function(){function t(){this.sets={},this.n=0}return t.prototype.count=function(){return this.n},t.prototype.contains=function(t){var e=!1;return this.forAllModules(function(n){e||n.id!=t||(e=!0)}),e},t.prototype.add=function(t,e){var n=t in this.sets?this.sets[t]:this.sets[t]=new a;n.add(e),++this.n},t.prototype.remove=function(t,e){var n=this.sets[t];n.remove(e),0===n.count()&&delete this.sets[t],--this.n},t.prototype.forAll=function(t){for(var e in this.sets)t(this.sets[e],e)},t.prototype.forAllModules=function(t){this.forAll(function(e,n){return e.forAll(t)})},t.prototype.intersection=function(e){var n=new t;return this.forAll(function(t,r){if(r in e.sets){var i=t.intersection(e.sets[r]),o=i.count();o>0&&(n.sets[r]=i,n.n+=o)}}),n},t}();t.LinkSets=u,t.getGroups=r}(e=t.powergraph||(t.powergraph={}))}(r||(r={}));var r;!function(t){function e(t,e){var n={};for(var r in t)n[r]={};for(var r in e)n[r]={};return Object.keys(n).length}function n(t,e){var n=0;for(var r in t)"undefined"!=typeof e[r]&&++n;return n}function r(t,e){var n={},r=function(t,e){"undefined"==typeof n[t]&&(n[t]={}),n[t][e]={}};return t.forEach(function(t){var n=e.getSourceIndex(t),i=e.getTargetIndex(t);r(n,i),r(i,n)}),n}function i(t,e,n,i){var o=r(t,i);t.forEach(function(t){var r=o[i.getSourceIndex(t)],s=o[i.getTargetIndex(t)];i.setLength(t,1+e*n(r,s))})}function o(t,r,o){void 0===o&&(o=1),i(t,o,function(t,r){return Math.sqrt(e(t,r)-n(t,r))},r)}function s(t,r,o){void 0===o&&(o=1),i(t,o,function(t,r){return Math.min(Object.keys(t).length,Object.keys(r).length)<1.1?0:n(t,r)/e(t,r)},r)}function a(t,e,n,r){var i=u(t,e,r),o={};i.forEach(function(t,e){return t.forEach(function(t){return o[t]=e})});var s=[];return e.forEach(function(t){var e=r.getSourceIndex(t),i=r.getTargetIndex(t),a=o[e],u=o[i];a!==u&&s.push({axis:n,left:e,right:i,gap:r.getMinSeparation(t)})}),s}function u(t,e,n){function r(t){t.index=t.lowlink=o++,s.push(t),t.onStack=!0;for(var e=0,n=t.out;e<n.length;e++){var i=n[e];"undefined"==typeof i.index?(r(i),t.lowlink=Math.min(t.lowlink,i.lowlink)):i.onStack&&(t.lowlink=Math.min(t.lowlink,i.index))}if(t.lowlink===t.index){for(var u=[];s.length&&(i=s.pop(),i.onStack=!1,u.push(i),i!==t););a.push(u.map(function(t){return t.id}))}}for(var i=[],o=0,s=[],a=[],u=0;u<t;u++)i.push({id:u,out:[]});for(var h=0;h<e.length;h++){var c=e[h],l=i[n.getSourceIndex(c)],p=i[n.getTargetIndex(c)];l.out.push(p)}for(var f=0;f<i.length;f++){var d=i[f];"undefined"==typeof d.index&&r(d)}return a}t.symmetricDiffLinkLengths=o,t.jaccardLinkLengths=s,t.generateDirectedEdgeConstraints=a,t.stronglyConnectedComponents=u}(r||(r={}));var r,o=function(){function t(t){this.elem=t,this.subheaps=[]}return t.prototype.toString=function(t){for(var e="",n=!1,r=0;r<this.subheaps.length;++r){var i=this.subheaps[r];i.elem?(n&&(e+=","),e+=i.toString(t),n=!0):n=!1}return""!==e&&(e="("+e+")"),(this.elem?t(this.elem):"")+e},t.prototype.forEach=function(t){this.empty()||(t(this.elem,this),this.subheaps.forEach(function(e){return e.forEach(t)}))},t.prototype.count=function(){return this.empty()?0:1+this.subheaps.reduce(function(t,e){return t+e.count()},0)},t.prototype.min=function(){return this.elem},t.prototype.empty=function(){return null==this.elem},t.prototype.contains=function(t){if(this===t)return!0;for(var e=0;e<this.subheaps.length;e++)if(this.subheaps[e].contains(t))return!0;return!1},t.prototype.isHeap=function(t){var e=this;return this.subheaps.every(function(n){return t(e.elem,n.elem)&&n.isHeap(t)})},t.prototype.insert=function(e,n){return this.merge(new t(e),n)},t.prototype.merge=function(t,e){return this.empty()?t:t.empty()?this:e(this.elem,t.elem)?(this.subheaps.push(t),this):(t.subheaps.push(this),t)},t.prototype.removeMin=function(t){return this.empty()?null:this.mergePairs(t)},t.prototype.mergePairs=function(e){if(0==this.subheaps.length)return new t(null);if(1==this.subheaps.length)return this.subheaps[0];var n=this.subheaps.pop().merge(this.subheaps.pop(),e),r=this.mergePairs(e);return n.merge(r,e)},t.prototype.decreaseKey=function(e,n,r,i){var o=e.removeMin(i);e.elem=o.elem,e.subheaps=o.subheaps,null!==r&&null!==o.elem&&r(e.elem,e);var s=new t(n);return null!==r&&r(n,s),this.merge(s,i)},t}(),s=function(){function t(t){this.lessThan=t}return t.prototype.top=function(){return this.empty()?null:this.root.elem},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n,r,i=0;r=t[i];++i)n=new o(r),this.root=this.empty()?n:this.root.merge(n,this.lessThan);return n},t.prototype.empty=function(){return!this.root||!this.root.elem},t.prototype.isHeap=function(){return this.root.isHeap(this.lessThan)},t.prototype.forEach=function(t){this.root.forEach(t)},t.prototype.pop=function(){if(this.empty())return null;var t=this.root.min();return this.root=this.root.removeMin(this.lessThan),t},t.prototype.reduceKey=function(t,e,n){void 0===n&&(n=null),this.root=this.root.decreaseKey(t,e,n,this.lessThan)},t.prototype.toString=function(t){return this.root.toString(t)},t.prototype.count=function(){return this.root.count()},t}();!function(t){var e;!function(t){var e=function(){function t(t,e){this.id=t,this.distance=e}return t}(),n=function(){function t(t){this.id=t,this.neighbours=[]}return t}(),r=function(){function t(t,e,n){this.node=t,this.prev=e,this.d=n}return t}(),i=function(){function t(t,r,i,o,s){this.n=t,this.es=r,this.neighbours=new Array(this.n);for(var a=this.n;a--;)this.neighbours[a]=new n(a);for(a=this.es.length;a--;){var u=this.es[a],h=i(u),c=o(u),l=s(u);this.neighbours[h].neighbours.push(new e(c,l)),this.neighbours[c].neighbours.push(new e(h,l))}}return t.prototype.DistanceMatrix=function(){for(var t=new Array(this.n),e=0;e<this.n;++e)t[e]=this.dijkstraNeighbours(e);return t},t.prototype.DistancesFromNode=function(t){return this.dijkstraNeighbours(t)},t.prototype.PathFromNodeToNode=function(t,e){return this.dijkstraNeighbours(t,e)},t.prototype.PathFromNodeToNodeWithPrevCost=function(t,e,n){var i=new s(function(t,e){return t.d<=e.d}),o=this.neighbours[t],a=new r(o,null,0),u={};for(i.push(a);!i.empty()&&(a=i.pop(),o=a.node,o.id!==e);)for(var h=o.neighbours.length;h--;){var c=o.neighbours[h],l=this.neighbours[c.id];if(!a.prev||l.id!==a.prev.node.id){var p=l.id+","+o.id;if(!(p in u&&u[p]<=a.d)){var f=a.prev?n(a.prev.node.id,o.id,l.id):0,d=a.d+c.distance+f;u[p]=d,i.push(new r(l,a,d))}}}for(var m=[];a.prev;)a=a.prev,m.push(a.node.id);return m},t.prototype.dijkstraNeighbours=function(t,e){void 0===e&&(e=-1);for(var n=new s(function(t,e){return t.d<=e.d}),r=this.neighbours.length,i=new Array(r);r--;){var o=this.neighbours[r];o.d=r===t?0:Number.POSITIVE_INFINITY,o.q=n.push(o)}for(;!n.empty();){var a=n.pop();if(i[a.id]=a.d,a.id===e){for(var u=[],h=a;"undefined"!=typeof h.prev;)u.push(h.prev.id),h=h.prev;return u}for(r=a.neighbours.length;r--;){var c=a.neighbours[r],h=this.neighbours[c.id],l=a.d+c.distance;a.d!==Number.MAX_VALUE&&h.d>l&&(h.d=l,h.prev=a,n.reduceKey(h.q,h,function(t,e){return t.q=e}))}}return i},t}();t.Calculator=i}(e=t.shortestpaths||(t.shortestpaths={}))}(r||(r={}));var r;!function(t){!function(t){t[t.start=0]="start",t[t.tick=1]="tick",t[t.end=2]="end"}(t.EventType||(t.EventType={}));var e=t.EventType,n=function(){function n(){var t=this;this._canvasSize=[1,1],this._linkDistance=20,this._defaultNodeSize=10,this._linkLengthCalculator=null,this._linkType=null,this._avoidOverlaps=!1,this._handleDisconnected=!0,this._running=!1,this._nodes=[],this._groups=[],this._rootGroup=null,this._links=[],this._constraints=[],this._distanceMatrix=null,this._descent=null,this._directedLinkConstraints=null,this._threshold=.01,this._visibilityGraph=null,this._groupCompactness=1e-6,this.event=null,this.linkAccessor={getSourceIndex:n.getSourceIndex,getTargetIndex:n.getTargetIndex,setLength:n.setLinkLength,getType:function(e){return"function"==typeof t._linkType?t._linkType(e):0}}}return n.prototype.on=function(t,n){return this.event||(this.event={}),"string"==typeof t?this.event[e[t]]=n:this.event[t]=n,this},n.prototype.trigger=function(t){this.event&&"undefined"!=typeof this.event[t.type]&&this.event[t.type](t)},n.prototype.kick=function(){for(;!this.tick(););},n.prototype.tick=function(){if(this._alpha<this._threshold)return this._running=!1,this.trigger({type:e.end,alpha:this._alpha=0,stress:this._lastStress}),!0;var t,n,r=this._nodes.length;this._links.length;for(this._descent.locks.clear(),n=0;n<r;++n)if(t=this._nodes[n],t.fixed){"undefined"!=typeof t.px&&"undefined"!=typeof t.py||(t.px=t.x,t.py=t.y);var i=[t.px,t.py];this._descent.locks.add(n,i)}var o=this._descent.rungeKutta();return 0===o?this._alpha=0:"undefined"!=typeof this._lastStress&&(this._alpha=o),this._lastStress=o,this.updateNodePositions(),this.trigger({type:e.tick,alpha:this._alpha,stress:this._lastStress}),!1},n.prototype.updateNodePositions=function(){for(var t,e=this._descent.x[0],n=this._descent.x[1],r=this._nodes.length;r--;)t=this._nodes[r],t.x=e[r],t.y=n[r]},n.prototype.nodes=function(t){if(!t){if(0===this._nodes.length&&this._links.length>0){var e=0;this._links.forEach(function(t){e=Math.max(e,t.source,t.target)}),this._nodes=new Array((++e));for(var n=0;n<e;++n)this._nodes[n]={}}return this._nodes}return this._nodes=t,this},n.prototype.groups=function(t){var e=this;return t?(this._groups=t,this._rootGroup={},this._groups.forEach(function(t){"undefined"==typeof t.padding&&(t.padding=1),"undefined"!=typeof t.leaves&&t.leaves.forEach(function(n,r){(t.leaves[r]=e._nodes[n]).parent=t}),"undefined"!=typeof t.groups&&t.groups.forEach(function(n,r){(t.groups[r]=e._groups[n]).parent=t})}),this._rootGroup.leaves=this._nodes.filter(function(t){return"undefined"==typeof t.parent}),this._rootGroup.groups=this._groups.filter(function(t){return"undefined"==typeof t.parent}),this):this._groups},n.prototype.powerGraphGroups=function(e){var n=t.powergraph.getGroups(this._nodes,this._links,this.linkAccessor,this._rootGroup);return this.groups(n.groups),e(n),this},n.prototype.avoidOverlaps=function(t){return arguments.length?(this._avoidOverlaps=t,this):this._avoidOverlaps},n.prototype.handleDisconnected=function(t){return arguments.length?(this._handleDisconnected=t,this):this._handleDisconnected},n.prototype.flowLayout=function(t,e){return arguments.length||(t="y"),this._directedLinkConstraints={axis:t,getMinSeparation:"number"==typeof e?function(){return e}:e},this},n.prototype.links=function(t){return arguments.length?(this._links=t,this):this._links},n.prototype.constraints=function(t){return arguments.length?(this._constraints=t,this):this._constraints},n.prototype.distanceMatrix=function(t){return arguments.length?(this._distanceMatrix=t,this):this._distanceMatrix},n.prototype.size=function(t){return t?(this._canvasSize=t,this):this._canvasSize},n.prototype.defaultNodeSize=function(t){return t?(this._defaultNodeSize=t,this):this._defaultNodeSize},n.prototype.groupCompactness=function(t){return t?(this._groupCompactness=t,this):this._groupCompactness},n.prototype.linkDistance=function(t){return t?(this._linkDistance="function"==typeof t?t:+t,this._linkLengthCalculator=null,this):this._linkDistance},n.prototype.linkType=function(t){return this._linkType=t,this},n.prototype.convergenceThreshold=function(t){return t?(this._threshold="function"==typeof t?t:+t,this):this._threshold},n.prototype.alpha=function(t){return arguments.length?(t=+t,this._alpha?t>0?this._alpha=t:this._alpha=0:t>0&&(this._running||(this._running=!0,this.trigger({type:e.start,alpha:this._alpha=t}),this.kick())),this):this._alpha},n.prototype.getLinkLength=function(t){return"function"==typeof this._linkDistance?+this._linkDistance(t):this._linkDistance},n.setLinkLength=function(t,e){t.length=e},n.prototype.getLinkType=function(t){return"function"==typeof this._linkType?this._linkType(t):0},n.prototype.symmetricDiffLinkLengths=function(e,n){var r=this;return void 0===n&&(n=1),this.linkDistance(function(t){return e*t.length}),this._linkLengthCalculator=function(){return t.symmetricDiffLinkLengths(r._links,r.linkAccessor,n)},this},n.prototype.jaccardLinkLengths=function(e,n){var r=this;return void 0===n&&(n=1),this.linkDistance(function(t){return e*t.length}),this._linkLengthCalculator=function(){return t.jaccardLinkLengths(r._links,r.linkAccessor,n)},this},n.prototype.start=function(e,r,i,o,s){var a=this;void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=!0);var u,h=this.nodes().length,c=h+2*this._groups.length,l=(this._links.length,this._canvasSize[0]),p=this._canvasSize[1];this._linkLengthCalculator&&this._linkLengthCalculator();var f=new Array(c),d=new Array(c),m=null,g=this._avoidOverlaps;this._nodes.forEach(function(t,e){t.index=e,"undefined"==typeof t.x&&(t.x=l/2,t.y=p/2),f[e]=t.x,d[e]=t.y});var v;this._distanceMatrix?v=this._distanceMatrix:(v=new t.shortestpaths.Calculator(c,this._links,n.getSourceIndex,n.getTargetIndex,function(t){return a.getLinkLength(t)}).DistanceMatrix(),m=t.Descent.createSquareMatrix(c,function(){return 2}),this._links.forEach(function(t){"number"==typeof t.source&&(t.source=a._nodes[t.source]),"number"==typeof t.target&&(t.target=a._nodes[t.target])}),this._links.forEach(function(t){var e=n.getSourceIndex(t),r=n.getTargetIndex(t);m[e][r]=m[r][e]=t.weight||1}));var y=t.Descent.createSquareMatrix(c,function(t,e){return v[t][e]});if(this._rootGroup&&"undefined"!=typeof this._rootGroup.groups){var u=h,_=function(t,e,n,r){m[t][e]=m[e][t]=n,y[t][e]=y[e][t]=r};this._groups.forEach(function(t){_(u,u+1,a._groupCompactness,.1),f[u]=0,d[u++]=0,f[u]=0,d[u++]=0})}else this._rootGroup={leaves:this._nodes,groups:[]};var b=this._constraints||[];this._directedLinkConstraints&&(this.linkAccessor.getMinSeparation=this._directedLinkConstraints.getMinSeparation,b=b.concat(t.generateDirectedEdgeConstraints(h,this._links,this._directedLinkConstraints.axis,this.linkAccessor))),this.avoidOverlaps(!1),this._descent=new t.Descent([f,d],y),this._descent.locks.clear();for(var u=0;u<h;++u){var x=this._nodes[u];if(x.fixed){x.px=x.x,x.py=x.y;var w=[x.x,x.y];this._descent.locks.add(u,w)}}if(this._descent.threshold=this._threshold,this._descent.run(e),b.length>0&&(this._descent.project=new t.vpsc.Projection(this._nodes,this._groups,this._rootGroup,b).projectFunctions()),this._descent.run(r),this.separateOverlappingComponents(l,p),this.avoidOverlaps(g),g&&(this._nodes.forEach(function(t,e){t.x=f[e],t.y=d[e]}),this._descent.project=new t.vpsc.Projection(this._nodes,this._groups,this._rootGroup,b,(!0)).projectFunctions(),this._nodes.forEach(function(t,e){f[e]=t.x,d[e]=t.y})),this._descent.G=m,this._descent.run(i),o){this._descent.snapStrength=1e3,this._descent.snapGridSize=this._nodes[0].width,this._descent.numGridSnapNodes=h,this._descent.scaleSnapByMaxH=h!=c;var C=t.Descent.createSquareMatrix(c,function(t,e){return t>=h||e>=h?m[t][e]:0});this._descent.G=C,this._descent.run(o)}return this.updateNodePositions(),this.separateOverlappingComponents(l,p),s?this.resume():this},n.prototype.separateOverlappingComponents=function(e,n){var r=this;if(!this._distanceMatrix&&this._handleDisconnected){var i=this._descent.x[0],o=this._descent.x[1];this._nodes.forEach(function(t,e){t.x=i[e],t.y=o[e]});var s=t.separateGraphs(this._nodes,this._links);t.applyPacking(s,e,n,this._defaultNodeSize),this._nodes.forEach(function(t,e){r._descent.x[0][e]=t.x,r._descent.x[1][e]=t.y,t.bounds&&(t.bounds.setXCentre(t.x),t.bounds.setYCentre(t.y))})}},n.prototype.resume=function(){return this.alpha(.1)},n.prototype.stop=function(){return this.alpha(0)},n.prototype.prepareEdgeRouting=function(e){void 0===e&&(e=0),this._visibilityGraph=new t.geom.TangentVisibilityGraph(this._nodes.map(function(t){return t.bounds.inflate(-e).vertices()}))},n.prototype.routeEdge=function(e,n){var r=[],i=new t.geom.TangentVisibilityGraph(this._visibilityGraph.P,{V:this._visibilityGraph.V,E:this._visibilityGraph.E}),o={x:e.source.x,y:e.source.y},s={x:e.target.x,y:e.target.y},a=i.addPoint(o,e.source.index),u=i.addPoint(s,e.target.index);i.addEdgeIfVisible(o,s,e.source.index,e.target.index),"undefined"!=typeof n&&n(i);var h=function(t){return t.source.id},c=function(t){return t.target.id},l=function(t){return t.length()},p=new t.shortestpaths.Calculator(i.V.length,i.E,h,c,l),f=p.PathFromNodeToNode(a.id,u.id);if(1===f.length||f.length===i.V.length){var d=t.vpsc.makeEdgeBetween(e.source.innerBounds,e.target.innerBounds,5);r=[d.sourceIntersection,d.arrowStart]}else{for(var m=f.length-2,g=i.V[f[m]].p,v=i.V[f[0]].p,r=[e.source.innerBounds.rayIntersection(g.x,g.y)],y=m;y>=0;--y)r.push(i.V[f[y]].p);r.push(t.vpsc.makeEdgeTo(v,e.target.innerBounds,5));
}return r},n.getSourceIndex=function(t){return"number"==typeof t.source?t.source:t.source.index},n.getTargetIndex=function(t){return"number"==typeof t.target?t.target:t.target.index},n.linkId=function(t){return n.getSourceIndex(t)+"-"+n.getTargetIndex(t)},n.dragStart=function(t){t.fixed|=2,t.px=t.x,t.py=t.y},n.dragEnd=function(t){t.fixed&=-7},n.mouseOver=function(t){t.fixed|=4,t.px=t.x,t.py=t.y},n.mouseOut=function(t){t.fixed&=-5},n}();t.Layout=n}(r||(r={}));var r;!function(t){function e(){return new n}var n=function(e){function n(){e.call(this),this.event=d3.dispatch(t.EventType[t.EventType.start],t.EventType[t.EventType.tick],t.EventType[t.EventType.end]);var n=this;this.drag=function(){if(!e)var e=d3.behavior.drag().origin(function(t){return t}).on("dragstart.d3adaptor",t.Layout.dragStart).on("drag.d3adaptor",function(t){t.px=d3.event.x,t.py=d3.event.y,n.resume()}).on("dragend.d3adaptor",t.Layout.dragEnd);return arguments.length?void this.call(e):e}}return i(n,e),n.prototype.trigger=function(e){var n={type:t.EventType[e.type],alpha:e.alpha,stress:e.stress};this.event[n.type](n)},n.prototype.kick=function(){var t=this;d3.timer(function(){return e.prototype.tick.call(t)})},n.prototype.on=function(e,n){return"string"==typeof e?this.event.on(e,n):this.event.on(t.EventType[e],n),this},n}(t.Layout);t.D3StyleLayoutAdaptor=n,t.d3adaptor=e}(r||(r={}));var r;!function(t){var e=function(){function t(t,e,n){this.id=t,this.rect=e,this.children=n,this.leaf="undefined"==typeof n||0===n.length}return t}();t.NodeWrapper=e;var n=function(){function t(t,e,n,r,i){void 0===r&&(r=null),void 0===i&&(i=null),this.id=t,this.x=e,this.y=n,this.node=r,this.line=i}return t}();t.Vert=n;var r=function(){function t(e,n){this.s=e,this.t=n;var r=t.findMatch(e,n),i=n.slice(0).reverse(),o=t.findMatch(e,i);r.length>=o.length?(this.length=r.length,this.si=r.si,this.ti=r.ti,this.reversed=!1):(this.length=o.length,this.si=o.si,this.ti=n.length-o.ti-o.length,this.reversed=!0)}return t.findMatch=function(t,e){for(var n=t.length,r=e.length,i={length:0,si:-1,ti:-1},o=new Array(n),s=0;s<n;s++){o[s]=new Array(r);for(var a=0;a<r;a++)if(t[s]===e[a]){var u=o[s][a]=0===s||0===a?1:o[s-1][a-1]+1;u>i.length&&(i.length=u,i.si=s-u+1,i.ti=a-u+1)}else o[s][a]=0}return i},t.prototype.getSequence=function(){return this.length>=0?this.s.slice(this.si,this.si+this.length):[]},t}();t.LongestCommonSubsequence=r;var i=function(){function r(r,i,o){var s=this;void 0===o&&(o=12),this.originalnodes=r,this.groupPadding=o,this.leaves=null,this.nodes=r.map(function(t,n){return new e(n,i.getBounds(t),i.getChildren(t))}),this.leaves=this.nodes.filter(function(t){return t.leaf}),this.groups=this.nodes.filter(function(t){return!t.leaf}),this.cols=this.getGridLines("x"),this.rows=this.getGridLines("y"),this.groups.forEach(function(t){return t.children.forEach(function(e){return s.nodes[e].parent=t})}),this.root={children:[]},this.nodes.forEach(function(t){"undefined"==typeof t.parent&&(t.parent=s.root,s.root.children.push(t.id)),t.ports=[]}),this.backToFront=this.nodes.slice(0),this.backToFront.sort(function(t,e){return s.getDepth(t)-s.getDepth(e)});var a=this.backToFront.slice(0).reverse().filter(function(t){return!t.leaf});a.forEach(function(e){var n=t.vpsc.Rectangle.empty();e.children.forEach(function(t){return n=n.union(s.nodes[t].rect)}),e.rect=n.inflate(s.groupPadding)});var u=this.midPoints(this.cols.map(function(t){return t.pos})),h=this.midPoints(this.rows.map(function(t){return t.pos})),c=u[0],l=u[u.length-1],p=h[0],f=h[h.length-1],d=this.rows.map(function(t){return{x1:c,x2:l,y1:t.pos,y2:t.pos}}).concat(h.map(function(t){return{x1:c,x2:l,y1:t,y2:t}})),m=this.cols.map(function(t){return{x1:t.pos,x2:t.pos,y1:p,y2:f}}).concat(u.map(function(t){return{x1:t,x2:t,y1:p,y2:f}})),g=d.concat(m);g.forEach(function(t){return t.verts=[]}),this.verts=[],this.edges=[],d.forEach(function(t){return m.forEach(function(e){var r=new n(s.verts.length,e.x1,t.y1);t.verts.push(r),e.verts.push(r),s.verts.push(r);for(var i=s.backToFront.length;i-- >0;){var o=s.backToFront[i],a=o.rect,u=Math.abs(r.x-a.cx()),h=Math.abs(r.y-a.cy());if(u<a.width()/2&&h<a.height()/2){r.node=o;break}}})}),g.forEach(function(t,e){s.nodes.forEach(function(e,r){e.rect.lineIntersections(t.x1,t.y1,t.x2,t.y2).forEach(function(r,i){var o=new n(s.verts.length,r.x,r.y,e,t);s.verts.push(o),t.verts.push(o),e.ports.push(o)})});var r=Math.abs(t.y1-t.y2)<.1,i=function(t,e){return r?e.x-t.x:e.y-t.y};t.verts.sort(i);for(var o=1;o<t.verts.length;o++){var a=t.verts[o-1],u=t.verts[o];a.node&&a.node===u.node&&a.node.leaf||s.edges.push({source:a.id,target:u.id,length:Math.abs(i(a,u))})}})}return r.prototype.avg=function(t){return t.reduce(function(t,e){return t+e})/t.length},r.prototype.getGridLines=function(t){for(var e=[],n=this.leaves.slice(0,this.leaves.length);n.length>0;){var r=n.filter(function(e){return e.rect["overlap"+t.toUpperCase()](n[0].rect)}),i={nodes:r,pos:this.avg(r.map(function(e){return e.rect["c"+t]()}))};e.push(i),i.nodes.forEach(function(t){return n.splice(n.indexOf(t),1)})}return e.sort(function(t,e){return t.pos-e.pos}),e},r.prototype.getDepth=function(t){for(var e=0;t.parent!==this.root;)e++,t=t.parent;return e},r.prototype.midPoints=function(t){for(var e=t[1]-t[0],n=[t[0]-e/2],r=1;r<t.length;r++)n.push((t[r]+t[r-1])/2);return n.push(t[t.length-1]+e/2),n},r.prototype.findLineage=function(t){var e=[t];do t=t.parent,e.push(t);while(t!==this.root);return e.reverse()},r.prototype.findAncestorPathBetween=function(t,e){for(var n=this.findLineage(t),r=this.findLineage(e),i=0;n[i]===r[i];)i++;return{commonAncestor:n[i-1],lineages:n.slice(i).concat(r.slice(i))}},r.prototype.siblingObstacles=function(t,e){var n=this,r=this.findAncestorPathBetween(t,e),i={};r.lineages.forEach(function(t){return i[t.id]={}});var o=r.commonAncestor.children.filter(function(t){return!(t in i)});return r.lineages.filter(function(t){return t.parent!==r.commonAncestor}).forEach(function(t){return o=o.concat(t.parent.children.filter(function(e){return e!==t.id}))}),o.map(function(t){return n.nodes[t]})},r.getSegmentSets=function(t,e,n){for(var r=[],i=0;i<t.length;i++)for(var o=t[i],s=0;s<o.length;s++){var a=o[s];a.edgeid=i,a.i=s;var u=a[1][e]-a[0][e];Math.abs(u)<.1&&r.push(a)}r.sort(function(t,n){return t[0][e]-n[0][e]});for(var h=[],c=null,l=0;l<r.length;l++){var a=r[l];(!c||Math.abs(a[0][e]-c.pos)>.1)&&(c={pos:a[0][e],segments:[]},h.push(c)),c.segments.push(a)}return h},r.nudgeSegs=function(e,n,r,i,o,s){var a=i.length;if(!(a<=1)){for(var u=i.map(function(n){return new t.vpsc.Variable(n[0][e])}),h=[],c=0;c<a;c++)for(var l=0;l<a;l++)if(c!==l){var p=i[c],f=i[l],d=p.edgeid,m=f.edgeid,g=-1,v=-1;"x"==e?o(d,m)&&(p[0][n]<p[1][n]?(g=l,v=c):(g=c,v=l)):o(d,m)&&(p[0][n]<p[1][n]?(g=c,v=l):(g=l,v=c)),g>=0&&h.push(new t.vpsc.Constraint(u[g],u[v],s))}var y=new t.vpsc.Solver(u,h);y.solve(),u.forEach(function(t,n){var o=i[n],s=t.position();o[0][e]=o[1][e]=s;var a=r[o.edgeid];o.i>0&&(a[o.i-1][1][e]=s),o.i<a.length-1&&(a[o.i+1][0][e]=s)})}},r.nudgeSegments=function(t,e,n,i,o){for(var s=r.getSegmentSets(t,e,n),a=0;a<s.length;a++){for(var u=s[a],h=[],c=0;c<u.segments.length;c++){var l=u.segments[c];h.push({type:0,s:l,pos:Math.min(l[0][n],l[1][n])}),h.push({type:1,s:l,pos:Math.max(l[0][n],l[1][n])})}h.sort(function(t,e){return t.pos-e.pos+t.type-e.type});var p=[],f=0;h.forEach(function(s){0===s.type?(p.push(s.s),f++):f--,0==f&&(r.nudgeSegs(e,n,t,p,i,o),p=[])})}},r.prototype.routeEdges=function(e,n,r,i){var o=this,s=e.map(function(t){return o.route(r(t),i(t))}),a=t.GridRouter.orderEdges(s),u=s.map(function(e){return t.GridRouter.makeSegments(e)});return t.GridRouter.nudgeSegments(u,"x","y",a,n),t.GridRouter.nudgeSegments(u,"y","x",a,n),t.GridRouter.unreverseEdges(u,s),u},r.unreverseEdges=function(t,e){t.forEach(function(t,n){var r=e[n];r.reversed&&(t.reverse(),t.forEach(function(t){t.reverse()}))})},r.angleBetween2Lines=function(t,e){var n=Math.atan2(t[0].y-t[1].y,t[0].x-t[1].x),r=Math.atan2(e[0].y-e[1].y,e[0].x-e[1].x),i=n-r;return(i>Math.PI||i<-Math.PI)&&(i=r-n),i},r.isLeft=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)<=0},r.getOrder=function(t){for(var e={},n=0;n<t.length;n++){var r=t[n];"undefined"==typeof e[r.l]&&(e[r.l]={}),e[r.l][r.r]=!0}return function(t,n){return"undefined"!=typeof e[t]&&e[t][n]}},r.orderEdges=function(e){for(var n=[],i=0;i<e.length-1;i++)for(var o=i+1;o<e.length;o++){var s,a,u,h=e[i],c=e[o],l=new t.LongestCommonSubsequence(h,c);0!==l.length&&(l.reversed&&(c.reverse(),c.reversed=!0,l=new t.LongestCommonSubsequence(h,c)),(l.si<=0||l.ti<=0)&&(l.si+l.length>=h.length||l.ti+l.length>=c.length)?n.push({l:i,r:o}):(l.si+l.length>=h.length||l.ti+l.length>=c.length?(s=h[l.si+1],u=h[l.si-1],a=c[l.ti-1]):(s=h[l.si+l.length-2],a=h[l.si+l.length],u=c[l.ti+l.length]),r.isLeft(s,a,u)?n.push({l:o,r:i}):n.push({l:i,r:o})))}return t.GridRouter.getOrder(n)},r.makeSegments=function(t){function e(t){return{x:t.x,y:t.y}}for(var n=function(t,e,n){return Math.abs((e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x))<.001},r=[],i=e(t[0]),o=1;o<t.length;o++){var s=e(t[o]),a=o<t.length-1?t[o+1]:null;a&&n(i,s,a)||(r.push([i,s]),i=s)}return r},r.prototype.route=function(e,n){var r=this,i=this.nodes[e],o=this.nodes[n];this.obstacles=this.siblingObstacles(i,o);var s={};this.obstacles.forEach(function(t){return s[t.id]=t}),this.passableEdges=this.edges.filter(function(t){var e=r.verts[t.source],n=r.verts[t.target];return!(e.node&&e.node.id in s||n.node&&n.node.id in s)});for(var a=1;a<i.ports.length;a++){var u=i.ports[0].id,h=i.ports[a].id;this.passableEdges.push({source:u,target:h,length:0})}for(var a=1;a<o.ports.length;a++){var u=o.ports[0].id,h=o.ports[a].id;this.passableEdges.push({source:u,target:h,length:0})}var c=function(t){return t.source},l=function(t){return t.target},p=function(t){return t.length},f=new t.shortestpaths.Calculator(this.verts.length,this.passableEdges,c,l,p),d=function(t,e,n){var s=r.verts[t],a=r.verts[e],u=r.verts[n],h=Math.abs(u.x-s.x),c=Math.abs(u.y-s.y);return s.node===i&&s.node===a.node||a.node===o&&a.node===u.node?0:h>1&&c>1?1e3:0},m=f.PathFromNodeToNodeWithPrevCost(i.ports[0].id,o.ports[0].id,d),g=m.reverse().map(function(t){return r.verts[t]});return g.push(this.nodes[o.id].ports[0]),g.filter(function(t,e){return!(e<g.length-1&&g[e+1].node===i&&t.node===i||e>0&&t.node===o&&g[e-1].node===o)})},r.getRoutePath=function(t,e,n,i){var o={routepath:"M "+t[0][0].x+" "+t[0][0].y+" ",arrowpath:""};if(t.length>1)for(var s=0;s<t.length;s++){var a=t[s],u=a[1].x,h=a[1].y,c=u-a[0].x,l=h-a[0].y;if(s<t.length-1){Math.abs(c)>0?u-=c/Math.abs(c)*e:h-=l/Math.abs(l)*e,o.routepath+="L "+u+" "+h+" ";var p=t[s+1],f=p[0].x,d=p[0].y,m=p[1].x,g=p[1].y;c=m-f,l=g-d;var v,y,_=r.angleBetween2Lines(a,p)<0?1:0;Math.abs(c)>0?(v=f+c/Math.abs(c)*e,y=d):(v=f,y=d+l/Math.abs(l)*e);var b=Math.abs(v-u),x=Math.abs(y-h);o.routepath+="A "+b+" "+x+" 0 0 "+_+" "+v+" "+y+" "}else{var w,C,k=[u,h];Math.abs(c)>0?(u-=c/Math.abs(c)*i,w=[u,h+n],C=[u,h-n]):(h-=l/Math.abs(l)*i,w=[u+n,h],C=[u-n,h]),o.routepath+="L "+u+" "+h+" ",i>0&&(o.arrowpath="M "+k[0]+" "+k[1]+" L "+w[0]+" "+w[1]+" L "+C[0]+" "+C[1])}}else{var w,C,a=t[0],u=a[1].x,h=a[1].y,c=u-a[0].x,l=h-a[0].y,k=[u,h];Math.abs(c)>0?(u-=c/Math.abs(c)*i,w=[u,h+n],C=[u,h-n]):(h-=l/Math.abs(l)*i,w=[u+n,h],C=[u-n,h]),o.routepath+="L "+u+" "+h+" ",i>0&&(o.arrowpath="M "+k[0]+" "+k[1]+" L "+w[0]+" "+w[1]+" L "+C[0]+" "+C[1])}return o},r}();t.GridRouter=i}(r||(r={}));var r;!function(t){var e=function(){function t(t,e){this.source=t,this.target=e}return t.prototype.actualLength=function(t){var e=this;return Math.sqrt(t.reduce(function(t,n){var r=n[e.target]-n[e.source];return t+r*r},0))},t}();t.Link3D=e;var n=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t}();t.Node3D=n;var r=function(){function e(t,n,r){var i=this;void 0===r&&(r=1),this.nodes=t,this.links=n,this.idealLinkLength=r,this.constraints=null,this.useJaccardLinkLengths=!0,this.result=new Array(e.k);for(var o=0;o<e.k;++o)this.result[o]=new Array(t.length);t.forEach(function(t,n){for(var r=0,o=e.dims;r<o.length;r++){var s=o[r];"undefined"==typeof t[s]&&(t[s]=Math.random())}i.result[0][n]=t.x,i.result[1][n]=t.y,i.result[2][n]=t.z})}return e.prototype.linkLength=function(t){return t.actualLength(this.result)},e.prototype.start=function(e){var n=this;void 0===e&&(e=100);var r=this.nodes.length,o=new i;this.useJaccardLinkLengths&&t.jaccardLinkLengths(this.links,o,1.5),this.links.forEach(function(t){return t.length*=n.idealLinkLength});var s=new t.shortestpaths.Calculator(r,this.links,function(t){return t.source},function(t){return t.target},function(t){return t.length}).DistanceMatrix(),a=t.Descent.createSquareMatrix(r,function(t,e){return s[t][e]}),u=t.Descent.createSquareMatrix(r,function(){return 2});this.links.forEach(function(t){var e=t.source,n=t.target;return u[e][n]=u[n][e]=1}),this.descent=new t.Descent(this.result,a),this.descent.threshold=.001,this.descent.G=u,this.constraints&&(this.descent.project=new t.vpsc.Projection(this.nodes,null,null,this.constraints).projectFunctions());for(var h=0;h<this.nodes.length;h++){var c=this.nodes[h];c.fixed&&this.descent.locks.add(h,[c.x,c.y,c.z])}return this.descent.run(e),this},e.prototype.tick=function(){this.descent.locks.clear();for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];e.fixed&&this.descent.locks.add(t,[e.x,e.y,e.z])}return this.descent.rungeKutta()},e.dims=["x","y","z"],e.k=e.dims.length,e}();t.Layout3D=r;var i=function(){function t(){}return t.prototype.getSourceIndex=function(t){return t.source},t.prototype.getTargetIndex=function(t){return t.target},t.prototype.getLength=function(t){return t.length},t.prototype.setLength=function(t,e){t.length=e},t}()}(r||(r={})),e.exports=r},{}]},{},[8])(8)});